<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>???</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/uikit/3.6.22/css/uikit.min.css" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/uikit/3.6.22/js/uikit.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.9-1/crypto-js.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/css/toastr.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/js/toastr.min.js"></script>
    <link id="favicon" rel="icon" type="image/png" >
    <script src="config_tri.js"></script>
    <style>
        .uk-container { width: 96%; max-width: none; }
        .status-active { color: green; }
        .status-inactive { color: red; }
        .sort-icon { position: absolute; right: 10px; top: 50%; transform: translateY(-50%); }
        /* Memaksa warna link untuk CEX */
        .uk-link {
            color: inherit !important;  /* Memastikan warna link mengikuti warna induk */
        }
        a {
            text-decoration: none; /* Menghapus garis bawah */
            color: inherit;        /* Menggunakan warna teks elemen induk */
        }
        /* Memaksa warna status aktif */
        .status-active {
            color: inherit !important;  /* Warna aktif mengikuti warna yang ditentukan */
        }
        img:hover {
                opacity:1;
                transform: scale(1.8); /* You can adjust the scale factor as needed */
            }
        img{
            margin: 1.5px;
        }    
        #progress-container {
            width: 100%;
            background-color: #f3f3f3;
            border-radius: 10px;
            margin-top: 10px;  /* Ubah margin top menjadi lebih kecil */
        }

        #progress-bar {
            height: 14px;  /* Mengurangi tinggi bar progress menjadi 10px */
            width: 0%;
            /* background-color: #4caf50; */
            border-radius: 5px; /* Untuk membuat ujung bar lebih melengkung */
            position: relative;
        }

        #progress-bar span {
            color: white;
            text-align: center;
            line-height: 10px;  /* Menyesuaikan tinggi bar agar teks tetap berada di tengah */
            display: block;
            font-weight: bold;
        }

        /* Tambahkan scroll untuk tabel */
        .uk-overflow-auto {
            overflow-x: auto; /* Scroll horizontal jika diperlukan */
            max-height: 800px; /* Batasi tinggi untuk memunculkan scroll */
            background-color: white; 
        }

        .uk-table tbody td {
            font-size: 12px;
        }
        .merah{
            font-weight: bold;
            color: rgb(250, 249, 249) !important;
            background-color:#eb6464!important;
        }
        .buy {
            color:#05a705;
            font-weight:bolder;
        }
        .sell {
            color:#ea0c0c;
            font-weight:bolder;
        }
        .ijo {
            color: black !important;
            font-weight: bolder;
        }
        .error{
            color: #fafafa!important;
            background-color: #f39999!important;
        }
        .errorrestapi{
            background-color: #f6f2f1!important;
        }
       
        .sinyal-item {
            margin-bottom: 2px;  /* Jarak antar sinyal */
            padding-bottom: 1px;  /* Jarak dari garis bawah ke teks */
            border-bottom: 1px solid #ccc;  /* Garis bawah sebagai pembatas */
        }
        body{
            font-family: Arial, Helvetica, sans-serif;
            padding: 1px;
            /* background-image: linear-gradient(#cffad4, #fefefe, #f3f7f4); */
            color: #0f0f0f;
        }
        .icon-wrapper {
            display: inline-flex;          /* Menjadikan elemen inline fleksibel */
            justify-content: center;       /* Pusatkan gambar secara horizontal */
            align-items: center;           /* Pusatkan gambar secara vertikal */
            margin: 10px;
            transform: scale(1.6);              /* Tinggi ikon */
            background-color: #f97aa8;     /* Warna latar belakang */
            border-radius: 35%;            /* Membuat bentuk lingkaran */
            cursor: pointer;               /* Ubah kursor menjadi tangan saat diklik */
            transition: background-color 0.3s ease; /* Animasi untuk efek hover */
        }

    </style>
    
</head>
<body>
<div class="uk-container uk-margin-small-top">
        <div class="uk-flex uk-flex-between uk-grid-small" uk-grid style="flex: 1;">
            <!-- Bagian Kiri (Form) -->
            <div class="uk-width-auto">
                <h2 id="judul" class="uk-margin-remove" style="font-size: 30px; text-align:center;">
                    MULTIPAIR SCANNER <label id="namachain"></label>&nbsp;
                </h2>
                <img class="icon" id="LoadDataBtn" title="LOAD DATA TOKEN" width="30px" src="https://png.pngtree.com/png-clipart/20230815/original/pngtree-database-sync-icon-icon-symbol-data-vector-picture-image_10830033.png" />
                <img class="icon" id="SettingModal" title="CONFIG APLIKASI" width="30px" src="https://cdn-icons-png.flaticon.com/512/1170/1170635.png" />
                <img class="icon" id="UpdateWalletCEX" title="LOAD STATUS WALLET" width="30px" src="https://images.freeimages.com/fic/images/icons/2770/ios_7_icons/512/wallet.png" />
                <a href="manajemen_aset.html" target="_blank">
                    <img class="icon" id="Modal" title="MANAJEMEN ASSET" width="30px" src="https://cdn-icons-png.flaticon.com/512/1194/1194711.png" />
                </a>
                <a href="multipair.html" target="_blank">
                    <img class="icon" id="MasterData" title="SETTING DATA" width="30px" src="https://cdn-icons-png.flaticon.com/128/3934/3934107.png" />
                </a>
                <a href="https://cors-anywhere.herokuapp.com/corsdemo" target="_blank">
                    <img class="icon" id="BukaKunci" title="BUKA AKSES" width="30px" src="https://cdn-icons-png.flaticon.com/512/9921/9921748.png" />
                </a>
                <img class="icon" id="reload" title="REFRESH PAGE" width="30px" src="https://cdn-icons-png.flaticon.com/512/2546/2546705.png" />
              
                <span id="chain-links-container"></span>                
            </div>
    
            <!-- Bagian Kanan (Konten Lainnya) -->
            <div class="uk-width-expand uk-margin-small-top">
                <form id="cryptoForm" style=" width: 96%;">
                        <div class="dex-group  uk-grid-small uk-flex uk-flex-between" uk-grid>
                            <!-- Kolom untuk CEX -->
                            <div class="uk-width-auto uk-flex uk-flex-middle">
                                <div id="cex-options" class="uk-form-controls" style="display: flex;">
                                    <!-- Radio button CEX akan di-generate di sini -->
                                </div>
                            </div>
                            <!-- Kolom untuk DEX -->
                            <div class="uk-width-auto uk-flex uk-flex-middle">
                                <div id="dex-options" class="uk-form-controls" style="display: flex;">
                                    <!-- Radio button DEX akan di-generate di sini -->
                                </div>
                            </div>
                            <!-- Kolom untuk PAIR -->
                            <div class="uk-width-auto uk-flex uk-flex-middle">
                                <div id="dexpair-options" class="uk-form-controls" style="display: flex;">
                                    <!-- Radio button PAIR DEX akan di-generate di sini -->
                                </div> &nbsp;&nbsp;( <span id="tokenCount" class="uk-text-danger uk-text-bolder" >0</span>)
                                <!-- <input class="uk-input uk-form-width-small uk-form-success uk-form-small" in="customPair" type="text" placeholder="Custom Pair" aria-label="Small"> -->
                                &nbsp;&nbsp;&nbsp;&nbsp;
                                <button type="button" id="startSCAN" style="display: none;" class="uk-button uk-button-secondary uk-button-small">START</button>
                                <button type="button" id="stopSCAN" style="display: none;" class="uk-button uk-button-danger uk-button-small">STOP</button>
                            </div>
                        </div>
                </form>
            </div>
        </div>

    <!-- Modal UIKIT -->
    <div id="modal-setting" class="uk-modal-full" uk-modal>
        <div class="uk-modal-dialog">
            <button class="uk-modal-close-full uk-close-large" type="button" uk-close></button>
            <div class="uk-modal-header">
                <h2 class="uk-modal-title">:: SETTING DEX CHECKER</h2>
               
            </div>
            <div class="uk-modal-body">
                <form> 
                    <!-- Grid UIkit untuk 2 kolom -->
                    <div class="uk-grid-small" uk-grid>
                        
                        <div class="uk-width-1-2">
                            
                            <!-- Kolom pertama -->
                            <div class="uk-card uk-card-default uk-card-body">
                                <h3 style="text-align: center; color: #1317e1;">:: SETINGAN PERMODALAN</h3>
                                <div id="modal-container"></div>                                
                            </div>
                        </div>
                        <div class="uk-width-1-2">
                            <!-- Kolom kedua -->
                            <div class="uk-card uk-card-default uk-card-body">
                                <h3 style="text-align: center; margin: 12px 0px; color: #1317e1;">:: SETINGAN SCANNER</h3>
                                <label for="pnl">NICK NAME:</label>
                                <input type="text" id="user"  class="uk-input" required>

                                <div class="uk-flex uk-flex-middle uk-margin ">
                                    <!-- <div style="display: none;"> -->
                                       <div>
                                           <label for="jeda-time-group" class="uk-text-danger">KOIN/GRUP : </label>
                                           <label class="uk-form-label uk-text-success"><input class="uk-radio" type="radio" value="16" name="koin-group"> 16</label>                                          
                                           <label class="uk-form-label uk-text-success"><input class="uk-radio" type="radio" value="14"  name="koin-group"> 14</label> 
                                           <label class="uk-form-label uk-text-success"><input class="uk-radio" type="radio" value="12"  name="koin-group"> 12</label>
                                           <label class="uk-form-label uk-text-success"><input class="uk-radio" type="radio" value="10"  name="koin-group"> 10</label>  
                                        </div>
                                    </div>
                                <div class="uk-flex uk-flex-middle uk-margin ">
                                       <div>
                                            <label for="SPEEDSCAN" class="uk-text-danger">WAKTU TUNGGU</label>
                                            <label class="uk-form-label uk-text-success"><input class="uk-radio" type="radio" value="1"  name="waktu-tunggu"> NORMAL </label>
                                            <label class="uk-form-label uk-text-success"><input class="uk-radio" type="radio" value="0.7" name="waktu-tunggu"> MEDIUM </label>
                                            <label class="uk-form-label uk-text-success"><input class="uk-radio" type="radio" value="0.5" name="waktu-tunggu"> FAST </label>
                                        </div>
                                   </div>
                                <div>
                                </div>
                                
                                <div class="uk-flex uk-flex-middle uk-margin ">
                                 <!-- <div style="display: none;"> -->
                                    <div>
                                        <label for="jeda-koin" class="uk-text-warning">FILTER PNL</label><br/>
                                        <input class="uk-input" type="number" id="inFilterPNL" value="0" name="filterpnl" >         
                                    </div>
                                    <div>
                                        <label for="jeda-time-group" class="uk-text-danger">JEDA / GROUP {500}</label><br/>
                                        <input class="uk-input" id="jeda-time-group" type="number" value="500" name="jeda-time-group" >
                                    </div>
                                    <div>
                                        <label for="jeda-koin" class="uk-text-primary">JEDA / KOIN {100}</label><br/>
                                        <input class="uk-input" type="number" id="jeda-koin" value="100" name="jeda-koin" > 
                                    </div>
                                </div>

                                    <div>
                                        <label for="walletMeta" class="uk-text-danger">WALLET METAMASK</label><br />
                                        <input class="uk-input" type="text" id="walletMeta" name="walletMeta" >
                                    </div>
                                <div>                                    
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Tombol untuk menutup modal -->
                    <p class="uk-text-right">
                        <button class="uk-button uk-button-default uk-modal-close" type="button">Tutup</button>
                        <button type="button" id="save-config" class="uk-button uk-button-primary">SIMPAN</button>  
                    </p>                   
                </form>
            </div>
        </div>
    </div>

    <div>
        <!-- Bagian untuk menampilkan sinyal DEX -->
        <div class="uk-text uk-text-small  uk-margin-small-top " id="sinyal-container" style="background-color: #fff;">
            <!-- Sinyal DEX akan dimuat di sini -->
        </div>
        <div class="uk-grid-small uk-flex uk-flex-middle  uk-margin-small-top" uk-grid>
            <!-- Judul dan Jumlah Token -->
            <div class="uk-width-expand">
                <h4 class="uk-heading-line uk-margin-remove" id="daftar">
                    <span style="font-size:medium; font-weight: bolder;">DAFTAR TOKEN <span id="namachain2"></span> (<span id="tokenCountALL" class="token-count">0</span>)</span>
                </h4>
            </div>
           
            <!-- Pencarian -->
            <div class="uk-width-auto uk-flex uk-flex-middle">
                <input type="text" id="searchInput" class="uk-input uk-form-small uk-form-primary uk-form-width-small" placeholder="Cari di tabel...">
            </div>
        </div>
    </div>

    <div id="progress-container" style="width: 100%; background-color: #f3f3f3; border-radius: 10px; margin-top: 10px;">
        <div id="progress-bar" style="height: 14px; width: 0%; background-color: #4caf50; border-radius: 5px;">
            <span id="progress-text" style="color: white; font-size: 12px; text-align: center; line-height: 10px; display: block; font-weight: bold;">0%</span>
        </div>
    </div>
    <div id="progress" style="font-size: 14px; font-weight: bold; margin-top: 5px;"></div>
    
    <div class="uk-overflow-auto uk-margin-small-top">
        <table class="uk-table uk-table-hover uk-table-small uk-table-striped">
            <thead class="table-header">
                <tr>
                    <!-- Kolom-kolom header akan ditambahkan secara dinamis -->
                </tr>
            </thead>
            <tbody id="dataTableBody">
                <!-- Baris-baris data akan ditambahkan secara dinamis -->
            </tbody>
        </table>
        <div id="InfoAPP" style="text-align:center; font-weight:bold; color:red;"></div>    
        <div id="InfoStatus" style="text-align:center; font-weight:bold; color:red;"></div>    
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    // Mendapatkan parameter dari URL
    const urlParams = new URLSearchParams(window.location.search);
    const chainName = urlParams.get('chain') || "bsc"; // Default ke 'bsc' jika tidak ada parameter 'chain' di URL

    // Memilih chain yang sesuai berdasarkan parameter URL
    const selectedChain = CONFIG_CHAINS[chainName] || CONFIG_CHAINS['bsc']; 

    // Mengatur konfigurasi global chain berdasarkan input dari URL
    const { Kode_Chain, Nama_Chain, URL_Chain, pairs } = selectedChain; 

    const storagePrefix = "MULTIPAIR_" + Nama_Chain.toUpperCase() + "_";
    let sortOrder = {};
    
    // Fungsi umum untuk mendapatkan data dari localStorage
    function getFromLocalStorage(key, defaultValue) {
        return JSON.parse(localStorage.getItem(storagePrefix + key)) || defaultValue;
       // console.log("Data from localStorage:", data); // Debug log
    }

    // Fungsi umum untuk menyimpan data ke localStorage
    function saveToLocalStorage(key, value) {
        try {
            localStorage.setItem(storagePrefix + key, JSON.stringify(value));
           // console.log("Data saved successfully:", key);
        } catch (error) {
            // Tambahkan log untuk memverifikasi jenis error
            console.error("Error saat menyimpan data:", error);

            if (error.name === "QuotaExceededError") {
                // Tambahkan pengecekan ruang yang tersedia sebelum menyimpan
                let usedSpace = new Blob(Object.values(localStorage)).size;
                let totalSpace = 5 * 1024 * 1024; // Biasanya 5MB
                console.error(`Used space: ${usedSpace} bytes / Total allowed: ${totalSpace} bytes`);

                toastr.error("MEMORY BROWSER PENUH!!! Sisa ruang tidak mencukupi.");
            } else {
                toastr.error("Terjadi kesalahan tak terduga saat menyimpan data.");
            }
        }
    }


    // Fungsi untuk menghapus item dari localStorage
    function removeFromLocalStorage(key) {
        localStorage.removeItem(storagePrefix + key);
       // console.log("Remove from localStorage:", key); // Debug log
    }
    // Fungsi untuk mendapatkan data chain berdasarkan nama chain
    function getChainData(chainName) {
        const chainData = CONFIG_CHAINS[chainName]; // base
        
        if (!chainData) {
            console.log(`Chain dengan nama ${chainName} tidak ditemukan.`);
            return null;
        }
        return {
            Kode_Chain: chainData.Kode_Chain,
            Nama_Chain: chainData.Nama_Chain,
            DEXS: chainData.DEXS,
            PAIRDEXS: chainData.PAIRDEXS,
            URL_Chain: chainData.URL_Chain, 
            DATAJSON: chainData.DATAJSON, 
            BaseFEEDEX: chainData.BaseFEEDEX, 
            CEXCHAIN: chainData.WALLET_CEX,
            ICON_CHAIN: chainData.ICON,
            COLOR_CHAIN: chainData.WARNA,
        };
    }
   // Fungsi untuk memilih server secara acak dari array
   function getRandomServerFromCORSList() {
        const serverCORSList = getFromLocalStorage("SERVERCORS", []);  // Ambil data dari localStorage
    
        if (!serverCORSList || serverCORSList.length === 0) {
            toastr.warning("DATA SETTING TIDAK ADA, SILAKAN SYCN ULANG!!");
            return null; // Tidak ada server dalam daftar
        }
    
        // Pilih server secara acak
        const randomIndex = Math.floor(Math.random() * serverCORSList.length);
        return serverCORSList[randomIndex];
    }
    
    // Menggunakan fungsi untuk mendapatkan server CORS secara acak
    var selectedServer = getRandomServerFromCORSList();
    const DTChain = getChainData(chainName);  
    var SavedSettingData = getFromLocalStorage('DATA_SETTING', {});
    var DataTokens = getFromLocalStorage('TOKEN_SCANNER',[]);
    var MasterTokens = getFromLocalStorage('TOKEN',[]);
    var serverCORSList = getFromLocalStorage("SERVERCORS", []); 
    var WalletCEX = getFromLocalStorage("WALLET_CEX", []); 

    const dexList = [
            { id: 'D1INCH', Modal: SavedSettingData.Modal1INCH,  dex: '1inch' },
            { id: 'DODOS', Modal: SavedSettingData.ModalODOS, dex: 'odos' },
            { id: 'D0X', Modal: SavedSettingData.Modal0X,  dex: '0x' },
            { id: 'DKYBERSWAP', Modal: SavedSettingData.ModalKYBERSWAP, dex: 'kyberswap' },
            { id: 'DJUPITER', Modal: SavedSettingData.ModalJUPITER,  dex: 'jupiter' },
            { id: 'DOKX', Modal: SavedSettingData.ModalOKX,  dex: 'okx' },
            { id: 'DMAGPIE', Modal: SavedSettingData.ModalMAGPIE,  dex: 'magpie' },
            { id: 'DPARASWAP', Modal: SavedSettingData.ModalPARASWAP,  dex: 'paraswap' }
        ];
    var filteredTokens = filterTokens();
    // Mapping konfigurasi untuk setiap exchange
    const exchangeConfig = {
        GATE: {
            url: coins => `https://api.gateio.ws/api/v4/spot/order_book?limit=5&currency_pair=${coins.symbol}_USDT`,
            processData: data => processOrderBook(data)
        },
        BINANCE: {
            url: coins => `https://api.binance.me/api/v3/depth?limit=4&symbol=${coins.symbol}USDT`,
            processData: data => processOrderBook(data)
        },
        MEXC: {
            url: coins => `https://api.mexc.com/api/v3/depth?symbol=${coins.symbol}USDT&limit=5`,
            processData: data => processOrderBook(data)
        },
        KUCOIN: {
            url: coins => `https://proxykiri.awokawok.workers.dev/?https://api.kucoin.com/api/v1/market/orderbook/level2_20?symbol=${coins.symbol}-USDT`,
            processData: data => {
                if (!data?.data?.asks || !data?.data?.bids) {
                    console.error('Invalid KUCOIN response structure:', data);
                    return { priceBuy: [], priceSell: [] };
                }
                const priceBuy = data.data.bids.slice(0, 4).map(([price, volume]) => ({
                    price: parseFloat(price),
                    volume: parseFloat(volume) * parseFloat(price)
                }));
                const priceSell = data.data.asks.slice(0, 4).map(([price, volume]) => ({
                    price: parseFloat(price),
                    volume: parseFloat(volume) * parseFloat(price)
                }));
                return { priceBuy, priceSell };
            }
        },
        BITGET: {
            url: coins => `https://api.bitget.com/api/v2/spot/market/orderbook?symbol=${coins.symbol}USDT&limit=5`,
            processData: data => {
                if (!data?.data?.asks || !data?.data?.bids) {
                    console.error('Invalid BITGET response structure:', data);
                    return { priceBuy: [], priceSell: [] };
                }
                const priceBuy = data.data.bids.slice(0, 4).map(([price, volume]) => ({
                    price: parseFloat(price),
                    volume: parseFloat(volume) * parseFloat(price)
                }));
                const priceSell = data.data.asks.slice(0, 4).map(([price, volume]) => ({
                    price: parseFloat(price),
                    volume: parseFloat(volume) * parseFloat(price)
                }));
                return { priceBuy, priceSell };
            }
        },
        BYBIT: {
            url: coins => `https://api.bybit.com/v5/market/orderbook?category=spot&limit=4&symbol=${coins.symbol}USDT`,
            processData: data => {
                if (!data?.result?.a || !data?.result?.b) {
                    console.error('Invalid BYBIT response structure:', data);
                    return { priceBuy: [], priceSell: [] };
                }
                const priceBuy = data.result.b.slice(0, 4).map(([price, volume]) => ({
                    price: parseFloat(price),
                    volume: parseFloat(volume) * parseFloat(price)
                }));
                const priceSell = data.result.a.slice(0, 4).map(([price, volume]) => ({
                    price: parseFloat(price),
                    volume: parseFloat(volume) * parseFloat(price)
                }));
                return { priceBuy, priceSell };
            }
        },
        OKX: {
            url: coins => `https://www.okx.com/api/v5/market/books?instId=${coins.symbol}-USDT&sz=5`,
            processData: data => {
                if (!data?.data?.[0]?.asks || !data?.data?.[0]?.bids) {
                    console.error('Invalid OKX response structure:', data);
                    return { priceBuy: [], priceSell: [] };
                }
                const priceBuy = data.data[0].bids.slice(0, 4).map(([price, volume]) => ({
                    price: parseFloat(price),
                    volume: parseFloat(volume) * parseFloat(price)
                }));
                const priceSell = data.data[0].asks.slice(0, 4).map(([price, volume]) => ({
                    price: parseFloat(price),
                    volume: parseFloat(volume) * parseFloat(price)
                }));
                return { priceBuy, priceSell };
            }
        }
    };   

     // Fungsi untuk mendapatkan fee gas dalam Gwei
     function feeGasGwei() {
        $.when(
            $.ajax({
                url: 'https://data-api.binance.vision/api/v3/ticker/24hr?symbol=' + DTChain.BaseFEEDEX,
                method: 'GET'
            }),
            $.ajax({
                url: 'https://gas.api.infura.io/v3/9d0429abadc34232af7d5c0e6ab98631/networks/' + DTChain.Kode_Chain + '/suggestedGasFees',
                method: 'GET'
            })
        ).done(function(PriceResponse, gasResponse) {
            var lastPrice = PriceResponse[0].lastPrice;
            saveToLocalStorage('PRICEGAS', lastPrice); // Menggunakan saveToLocalStorage
            var mediumGasFee = gasResponse[0].low.suggestedMaxFeePerGas;
            saveToLocalStorage('gasGWEI', mediumGasFee); // Menggunakan saveToLocalStorage
            
           // $("#LGwei").text("" + parseFloat(getFromLocalStorage('gasGWEI', 0)).toFixed(2)+" | "+DTChain.BaseFEEDEX+":"+parseFloat(getFromLocalStorage('PRICEGAS', 0)).toFixed(2)); // Menggunakan getFromLocalStorage

           //  console.log('Medium Gas Fee:', mediumGasFee);
        }).fail(function(error) {
            console.error('Failed to fetch data:', error);
        });
    }
    // Fungsi untuk menonaktifkan semua input di dalam form
    function form_off() {
        $('input, select, textarea, button').prop('disabled', true); 
    }

    // Fungsi untuk mengaktifkan semua input di dalam form
    function form_on() {
        $('input, select, button').prop('disabled', false);
    }

    UIkit.util.on('#modal-setting', 'show', function () {
        form_on();
    });

    function cekDataAwal() {
        // console.log("DataTokens:", DataTokens);
        // console.log("SavedSettingData:", SavedSettingData);
        // console.log("WalletCEX:", WalletCEX);

        // Array untuk menyimpan pesan error
        let errorMessages = [];
        if (!MasterTokens.length) {
            errorMessages.push('TIDAK ADA DATA PADA SETTINGAN!');
            $("#MasterData").addClass("icon-wrapper");
            $('#UpdateWalletCEX').css('pointer-events', 'none').css('opacity', '0.4');            
        }else if (!DataTokens.length) {
            form_off(); 
            $("#LoadDataBtn").addClass("icon-wrapper");   
            errorMessages.push('<b>SILAKAN LOAD DATA TERLEBIH DAHULU !!</b><br/>');         
        }else if (!SavedSettingData || SavedSettingData.walletMeta === '-' ) {
            errorMessages.push('CEK, SETTINGAN APLIKASI {MODAL,WALLET METAMASK}!');
            $("#SettingModal").addClass("icon-wrapper");
            form_off();
        }else if (!WalletCEX.length) {
            errorMessages.push('TIDAK ADA DATA WALLET CEX, SILAKAN UPDATE WALLET PADA SETTINGAN!');
            $("#MasterData").addClass("icon-wrapper");
            $('#UpdateWalletCEX').css('pointer-events', 'none').css('opacity', '0.4');
            
        }else{
            generateInputCheckbox(CONFIG_CEX,  "cex-options","","EXCH:","uk-form-label uk-text-success");
            generateInputCheckbox(DTChain.DEXS,  "dex-options","D","DEFI:","uk-form-label uk-text-danger");
            generateInputCheckbox(DTChain.PAIRDEXS, "dexpair-options","","PAIRING :","uk-form-label uk-text-primary");
            generateInputModal(DTChain.DEXS);
            loadStoredData(filteredTokens);
            loadCheckboxSelections();            
        }

        
        
        var link = $('a[href="multipair.html"]'); // Pilih elemen link
            var href = link.attr('href'); // Ambil URL href
            link.attr('href', href + "?chain=" + encodeURIComponent(chainName)); // Update href dengan parameter baru

        // Tampilkan semua pesan error
        $("#InfoAPP").html(errorMessages.join('<br/>')).addClass("text-large");  
    }

    $(document).ready(function() {  
          
        CekIdentitas(); 
        if (typeof CONFIG_CEX !== 'undefined' && typeof CONFIG_CHAINS !== 'undefined') {
            const currentPage = window.location.pathname.split('/').pop(); // Mengambil bagian terakhir dari path URL
            const selectedChain = CONFIG_CHAINS[Nama_Chain.toLowerCase()];
                // Pastikan data chain ditemukan
                if (selectedChain) {                    
                    // console.log(`Data untuk chain ${chainName}:`, DTChain);                
                    // console.log(`CEXS `, CONFIG_CEX); 
                    // console.log(`DEXS `, DTChain.DEXS); 
                    // generate CEX,DEX dan PAIR
                    
                    // Update tampilan dengan nama chain dan warna
                    $('title').text("SCANNER " + Nama_Chain.toUpperCase());
                    $('#namachain').text(Nama_Chain.toUpperCase());
                    $('#namachain2').text("CHAIN " + Nama_Chain.toUpperCase());
                     $('h2#judul').css('color', selectedChain.WARNA);
                    $('#favicon').attr('href', DTChain.ICON_CHAIN); 
                    $('#sinyal-container').css('color', selectedChain.WARNA);
                    $('#progress-bar').css('background-color', selectedChain.WARNA);
                    $('h4#daftar').css({'color': selectedChain.WARNA,'padding-left':'4px'});
                   
                    cekDataAwal();

                    // Untuk setiap chain yang ada di CONFIG_CHAINS dibuatkan ICON LINK CHAIN
                    Object.keys(CONFIG_CHAINS).forEach(chainKey => {
                        const chain = CONFIG_CHAINS[chainKey];
                        const isActive = chain.Nama_Chain === Nama_Chain;
                        const linkHTML = `<span class="chain-link" style="${!isActive ? 'opacity: 0.3;' : ''}">
                                <a href="${currentPage}?chain=${chain.Nama_Chain}" ><img src="${chain.ICON}" alt="${chain.Nama_Chain} icon" width="${isActive ? '30' : '30'}"></a></span>`;
                        $('#chain-links-container').append(linkHTML);
                    });
                } else {
                    alert(`Chain dengan nama ${Nama_Chain} tidak ditemukan.`);
                }
            } else {
                console.warn("CONFIG tidak tersedia.");
            }

            $('#searchInput').on('input', function() {
                const searchValue = $(this).val().toLowerCase();
                $('#dataTableBody tr').filter(function() {
                    $(this).toggle($(this).text().toLowerCase().indexOf(searchValue) > -1);
                });
            });

            $('#LoadDataBtn').on('click', function() {
                // Ambil data dari localStorage dengan key "TOKEN_SCANNER"
                const storedData = getFromLocalStorage("TOKEN", []); // Ambil data token yang sudah ada
                const WalletCEXData = getFromLocalStorage("WALLET_CEX", []); // Ambil data Wallet CEX dari localStorage

                // Gabungkan data dari TOKEN dan status dari WALLET_CEX
                const combinedData = storedData.map(token => {
                    // Cari data wallet CEX berdasarkan CEX dan tokenName yang sesuai untuk withdraw (symbol_in)
                    const walletWithdraw = WalletCEXData.find(item =>
                        item.cex === token.cex && item.tokenName === token.symbol_in
                    );

                    // Cari data wallet CEX berdasarkan CEX dan tokenName yang sesuai untuk deposit (symbol_out)
                    const walletDeposit = WalletCEXData.find(item =>
                        item.cex === token.cex && item.tokenName === token.symbol_out
                    );

                    // Gabungkan data token dengan status wallet
                    return {
                        ...token,  // Gabungkan data token yang sudah ada
                        feeWDs: walletWithdraw ? walletWithdraw.feeWDs : "",  // Fee Withdraw diambil dari symbol_in
                        depositEnable: walletDeposit ? walletDeposit.depositEnable : false,  // Status Deposit
                        withdrawEnable: walletWithdraw ? walletWithdraw.withdrawEnable : false  // Status Withdraw
                    };
                });

                // Konfirmasi dari pengguna
                if (confirm('LOAD DATA AKAN MERUBAH DATA SEBELUMNYA, LANJUTKAN??')) {
                    saveToLocalStorage("TOKEN_SCANNER", combinedData);

                    const savedData = getFromLocalStorage("TOKEN_SCANNER", []);
                    // Validasi apakah data berhasil disimpan
                    if (savedData.length === combinedData.length) {
                        toastr.success("LOAD DATA BERHASIL!", {
                            timeOut: 4000, // Durasi toast (4 detik)
                            progressBar: true,
                            closeButton: true,
                        });

                        // Refresh halaman untuk memperbarui data
                        setTimeout(() => location.reload(), 2000);
                    } else {
                        toastr.error("LOAD DATA GAGAL!", {
                            timeOut: 4000,
                            progressBar: true,
                            closeButton: true,
                        });
                    }
                } else {
                    // Jika pengguna menekan "Tidak", tidak ada aksi yang dilakukan
                    toastr.info("PROSES LOAD DATA DIBATALKAN OLEH PENGGUNA.", {
                        timeOut: 3000,
                        progressBar: true,
                        closeButton: true,
                    });
                }
            });

            $("#stopSCAN,#reload").click(function () {
                location.reload();
            });
            
    });

    function formatPrice(price) {
        // Jika harga lebih besar dari 1, bulatkan ke 3 angka desimal
        if (price >= 1) {
            return price.toFixed(3)+'$'; // Membulatkan hingga 3 desimal
        }
        // Jika harga lebih kecil dari 1, biarkan harga sesuai dengan format aslinya
        return price.toFixed(10)+'$';
    }

    //scan dengan batas maksimum eksekusi pergrup (speedscan)
    $("#startSCAN").click(function () {
        cekDataAwal();
        sendStatusTELE(SavedSettingData.nickname, 'ONLINE');
        $('#sinyal-container span[id^="sinyal"]').empty();
        form_off();
        
        $("#stopSCAN").show().prop('disabled', false);

        $('#LoadDataBtn, #SettingModal, #MasterData,#UpdateWalletCEX, #chain-links-container').css('pointer-events', 'none').css('opacity', '0.4');

        // Pastikan checkbox tetap aktif dan bisa diubah statusnya
        $('.statusCheckbox').css({ 'pointer-events': 'auto',  'opacity': '1'  }).prop('disabled', false); 

        let ConfigScan = getFromLocalStorage('DATA_SETTING', {});
        let scanPerKoin = parseInt(ConfigScan.scanPerKoin);
        let jedaKoin = parseInt(ConfigScan.jedaKoin);
        let jedaTimeGroup = parseInt(ConfigScan.jedaTimeGroup);
        let dexList = getFromLocalStorage("DEX_PILIH", []);

        let speedScan = parseInt(getFromLocalStorage('SavedSettingData.speedScan', 1000)); // Ambil speedScan dari localStorage, default 1000ms
        
        function delay(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        function updateProgress(current, total, startTime, TokenPair) {
            let duration = ((Date.now() - startTime) / 1000 / 60).toFixed(2);
            let progressPercentage = Math.floor((current / total) * 100);
            let progressText = `CHECKING - ${TokenPair} [${current}/${total}] :: Mulai: ${new Date(startTime).toLocaleTimeString()} ~ DURASI [${duration} Menit]`;

            $('#progress-bar').css('width', progressPercentage + '%');
            $('#progress-text').text(progressPercentage + '%');
            $('#progress').text(progressText);
        }

        async function processTokens() {
            let startTime = Date.now();
            let totalTokens = filteredTokens.length;
            let currentProcessed = 0;

            // Membentuk grup token berdasarkan scanPerKoin
            let tokenGroups = [];
            for (let i = 0; i < filteredTokens.length; i += scanPerKoin) {
                tokenGroups.push(filteredTokens.slice(i, i + scanPerKoin));
            }

            for (let groupIndex = 0; groupIndex < tokenGroups.length; groupIndex++) {
                let groupTokens = tokenGroups[groupIndex];
                console.log(`Memproses grup ${groupIndex + 1} dari ${tokenGroups.length}`);

                for (let tokenIndex = 0; tokenIndex < groupTokens.length; tokenIndex++) {
                    let token = groupTokens[tokenIndex];

                    try {
                        //console.log(`Memproses token ${token.symbol_in}_${token.symbol_out}`);
                        updateProgress(
                            currentProcessed + tokenIndex + 1,
                            totalTokens,
                            startTime,
                            `${token.symbol_in}_${token.symbol_out}`
                        );

                        feeGasGwei()

                        let cex = token.cex.toUpperCase();
                        let symbolIn = token.symbol_in.toUpperCase();
                        let symbolOut = token.symbol_out.toUpperCase();
                        let sc_input = token.sc_in.toUpperCase();
                        let sc_output = token.sc_out.toUpperCase();
                        let des_input = token.des_in;
                        let des_output = token.des_out;
                        let NameToken = token.symbol_in.toUpperCase();
                        let NamePair = token.symbol_out.toUpperCase();

                        let TokenPair = `${symbolIn}_${symbolOut}`;
                        // Pemrosesan token (async per token dengan timeout speedScan)
                        await new Promise((resolve, reject) => {
                            let timeout = setTimeout(() => reject("Timeout"), speedScan);

                            // Pemrosesan data token
                            getPriceCEX(token, token.symbol_in, token.symbol_out, token.cex, (error, DataCEX) => {
                                clearTimeout(timeout); // Hentikan timeout jika selesai
                                if (error) {
                                    console.error("Error data from CEX:", error);
                                    toastr.error(`Cek Ulang Harga ${symbolIn} atau ${symbolOut} Exchanger : ${cex}`);
                                    resolve(); // Pastikan resolve dipanggil meskipun terjadi error
                                    $('#' + cex + '_' + TokenPair+'_'+ (DTChain.Nama_Chain).toUpperCase()).css('background-color','#fadcdc');
                                    return;
                                } else {
                                    let priceBuyTokenCEX = DataCEX.volumes_buyToken[0]?.price || "N/A";
                                    let priceSellTokenCEX = DataCEX.volumes_sellToken[0]?.price || "N/A";

                                    let priceBuyPairCEX = DataCEX.volumes_buyPair[0]?.price || "N/A";
                                    let priceSellPairCEX = DataCEX.volumes_sellPair[0]?.price || "N/A";

                                    let feeWD = parseFloat(DataCEX.feeWD || 0).toFixed(2);
                                   
                                    // Proses data DEX
                                    dexList.forEach((dex) => {
                                        let dexId = `${cex}_${dex.toUpperCase()}_${TokenPair}_${(DTChain.Nama_Chain).toUpperCase()}`;
                                        let modalKey = `MODAL_${dex.toUpperCase()}`;
                                        let modalValue = SavedSettingData[modalKey];
                                        let dextype=dex.toLowerCase();

                                        if ($(`#${dexId}`).length) {
                                            var Modal = parseFloat(modalValue);
                                            var amount_in =parseFloat(Modal) / parseFloat(priceBuyTokenCEX);
                                            getPriceDEX(sc_input, des_input, sc_output, des_output, amount_in, priceBuyPairCEX, dextype, NameToken, NamePair, cex, function (error, DataDEX) {     
                                                if (error) {
                                                    console.error("Error: Get Pice DEX:", error);
                                                    $(`#${dexId}`).css('background-color',error.color);

                                                     $(`#SWAP_${dexId}`).html(`${dex.toUpperCase()} <br/> <span title="${error.pesanDEX}">[ERROR]</span>`);
                                                    return;
                                                }else{
                                                    
                                                    if (NameToken == "USDT") {
                                                        $(`span#SELL_${dexId}`).text(`${formatPrice(priceSellPairCEX)} ${NamePair}`);       
                                                    }else if(NamePair == "USDT"){
                                                        $(`span#BUY_${dexId}`).text(`${formatPrice(priceBuyTokenCEX)} ${NameToken}`);
                                                    }else  {
                                                        $(`span#BUY_${dexId}`).text(`${formatPrice(priceBuyTokenCEX)} ${NameToken}`);
                                                        $(`span#SELL_${dexId}`).text(`${formatPrice(priceSellPairCEX)} ${NamePair}`);    
                                                    }  
                                                    
                                                    ResultEksekusi(DataDEX, DataCEX, Modal, amount_in, priceBuyTokenCEX, priceSellTokenCEX, priceBuyPairCEX, priceSellPairCEX, NameToken, NamePair, dextype); 
                                                }
                                            });    
                                            
                                        }
                                    });
                                    
                                    resolve();
                                }
                            });
                        });

                        await delay(jedaKoin); // Tunggu jeda antar token dalam grup
                    } catch (error) {
                        console.error(`Kesalahan saat memproses ${token.symbol_in}_${token.symbol_out}:`, error);
                    }
                }

                currentProcessed += groupTokens.length; // Update jumlah token yang telah diproses
                console.log(`Grup ${groupIndex + 1} selesai diproses`);
                await delay(jedaTimeGroup); // Tunggu jeda antar grup
            }

            // Progress bar selesai
            updateProgress(totalTokens, totalTokens, startTime, "SELESAI");
            form_on();

            // Mengaktifkan kembali UI
            $("#stopSCAN").hide().prop("disabled", false);
            $("#LoadDataBtn, #SettingModal, #MasterData,#UpdateWalletCEX,#chain-links-container").css("pointer-events", "auto").css("opacity", "1");
        }

        processTokens(); // Memulai pemrosesan token
    });

    //genereta inputan checkbox
    function generateInputCheckbox(items, containerId, idPrefix, labelText, style) {
            const $container = $(`#${containerId}`);
            $container.empty(); // Bersihkan container

            // Tambahkan label di atas checkbox
            const label = `
                <b>
                    <span class="uk-text-secondary uk-text-medium">${labelText}</span>
                </b>
            `;
            $container.append(label);

            // Jika items adalah objek, ambil key-nya
            if (typeof items === 'object' && !Array.isArray(items)) {
                items = Object.keys(items); // Ambil key dari objek
            }

            // Iterasi dan tambahkan checkbox beserta label
            const checkboxWrapper = $('<div style="display: flex;"></div>'); // Bungkus checkbox
            items.forEach(item => {
                const checkboxId = `${idPrefix}${item.toUpperCase()}`;
                const checkbox = `
                    <label class="${style || ''}" for="${checkboxId}">
                        <input type="checkbox" id="${checkboxId}" value="${item}" checked>
                        ${item.toUpperCase()}
                    </label>`;
                checkboxWrapper.append(checkbox);
            });

            $container.append(checkboxWrapper); // Masukkan checkbox ke dalam container
        }

    // Fungsi untuk memuat data dari localStorage saat halaman dimuat
    function loadCheckboxSelections() {
        let errorMessages = [];
        // Muat data CEX
        const savedCEX = getFromLocalStorage("CEX_PILIH", []);
        $('#cex-options input[type="checkbox"]').each(function() {
            $(this).prop('checked', savedCEX.includes($(this).val()));
        });

        // Muat data DEX
        const savedDEX = getFromLocalStorage("DEX_PILIH", []);
        $('#dex-options input[type="checkbox"]').each(function() {
            $(this).prop('checked', savedDEX.includes($(this).val()));
        });

        // Muat data DEXPAIR
        const savedDEXPAIR = getFromLocalStorage("DEXPAIR_PILIH", []);
        $('#dexpair-options input[type="checkbox"]').each(function() {
            $(this).prop('checked', savedDEXPAIR.includes($(this).val()));
        });

      //  const pilihCex = getFromLocalStorage('CEX_PILIH', null);
        if (!savedCEX || !Array.isArray(savedCEX) || savedCEX.length === 0) {
            errorMessages.push('SILAKAN PILIH CEX!');
            $("#cex-options").addClass("error");
            form_on(); // tetap off jika `PILIH_CEX` belum diatur
        }
        
        //const pilihDex = getFromLocalStorage('DEX_PILIH', null);
        if (!savedDEX || !Array.isArray(savedDEX) || savedDEX.length === 0) {
            errorMessages.push('SILAKAN PILIH DEX!');
            $("#dex-options").addClass("error");
            form_on(); // tetap off jika `PILIH_DEX_PAIR` belum diatur
        }  
       // const pilihDexPair = getFromLocalStorage('DEXPAIR_PILIH', null);
        if (!savedDEXPAIR || !Array.isArray(savedDEXPAIR) || savedDEXPAIR.length === 0) {
            errorMessages.push('SILAKAN PILIH DEX PAIR!');
            $("#dexpair-options").addClass("error");
            form_on(); // tetap off jika `PILIH_DEX_PAIR` belum diatur
        }   
        $("#InfoAPP").html(errorMessages.join('<br/>')).addClass("text-large");    
    }
    
    // Fungsi untuk menentukan warna berdasarkan nama CEX
    function getWarnaCEX(cex) {
        const cexConfig = CONFIG_CEX[cex.toUpperCase()]; // Ambil konfigurasi berdasarkan nama CEX
        return cexConfig && cexConfig.WARNA ? cexConfig.WARNA : 'black'; // Gunakan warna dari konfigurasi atau 'black' jika tidak ditemukan
    }

    //fungsi filter TOKEN berdasarkan CEX,DEX dan DEX-PAIR
    function filterTokens() {
        const allTokens = Array.isArray(getFromLocalStorage("TOKEN_SCANNER", [])) ? getFromLocalStorage("TOKEN_SCANNER", []) : [];
        const selectedCEX = Array.isArray(getFromLocalStorage("CEX_PILIH", [])) ? getFromLocalStorage("CEX_PILIH", []) : [];
        const selectedDEXPAIR = Array.isArray(getFromLocalStorage("DEXPAIR_PILIH", [])) ? getFromLocalStorage("DEXPAIR_PILIH", []) : [];

        if (allTokens.length === 0) {
            console.warn("No tokens available for filtering.");
            return [];
        }

        const isNonSelected = selectedDEXPAIR.includes("NON");
        const dexPairs = Object.keys(DTChain.PAIRDEXS).filter(pair => pair !== "NON");

        const filteredTokens = allTokens.filter(token => {
            if (!token || !token.cex || !token.symbol_in || !token.symbol_out) return false;

            const validCEX = selectedCEX.includes(token.cex);
            const validDexPair = isNonSelected
                ? selectedDEXPAIR.some(pair => token.symbol_in === pair || token.symbol_out === pair)
                || !dexPairs.some(pair => token.symbol_in === pair || token.symbol_out === pair)
                : selectedDEXPAIR.some(pair => token.symbol_in === pair || token.symbol_out === pair);

            return validCEX && validDexPair && token.status === true && token.withdrawEnable === true && token.depositEnable === true;
        });

        if (filteredTokens.length === 0) {
            console.warn("No tokens matched the filtering criteria.");
            toastr.error("TIDAK ADA TOKEN-PAIR YANG SESUAI CEX/DEX/PAIRDEX !!");
        }

        return filteredTokens;
    }

    // Fungsi untuk menampilkan sinyal DEX
    function loadSignalData() {
        let selectedDEX = getFromLocalStorage('DEX_PILIH', []); // Ambil pilihan DEX dari localStorage

        let sinyalContainer = document.getElementById('sinyal-container');
        sinyalContainer.innerHTML = ''; // Kosongkan sebelumnya jika ada perubahan

        selectedDEX.forEach(dex => {
            // Menambahkan elemen sinyal untuk setiap DEX yang dipilih
            let sinyalItem = document.createElement('div');
            sinyalItem.classList.add('sinyal-item');
            sinyalItem.setAttribute('data-dex', dex);

            let label = document.createElement('b');
            label.innerText = dex.toUpperCase(); // Menampilkan nama DEX

            let signalSpan = document.createElement('span');
            signalSpan.classList.add('uk-text', 'uk-text-small', 'uk-text-primary');
            signalSpan.setAttribute('id', `sinyal${dex.toLowerCase()}`); // ID dinamis untuk sinyal setiap DEX

            sinyalItem.appendChild(label);
            sinyalItem.innerHTML += ": "; // Separator
            sinyalItem.appendChild(signalSpan);

            sinyalContainer.appendChild(sinyalItem);
        });
    }
    
    function loadStoredData(filteredData) {
        $('.table-header th').css('background-color', DTChain.COLOR_CHAIN);
        loadSignalData();

        const selectedDEX = getFromLocalStorage('DEX_PILIH', []);
        const appSettings = getFromLocalStorage('DATA_SETTING', {});
        const $InfoStatus = $('div#InfoStatus');
        const $tableBody = $('#dataTableBody');
        const $headerRow = $('.table-header');

        // Tampilkan status loading
        $InfoStatus.text("Sedang Memuat DATA TOKEN...").show();

        if (!Array.isArray(filteredData) || filteredData.length === 0) {
            $InfoStatus.text("Tidak ada data token yang ditemukan.");
            setTimeout(() => $InfoStatus.fadeOut(), 2000);
            $('#tokenCount').text("0");

            const jml = DataTokens.filter(t => t.status === true).length;
            $('#tokenCountALL').text(`TOTAL ALL: ${jml} PAIR-TOKEN`);  

            return;
        }

        $tableBody.empty(); // Kosongkan tabel sebelum mengisi ulang

        // Render header tabel hanya jika jumlah kolomnya tidak sesuai
        if ($headerRow.children().length !== selectedDEX.length + 4) {
            $headerRow.empty();
            $headerRow.append('<th class="header">PRICE & VOL BUY</th>');
            $headerRow.append('<th class="header">DETAIL TOKEN</th>');

            selectedDEX.forEach((dex) => {
                const modalName = appSettings[`MODAL_${dex.toUpperCase()}`] || 0;
                $headerRow.append(`<th class="header">${dex} [${modalName}]</th>`);
            });

            $headerRow.append('<th class="header">PRICE & VOL SELL</th>');
        }

        const fragment = document.createDocumentFragment();

        filteredData.forEach((data, index) => {
            const warnaCEX = getWarnaCEX(data.cex);

            const urlsCEX = GeturlExchanger(data.cex, data.symbol_in, data.symbol_out);

            // Link untuk token withdraw
            const linkWd = urlsCEX.withdrawUrl
                ? `<a href="${urlsCEX.withdrawUrl}" target="_blank"><b>WD</b></a>`
                : `<b>WX</b>`;

            // Link untuk pair deposit
            const linkDepo = urlsCEX.depositUrl
                ? `<a href="${urlsCEX.depositUrl}" target="_blank"><b>DP</b></a>`
                : `<b>DX</b>`;

            // Status withdraw dengan link
            const withdrawStatus = {
                text: data.withdrawEnable ? linkWd : `<b style="color:red; font-weight:bold;">WX</b>`,
                style: data.withdrawEnable ? 'color:black; font-weight:bold;' : 'color:red; font-weight:bold;',
            };

            // Status deposit dengan link
            const depositStatus = {
                text: data.depositEnable ? linkDepo : `<b style="color:red; font-weight:bold;">DX</b>`,
                style: data.depositEnable ? 'color:black; font-weight:bold;' : 'color:red; font-weight:bold;',
            };

            const linkToken = urlsCEX.tradeToken
                ? `<a href="${urlsCEX.tradeToken}" target="_blank"><b>${data.symbol_in.toUpperCase()}</b></a>`
                : `<b>${data.symbol_in.toUpperCase()}</b>`;

            const linkPair = urlsCEX.tradePair
                ? `<a href="${urlsCEX.tradePair}" target="_blank"><b>${data.symbol_out.toUpperCase()}</b></a>`
                : `<b>${data.symbol_out.toUpperCase()}</b>`;

               
            const linkStok = Object.keys(DTChain.CEXCHAIN[data.cex])
                .filter((key) => key.includes('address'))
                .map(
                    (key, idx) =>
                        `<b><a href="${DTChain.URL_Chain}/token/${data.sc_in}?a=${DTChain.CEXCHAIN[data.cex][key]}" target="_blank"> #${idx + 1} </a></b>`
                )
                .join('');

            // Tambahkan link DEX lainnya

            const linkOKDEX = `<span class="uk-text-secondary">
                <a href="https://www.okx.com/web3/dex-swap?inputChain=${DTChain.Kode_Chain}&inputCurrency=${data.sc_in}&outputChain=501&outputCurrency=${data.sc_out}" target="_blank">
                #OKX
                </a>
            </span>`;

            const linkUNIDEX = `<span class="uk-text-success">
                <a href="https://app.unidex.exchange/?chain=${DTChain.Nama_Chain}&from=${data.sc_in}&to=${data.sc_out}" target="_blank">
                    #UNID
                </a>
            </span>`;

            const linkRango = `<span class="uk-text-danger">
                <a href="https://app.rango.exchange/bridge?fromBlockchain=${DTChain.Kode_Chain}&toBlockchain=${DTChain.Kode_Chain}&fromToken=${data.symbol_in}--${data.sc_in}&toToken=${data.symbol_out}--${data.sc_out}" target="_blank">
                #RANG
                </a>
            </span>`;
            //$('#' + cex + '_' + TokenPair+'_'+ (DTChain.Nama_Chain).toUpperCase())
            let row = document.createElement('tr');
            row.setAttribute('data-index', index);
            // Menambahkan id pada tr
            row.setAttribute('id', `${data.cex}_${data.symbol_in}_${data.symbol_out}_${DTChain.Nama_Chain.toUpperCase()}`);

            row.innerHTML = `
                <td style="text-align:center; vertical-align: middle;" class="uk-text-success">
                    <a href="${urlsCEX.tradeToken}" target="_blank">
                        <span id="BUY_${data.cex}_${data.symbol_in}_${data.symbol_out}_${DTChain.Nama_Chain.toUpperCase()}">PRICE & VOL BUY <br>${data.cex}</span>
                    </a>
                </td>
                <td class="uk-text-center" style="text-align:center; vertical-align: middle;">
                    <input type="checkbox" class="statusCheckbox"  data-id="${index}" data-index="${data.no}" ${data.status ? 'checked' : ''}>
                    <span class="uk-text-center uk-text-secondary uk-text-bolder">${linkToken} VS ${linkPair}</span><br>
                    <span style="${withdrawStatus.style}">${withdrawStatus.text}</span> 
                    <a href="${DTChain.URL_Chain}/token/${data.sc_in}" target="_blank" class="uk-link">[SC]</a> ~ 
                    <span style="${depositStatus.style}">${depositStatus.text}</span> 
                    <a href="${DTChain.URL_Chain}/token/${data.sc_out}" target="_blank" class="uk-link">[SC]</a><br>
                    <span style="color: ${warnaCEX}; font-weight:bolder;">${data.cex}</span>: ${linkStok}<br>
                    <span id=feeWDUSDT_${data.cex}_${data.symbol_in}_${data.symbol_out}_${(DTChain.Nama_Chain).toUpperCase()} class="uk-text-center uk-text-warning uk-text-bolder">FEE WD ? </span> <br/>
                    ${linkOKDEX} ${linkUNIDEX} ${linkRango}
                </td>
            `;

            selectedDEX.forEach((dex) => {
                const idCELL = `${data.cex}_${dex.toUpperCase()}_${data.symbol_in}_${data.symbol_out}_${DTChain.Nama_Chain.toUpperCase()}`;
                row.innerHTML += `
                    <td class="uk-text-center" style="vertical-align: middle;" id="${idCELL}">
                        <a href="${urlsCEX.tradeToken}" target="_blank">
                            <span class="buy" id="BUY_${idCELL}"> --- </span>
                        </a><br>
                        <span class="uk-text-primary uk-text-bolder" id="SWAP_${idCELL}"> --- </span><br>
                        <a href="${urlsCEX.tradePair}" target="_blank">
                            <span class="sell" id="SELL_${idCELL}"> --- </span>
                        </a><br>
                        <hr class="uk-divider-small uk-margin-remove">
                        <span class="uk-text-primary" id="RESULT_${idCELL}"> --- </span>
                    </td>
                `;
            });

            row.innerHTML += `
                <td style="text-align:center; vertical-align: middle;" class="uk-text-danger">
                    <a href="${urlsCEX.tradePair}" target="_blank">
                        <span id="SELL_${data.cex}_${data.symbol_in}_${data.symbol_out}_${DTChain.Nama_Chain.toUpperCase()}">PRICE & VOL SELL <br>${data.cex}</span>
                    </a>
                </td>
            `;

            fragment.appendChild(row);
        });

        $tableBody.append(fragment);

        // Perbarui total token filter
        $('#tokenCount').text(`${filteredData.length}`);

        const jml = DataTokens.filter(t => t.status === true).length;
        $('#tokenCountALL').text(`TOTAL ALL: ${jml} PAIR-TOKEN`);  

        // Sembunyikan status loading setelah selesai
        $InfoStatus.text("SELESAI, Memuat DATA TOKEN !!");
        $("#startSCAN").show();
        setTimeout(() => $InfoStatus.fadeOut(), 2000);
        //beri warna header
        $(".table-header th").css({
            "background-color": selectedChain.WARNA, // Warna latar belakang header
            "color": "white",             // Warna teks
            "position": "sticky",         // Membuat header sticky
            "top": "0",
            "font-weight":"bolder",   
            "text-align":"center",                  // Tetap di bagian atas
            "z-index": "10"               // Prioritas tampilan
        });
        updateSortIcons();
    }

    $(document).on('change', '.statusCheckbox', function(event) {
        event.preventDefault(); // Mencegah tindakan default
        const id = $(this).data('id');
        const no = $(this).data('index');
        const isChecked = $(this).prop('checked');
        const storedData = getFromLocalStorage('TOKEN_SCANNER', []);
        const token = storedData.find(t => t.no === no);
        const jml = storedData.filter(t => t.status === true).length;

        if (token) {
            token.status = isChecked;
            saveToLocalStorage('TOKEN_SCANNER', storedData);
            toastr.info(`Berhasil mengubah status PAIR ${token.symbol_in}-${token.symbol_out}!`);
            $(`td[data-index="${id}"]`).remove();
            $('tr[data-index="' + id + '"]').hide();

            $('#tokenCountALL').text(`TOTAL : ${jml} ALL PAIR-TOKEN`);     
        }
       
    });
   
    function GeturlExchanger(cex, NameToken, NamePair) {
        // Konversi nama token dan pasangan ke uppercase
        const token = NameToken.toUpperCase();
        const pair = NamePair.toUpperCase();

        let baseUrlTradeToken = null;
        let baseUrlTradePair = null;
        let baseUrlWithdraw = null;
        let baseUrlDeposit = null;

        // Menentukan URL berdasarkan nilai cex
        if (cex === "GATE") {
            baseUrlTradeToken = `https://www.gate.io/trade/${token}_USDT`;
            baseUrlTradePair = `https://www.gate.io/trade/${pair}_USDT`;
            baseUrlWithdraw = `https://www.gate.io/myaccount/withdraw/${token}`;
            baseUrlDeposit = `https://www.gate.io/myaccount/deposit/${pair}`;
        } else if (cex === "BINANCE") {
            baseUrlTradeToken = `https://www.binance.com/en/trade/${token}_USDT`;
            baseUrlTradePair = `https://www.binance.com/en/trade/${pair}_USDT`;
            baseUrlWithdraw = `https://www.binance.com/en/my/wallet/account/main/withdrawal/crypto/${token}`;
            baseUrlDeposit = `https://www.binance.com/en/my/wallet/account/main/deposit/crypto/${pair}`;
        } else if (cex === "KUCOIN") {
            baseUrlTradeToken = `https://www.kucoin.com/trade/${token}-USDT`;
            baseUrlTradePair = `https://www.kucoin.com/trade/${pair}-USDT`;
            baseUrlWithdraw = `https://www.kucoin.com/assets/withdraw/${token}`;
            baseUrlDeposit = `https://www.kucoin.com/assets/coin/${pair}`;
        } else if (cex === "BITGET") {
            baseUrlTradeToken = `https://www.bitget.com/spot/${token}USDT`;
            baseUrlTradePair = `https://www.bitget.com/spot/${pair}USDT`;
            baseUrlWithdraw = `https://www.bitget.com/asset/withdraw`;
            baseUrlDeposit = `https://www.bitget.com/asset/recharge`;
        } else if (cex === "BYBIT") {
            baseUrlTradeToken = `https://www.bybit.com/en/trade/spot/${token}/USDT`;
            baseUrlTradePair = `https://www.bybit.com/en/trade/spot/${pair}/USDT`;
            baseUrlWithdraw = "https://www.bybit.com/user/assets/withdraw";
            baseUrlDeposit = "https://www.bybit.com/user/assets/deposit";
        } else if (cex === "MEXC") {
            baseUrlTradeToken = `https://www.mexc.com/exchange/${token}_USDT?_from=search`;
            baseUrlTradePair = `https://www.mexc.com/exchange/${pair}_USDT?_from=search`;
            baseUrlWithdraw = `https://www.mexc.com/assets/withdraw/${token}`;
            baseUrlDeposit = `https://www.mexc.com/assets/deposit/${pair}`;
        } else if (cex === "OKX") {
            baseUrlTradeToken = `https://www.okx.com/trade-spot/${token}-usdt`;
            baseUrlTradePair = `https://www.okx.com/trade-spot/${pair}-usdt`;
            baseUrlWithdraw = `https://www.okx.com/balance/withdrawal/${token}-chain`;
            baseUrlDeposit = `https://www.okx.com/balance/recharge/${pair}`;
        }

        // Kembalikan objek URL
        return {
            tradeToken: baseUrlTradeToken,
            tradePair: baseUrlTradePair,
            withdrawUrl: baseUrlWithdraw,
            depositUrl: baseUrlDeposit
        };
    }

    // Menampilkan form settingan
    $("#SettingModal").on("click", function () {
        UIkit.modal("#modal-setting").show(); // Menampilkan modal settingan
        let appSettings = getFromLocalStorage('DATA_SETTING', {}); // Ambil data pengaturan dari localStorage

        // Daftar DEX yang digunakan, diambil dari DTChain.DEXS
        const dexList = DTChain.DEXS || []; // Pastikan DTChain.DEXS ada, jika tidak gunakan array kosong
       // console.log(dexList);
        // Fungsi untuk memuat pengaturan ke dalam form
        function loadSettings() {
            // Gunakan fungsi generateInputModal untuk membuat input DEX
            generateInputModal(dexList);

            // Isi nilai modal DEX dari appSettings
            dexList.forEach((dex) => {
                const modalValue = appSettings[`MODAL_${dex.toUpperCase()}`] || "0";
                $(`#Modal${dex.toUpperCase()}`).val(modalValue); // Isi input dengan nilai yang sesuai
            });

            // Isi setting scanner
            $('#user').val(appSettings.nickname || ''); // Nickname
            $('#inFilterPNL').val(appSettings.filterPNL || 0); // Filter PNL
            $('#jeda-time-group').val(appSettings.jedaTimeGroup || 400); // Jeda Time Group
            $('#jeda-koin').val(appSettings.jedaKoin || 200); // Jeda Koin
            $('#walletMeta').val(appSettings.walletMeta || ''); // Wallet MetaMask
            $('#speedScan').val(appSettings.speedScan || 4); // Speed Scan

            // Pilih radio button sesuai nilai yang ada di setting
            $(`input[name="koin-group"][value="${appSettings.scanPerKoin || 10}"]`).prop('checked', true);
            $(`input[name="waktu-tunggu"][value="${appSettings.speedScan || 4}"]`).prop('checked', true);
        }

        // Panggil fungsi untuk memuat pengaturan
        loadSettings();
    });

    // simpan setingan
    $('#save-config').on('click', function() {
        let nickname = $('#user').val();
        let filterPNL = $('#inFilterPNL').val();
        let jedaTimeGroup = $('#jeda-time-group').val();
        let jedaKoin = $('#jeda-koin').val();
        let walletMeta = $('#walletMeta').val();

        if (!nickname || !filterPNL || !jedaTimeGroup || !jedaKoin || !walletMeta) {
            alert('SEMUA HARUS DIISI!');
            return;
        }

        let scanPerKoin = $('input[name="koin-group"]:checked').val();
        let speedScan = $('input[name="waktu-tunggu"]:checked').val();

        let dexData = {};
        DTChain.DEXS.forEach(dex => {
            let modalValue = $(`#Modal${dex.toUpperCase()}`).val();
            if (modalValue) {
                dexData[`MODAL_${dex.toUpperCase()}`] = modalValue;
            }
        });

        // Ambil data lama
        let oldData = getFromLocalStorage('DATA_SETTING', {});

        // Gabungkan data lama dan baru
        let appSettings = {
            ...oldData,
            ...dexData,
            nickname: nickname,
            filterPNL: filterPNL,
            jedaTimeGroup: jedaTimeGroup,
            jedaKoin: jedaKoin,
            walletMeta: walletMeta,
            scanPerKoin: scanPerKoin,
            speedScan: speedScan
        };

        saveToLocalStorage('DATA_SETTING', appSettings);

        UIkit.modal("#modal-setting").hide();
        alert("SIMPAN SETTING APLIKASI BERHASIL!!");
        location.reload();
    });

    $(document).on('change', '#cex-options input[type="checkbox"], #dex-options input[type="checkbox"], #dexpair-options input[type="checkbox"]', function() {
        // Menentukan kategori checkbox berdasarkan ID
        const groupName = $(this).closest('div[id^="cex-options"], div[id^="dex-options"], div[id^="dexpair-options"]').attr('id');
        let selectedValues = [];
        $(`#${groupName} input[type="checkbox"]:checked`).each(function() {
            selectedValues.push($(this).val());
        });

        // Tentukan key lokalStorage berdasarkan groupName
        const localStorageKeyMap = {
            'cex-options': 'CEX_PILIH',
            'dex-options': 'DEX_PILIH',
            'dexpair-options': 'DEXPAIR_PILIH'
        };
        const localStorageKey = localStorageKeyMap[groupName];

        if (localStorageKey) {
            saveToLocalStorage(localStorageKey, selectedValues);  // Simpan ke localStorage
            UIkit.notification(`SETTING APLIKASI ${groupName.toUpperCase()} menjadi ${selectedValues.join(', ')} !`, { status: 'success' });
        }

        // Memanggil fungsi filter dan reload data
        const filteredTokens = filterTokens(selectedValues);  // Pastikan filterTokens menerima nilai yang difilter
        loadStoredData(filteredTokens); 
        
        location.reload()
        // Memuat data yang sudah difilter
    });

    // Fungsi untuk mengurutkan tabel
    function sortTable(columnIndex) {
        const rows = $('#dataTableBody tr').get();

        rows.sort(function(a, b) {
            const keyA = $(a).children('td').eq(columnIndex).text().toUpperCase();
            const keyB = $(b).children('td').eq(columnIndex).text().toUpperCase();

            if (sortOrder[columnIndex] === undefined) {
                sortOrder[columnIndex] = true; // Default ke urutan naik
            }

            if (keyA < keyB) return sortOrder[columnIndex] ? -1 : 1;
            if (keyA > keyB) return sortOrder[columnIndex] ? 1 : -1;
            return 0;
        });

        // Kosongkan tabel dan tambahkan kembali baris yang sudah diurutkan
        $('#dataTableBody').empty().append(rows);

        // Update kolom No agar tetap berurutan
        $('#dataTableBody tr').each((index, row) => {
            $(row).children('td').first().text(index + 1); // Set nomor berurutan
        });

        // Toggle urutan untuk kolom yang sama
        sortOrder[columnIndex] = !sortOrder[columnIndex];
        updateSortIcons();
    }

    // Memperbarui ikon urutan
    function updateSortIcons() {
        $('.sort-icon').html(''); // Reset semua ikon
        for (let index in sortOrder) {
            const icon = sortOrder[index] ? '▲' : '▼';
            $('#sortIcon' + index).html(icon);
        }
    }

    //fungsi generate setting modal untuk DEX
    function generateInputModal(dexList) {
        const container = $('#modal-container');
        container.empty(); // Bersihkan container
        dexList.forEach(dex => {
            // Mengubah nama dex menjadi huruf besar
            const dexUpperCase = dex.toUpperCase();
            // Membuat heading
            const heading = $('<h5></h5>')
                .css({ 'margin': '8px 0px', 'color': '#e4322c' })
                .text(`Modal ${dexUpperCase}`);
            
            container.append(heading);

            // Membuat modal div
            const modalDiv = $('<div></div>');
            // Input modal
            const modalInput = $('<input>')
                .attr('type', 'number')
                .attr('id', `Modal${dexUpperCase}`)
                .addClass('uk-input')
                .val('0')
                .attr('required', true);
            // Tambahkan label dan input ke modal div
            modalDiv.append(modalInput);

            // Tambahkan modal div ke container
            container.append(modalDiv);
        });
    }

    // Fungsi untuk memproses data order book umum
    function processOrderBook(data) {
        const priceBuy = data.bids.slice(0, 4).map(([price, volume]) => ({
            price: parseFloat(price),
            volume: parseFloat(volume) * parseFloat(price) // Volume dalam USD
        }));
        const priceSell = data.asks.slice(0, 4).map(([price, volume]) => ({
            price: parseFloat(price),
            volume: parseFloat(volume) * parseFloat(price) // Volume dalam USD
        }));
        return { priceBuy, priceSell };
    }

    // Fungsi cek harga pada CEX
    function getPriceCEX(coins, NameToken, NamePair, cex, callback) {
        const config = exchangeConfig[cex];

        if (!config) {
            callback(`Exchange ${cex} tidak ditemukan dalam konfigurasi.`, null);
            return;
        }

         // Ambil data TOKEN_SCANNER dari localStorage
        const feeList = getFromLocalStorage("TOKEN_SCANNER", []);
        if (!Array.isArray(feeList) || feeList.length === 0) {
            toastr.error("PERIKSA ULANG FEE WD dari EXCHANGER !!");
            callback("Token scanner belum diatur.", null);
            return;
        }

        // Cari token yang sesuai berdasarkan symbol dan cex
        const tokenData = feeList.find(item => item.symbol_in === NameToken && item.cex === cex);
        if (!tokenData) {
            toastr.error(`Token ${coins.symbol} untuk CEX ${cex} tidak ditemukan di TOKEN_SCANNER`);
            callback(`Token ${coins.symbol} untuk CEX ${cex} tidak ditemukan.`, null);
            return;
        }

        const isUSDT = (token) => token === "USDT";
        let results = {};

        const urls = [
            isUSDT(NameToken) ? null : config.url({ symbol: NameToken }),
            isUSDT(NamePair) ? null : config.url({ symbol: NamePair })
        ];

        // Fungsi untuk memproses hasil jika kedua token sudah mendapatkan harga
        const processFinalResult = () => {
            if (Object.keys(results).length === 2) {
                const feeWD = tokenData.feeWDs * results[NameToken].price_buy;
                // Validasi feeWD kosong atau tidak valid
               
                if (feeWD === null || feeWD === 'N/A' || isNaN(feeWD)) {
                    callback(`FeeWD untuk ${NameToken} di ${cex} tidak valid. ${feeWD}`, null);
                    return;
                }

                const finalResult = {
                    token: NameToken.toUpperCase(),
                    sc_input: coins.sc_in,
                    sc_output: coins.sc_out,
                    pair: NamePair.toUpperCase(),
                    cex: cex.toUpperCase(),
                    price_sellToken: results[NameToken].price_sell,
                    price_buyToken: results[NameToken].price_buy,
                    price_sellPair: results[NamePair].price_sell,
                    price_buyPair: results[NamePair].price_buy,
                    volumes_sellToken: results[NameToken].volumes_sell,
                    volumes_buyToken: results[NameToken].volumes_buy,
                    volumes_sellPair: results[NamePair].volumes_sell,
                    volumes_buyPair: results[NamePair].volumes_buy,
                    feeWD: feeWD // Fee dihitung setelah harga diperoleh
                };

                updateTableVolCEX({}, finalResult, cex);
                callback(null, finalResult);
            }
        };

        // Iterasi untuk setiap token/pair dan memproses data
        urls.forEach((url, index) => {
            const tokenName = index === 0 ? NameToken : NamePair;

            if (isUSDT(tokenName)) {
                const feeWD = tokenData.feeWDs * 1;
                // Jika token adalah USDT, gunakan nilai default
                results[tokenName] = {
                    price_sell: 1,
                    price_buy: 1,
                    volumes_sell: [{ price: 1, volume: 1000000 }],
                    volumes_buy: [{ price: 1, volume: 1000000 }],
                    feeWD:feeWD
                };
                processFinalResult(); // Cek jika kedua token sudah diproses
                return;
            }

            if (url) {
                $.ajax({
                    url: url,
                    method: 'GET',
                    success: function (data) {
                        let processedData;
                        try {
                            processedData = config.processData(data);
                        } catch (error) {
                            console.error(`Error processing data untuk ${tokenName} di ${cex}:`, error);
                            callback(`Error processing data untuk ${tokenName} di ${cex}.`, null);
                            return;
                        }

                        const priceBuy = processedData.priceSell[0]?.price || null;
                        const priceSell = processedData.priceBuy[0]?.price || null;

                        if (priceBuy === null || priceSell === null) {
                            callback(`Harga buy/sell untuk ${tokenName} di ${cex} tidak tersedia.`, null);
                            return;
                        }

                        results[tokenName] = {
                            price_sell: priceSell,
                            price_buy: priceBuy,
                            volumes_sell: processedData.priceBuy,
                            volumes_buy: processedData.priceSell
                        };

                        processFinalResult(); // Cek jika kedua token sudah diproses
                    },
                    error: function (xhr) {
                        const errorMessage = xhr.responseJSON?.msg || "Unknown ERROR";
                       // toastr.warning(`ERROR: ${errorMessage}, KONEKSI ${cex.toUpperCase()} GAGAL TOKEN ${tokenName}`);
                        callback(`Error koneksi API untuk ${tokenName} di ${cex}: ${errorMessage}`, null);
                    }
                });
            }
        });
    }

    // Fungsi update price & vol untuk token dan pair
   function updateTableVolCEX(processedData, finalResult, cex) {
        const cexName = cex.toUpperCase();
        const TokenPair = finalResult.token + "_" + finalResult.pair;
        
        // Pengecekan jika token bernilai "USDT" untuk id=buy
        if (finalResult.token === "USDT") {
            $('#BUY_' + cexName + '_' + TokenPair+'_'+ (DTChain.Nama_Chain).toUpperCase()).html(
                `<span class='uk-text-secondary uk-text-bolder' style="color: black;">~</span><br/>`
            );
        } else {
            $('#BUY_' + cexName + '_' + TokenPair+'_'+ (DTChain.Nama_Chain).toUpperCase()).html(
                `<span class='uk-text-secondary uk-text-bolder'>USDT -> ${finalResult.token}</span><br/>` +  // Menambahkan teks "USDT -> token"
                finalResult.volumes_buyToken.map((data, index) => {
                    return `${formatPrice(data.price || 0)} : <b>${data.volume.toFixed(2) || 0}$</b><br/>`;
                }).join('') 
            );
            
            $('#feeWDUSDT_' + cexName + '_' + TokenPair+'_'+ (DTChain.Nama_Chain).toUpperCase()).text(`FEE WD: ${(finalResult.feeWD).toFixed(2)}$`);
        }

        // Pengecekan jika pair bernilai "USDT" untuk id=sell
        if (finalResult.pair === "USDT") {
            $('#SELL_' + cexName + '_' + TokenPair+'_'+ (DTChain.Nama_Chain).toUpperCase()).html(
                `<span class='uk-text-secondary uk-text-bolder' style="color: black;">~</span><br/>`
            );
        } else {
            $('#SELL_' + cexName + '_' + TokenPair+'_'+ (DTChain.Nama_Chain).toUpperCase()).html(
                `<span class='uk-text-secondary uk-text-bolder'>${finalResult.pair} -> USDT</span><br/>` +  // Menambahkan teks "pair -> USDT"
                finalResult.volumes_sellPair.map((data, index) => {
                    return `${formatPrice(data.price || 0)} : <b>${data.volume.toFixed(2) || 0}$</b><br/>`;
                }).join('')
            );
        }
    }

    // list api OKXDEX sell_BINANCE_USDT_buy_0x_BAL
    const apiKeysOKXDEX = [
        
        {
            ApiKeyOKX: "71cbe094-380a-4146-b619-e81a254c0702",
            secretKeyOKX: "5116D48C1847EB2D7BDD6DDD1FC8B199",
            PassphraseOKX: "Macpro-2025",
            ProjectOKX: "249fb586f1aa8adadfd2fa5cbb05369e"
        },
        {
            ApiKeyOKX: "6866441f-6510-4175-b032-342ad6798817",
            secretKeyOKX: "E6E4285106CB101B39FECC385B64CAB1",
            PassphraseOKX: "Arekpinter123.",
            ProjectOKX: "828fe20c82773f89a150969601e75688"
        },
        {
            ApiKeyOKX: "5b36b05d-3e44-4809-abde-9c9cadac81f3",
            secretKeyOKX: "0DC0BF7BE076060AE11A4913DBC0E1AF",
            PassphraseOKX: "Macpro-2025",
            ProjectOKX: "1a6117057281caf1d8ff802bab7e5572"
        },
        {
          ProjectOKX : "4f02cf60cca8c0356cbffaeb3ae3de65",
          secretKeyOKX : "02FF179B12209C442E30A2FF0232227E",
          PassphraseOKX : "Macpro-2025",
          ApiKeyOKX : "3d8ad489-48fe-4d15-b250-7e1c5b1721d1",   
        },
        {
          ProjectOKX : "b61421c36f7a6c9c803a1c0c85db41a6",
          secretKeyOKX : "C4D93507CDB6CC3602A0CDF46D365066",
          PassphraseOKX : "Macpro-2025",
          ApiKeyOKX : "31d3bd0a-15f8-437f-9b01-e84178b81a06",   
        },
        {
            ProjectOKX: "4e8e5c10716f26e58caf88acecbd2b06",
            ApiKeyOKX: "9d00b601-2763-463e-ab4a-d970823ff4b2",
            PassphraseOKX: "Arekpinter123.",
            secretKeyOKX: "4409A9102D8010AD94237AB29A285827"
        },
        {
            ProjectOKX: "7c18497a161e2a3475929a63527beb17",
            ApiKeyOKX: "d6563639-c3be-4ab0-b38f-0b6ddf1dd7a5",
            PassphraseOKX: "Arekpinter123.",
            secretKeyOKX: "39178E81182DF92B6FF29FB745E28744"
        },
        {
            ProjectOKX: "e1db35c604b45dab958ae051f4e8de8c",
            ApiKeyOKX: "0937cffb-702b-4aeb-97bf-2df2ec32a0f7",
            PassphraseOKX: "Arekpinter123.",
            secretKeyOKX: "183E0893CFA33CBFC2ADFAEB4592B806",
        },
        {
            ProjectOKX: "f19ab2804dc1352379b0ffb62c6d40ee",
            ApiKeyOKX: "f0814b42-e9a6-4c5c-b606-3b705b87ba2b",
            PassphraseOKX: "Arekpinter123.",
            secretKeyOKX: "5A19C7452C6170E5E482693CFCC1C4FF",
        }
        ,
        {
            ProjectOKX: "ffca925f3b8e90eb010f89e65e04c186",
            ApiKeyOKX: "9093d88d-5008-4a30-a612-4a01c1c64bda",
            PassphraseOKX: "Arbit_2024",
            secretKeyOKX: "2E32CDC680B831D5A027207EBB9546E2",
        },
        {
            ProjectOKX: "2a027ce25366154188b4258d0491028a",
            ApiKeyOKX: "d60050cc-7178-4e34-b22e-9310add9aa69",
            PassphraseOKX: "Arbit_no2924",
            secretKeyOKX: "149C85E24E7B913D6ADBFDAFE87EB1B7",
        },
        {
            ProjectOKX: "874f428a20a2213341aac0b8459ff07f",
            ApiKeyOKX: "f6643472-5067-487a-a35c-82e83cd032e7",
            PassphraseOKX: "Arbit_no2924",
            secretKeyOKX: "30D76E03A311D8CAB73850444AFFF657",
        },
        {
            ProjectOKX: "9df4ee53d0c6659613951ca3f2b0c068",
            ApiKeyOKX: "30b17241-0007-4b95-9f86-c071a9351b66",
            PassphraseOKX: "Arbit_2024",
            secretKeyOKX: "23697133A4193CF858E866D10BEEA1F8",
        },
        {
            ProjectOKX: "30f6b2a4cc5211ce6d18afe9fb335318",
            ApiKeyOKX: "83d9e3df-4aab-42fd-aac7-07c30dc48cec",
            PassphraseOKX: "Arbit_2024",
            secretKeyOKX: "E1362DFC278BB826966224324B9E1EC5",
        },       
        {
            ProjectOKX: " 576ec3bb953a4245d190be804e590f34",
            ApiKeyOKX: "fcd9327d-fcf7-42d3-aae6-c9c46d18b91c",
            secretKeyOKX: "5528624D45062CC632BB4D40DD152798",
            PassphraseOKX: "999999-Dd"
        },
        {
            ProjectOKX: " 9a019d1a795cd6eb318921c4cd1d69db",
            ApiKeyOKX: "ae2ad3e8-cbce-4529-a997-d9fe70e5cc1a",
            secretKeyOKX: "2DE1392A54553D37E977CF73C74CEF10",
            PassphraseOKX: "999999-Dd"
        },
        {
            ProjectOKX: " 3991a6cb57c07b5f2a4551fb645dd8da",
            ApiKeyOKX: "9ef5d944-d5df-452b-a014-547d46c54591",
            secretKeyOKX: "FA7A6413591685741CC455315C137703",
            PassphraseOKX: "999999-Dd"
        },
        {
            ProjectOKX: " 809f52336548c0f1315a370464c716b4",
            ApiKeyOKX: "2ab14b8f-cd94-412a-9e40-01a933bb122c",
            secretKeyOKX: "3F3D0C85B1DA3412C16CBE6C2556B43F",
            PassphraseOKX: "999999-Dd"
        },
        {
            ProjectOKX: " 714ae731200f3ea90e0c65d3b4ff51be",
            ApiKeyOKX: "b945ef02-7db5-461b-a59d-d188660074f0",
            secretKeyOKX: "ACA6CAFFACADD28E84EACCC4830C553E",
            PassphraseOKX: "999999-Dd"
        },
        {
            ProjectOKX: " 732d13c49fc8a11daadf03ff31ed3aab",
            ApiKeyOKX: "abd88215-dbe8-4a8a-ab0e-1f10e5a3db37",
            secretKeyOKX: "CEA9B5107AC1CF503F80998D53E56CC5",
            PassphraseOKX: "999999-Dd"
        },
        
      ];
      
       // Fungsi untuk Signature
    function calculateSignature(exchange, apiSecret, dataToSign, hashMethod = "HmacSHA256") {
        if (!apiSecret || !dataToSign) {
            console.error(`[${exchange}] API Secret atau Data untuk Signature tidak valid!`);
            return null;
        }
    
        switch (exchange.toUpperCase()) {
            case "MEXC":
            case "BINANCE":
            case "KUCOIN":
            case "BYBIT":
                // Gunakan HMAC-SHA256
                return CryptoJS[hashMethod](dataToSign, apiSecret).toString(CryptoJS.enc.Hex);
    
            case "OKX":
                // Gunakan BASE64 untuk OKX
                const hmac = CryptoJS.HmacSHA256(dataToSign, apiSecret);
                return CryptoJS.enc.Base64.stringify(hmac);
    
            default:
                console.error(`[${exchange}] Exchange tidak didukung untuk perhitungan signature.`);
                return null;
        }
    } 
    
      // Fungsi untuk mendapatkan kredensial API secara acak
      function getRandomApiKeyOKX() {
        const randomIndex = Math.floor(Math.random() * apiKeysOKXDEX.length);
        return apiKeysOKXDEX[randomIndex];
      }

      function ResultEksekusi(DataDEX, DataCEX, Modal, amount_in, priceBuyToken_CEX, priceSellToken_CEX, priceBuyPair_CEX, priceSellPair_CEX, NameToken, NamePair, dextype) {
         var TokenPair = NameToken+"_"+NamePair;  
         var amount_out = Number(DataDEX.amount_out);
         var FeeSwap = parseFloat(DataDEX.FeeSwap);
         var FeeWD = parseFloat(DataCEX.feeWD);
         var FeeTrade = parseFloat(0.002 * Modal);
         
         // Hitung Harga Rata-rata
         var rateSellTokenDEX = (amount_out * priceSellPair_CEX) / amount_in; // Harga rata-rata jual NameToken di DEX
         var rateBuyPairDEX = (amount_in * priceBuyToken_CEX) / amount_out;
         var rateTokentoPair = amount_out / amount_in; // Menghitung rate MDT per BNT atau per jumlah yang dibeli
     
         // Hitung Nilai Akhir dan P&L
         var totalModal = Modal + FeeSwap + FeeWD + FeeTrade; // Modal awal (USDT)
         var totalFee = FeeSwap + FeeWD + FeeTrade; // Total biaya (USDT)
         var totalValue = amount_out * priceSellPair_CEX; // Nilai akhir (USDT)
         var profitLoss = totalValue - totalModal; // Profit or Loss (USDT)
         var profitLossPercent = totalModal !== 0 ? (profitLoss / totalModal) * 100 : 0; // Profit or Loss (%)
         var filterPNLValue = parseFloat(SavedSettingData.filterPNL);
         // == 0 ? totalFee + (Modal * 0.2 / 100) : parseFloat(SavedSettingData.FilterPNL);
         
         var conlusion="NO SELISIH";
         var selisih =false;
        // Jika filter PNL adalah 0, bandingkan nilai akhir dengan modal + semua biaya
        if (filterPNLValue == 0) {
            if (totalValue > totalModal + totalFee) {
                conlusion = "GET SIGNAL";
                selisih=true;
            }
        }
        // Jika filter PNL bukan 0, bandingkan selisih nilai akhir dan modal dengan filter PNL
        else {
            if ((totalValue - totalModal) > filterPNLValue) {
                conlusion = "GET SIGNAL";
                selisih=true;
            }
        }         // Output log
       
         console.log("-----------------------");
         console.log("" + NameToken + "/" + NamePair +"("+DataCEX.cex.toUpperCase()+" VS " + dextype.toUpperCase()+")");
         if(selisih){
            console.log(" Modal : " + Modal);
            console.log("--------------- HARGA & PROSES CEX ");
            console.log("Rate Beli Token " + NameToken + "/USDT di CEX:", priceBuyToken_CEX, "USDT");
            console.log("Rate Jual Token " + NameToken + "/USDT di CEX:", priceSellToken_CEX, "USDT");
            console.log("Jumlah HASIL Beli USDT => " + NameToken + " di CEX:", amount_in, NameToken);
            console.log("Rate Beli Pair " + NamePair + "/USDT di CEX:", priceBuyPair_CEX, "USDT");
            console.log("Rate Jual Pair " + NamePair + "/USDT di CEX:", priceSellPair_CEX, "USDT");
            console.log("--------------- HARGA & PROSES SWAP DEX");
            console.log("Jumlah HASIL SWAP " + NameToken + "=>" + NamePair + " di DEX:", amount_out, NamePair);     
            console.log("Rate Jual " + NameToken + "=>USDT di DEX:", rateSellTokenDEX.toFixed(4), "USDT");
            console.log("Rate " + NamePair + "=>" + NameToken + " di DEX:", rateTokentoPair.toFixed(10));
            console.log("Rate Beli USDT => " + NamePair + " di DEX:", rateBuyPairDEX.toFixed(4), "USDT");
            
            console.log("--------------- KESIMPULAN ");
            console.log("Modal Awal (USDT):", Modal, "USDT");
            console.log(`All Fee => Swap: ${FeeSwap.toFixed(2)} , WD: ${FeeWD.toFixed(2)} , Trade: ${FeeTrade.toFixed(2)} = ${totalFee.toFixed(2)}`);
            console.log("Modal Awal (USDT) + FEE:", totalModal.toFixed(2), "USDT");        
            console.log("Filter PNL:", filterPNLValue.toFixed(4), "USDT");
            console.log("Nilai Akhir (USDT):", totalValue.toFixed(4), "USDT");
            console.log("Profit/Loss (USDT):", profitLoss.toFixed(4), "USDT");
            console.log("Profit/Loss (%):", profitLossPercent.toFixed(2), "%");
            console.log("###################################");
            console.log(`${conlusion} => ${NameToken}/${NamePair} on ${DataCEX.cex.toUpperCase()}`);
            console.log("###################################");
        }else {
            console.log("NO SELISIH");
        }
         let IdCELL = `${DataCEX.cex.toUpperCase()}_${dextype.toUpperCase()}_${TokenPair}_${(DTChain.Nama_Chain).toUpperCase()}`;
         var linkDEX = generateDexLink(dextype.toLowerCase(), NameToken, DataCEX.sc_input, NamePair, DataCEX.sc_output);
    
        if (!linkDEX) {
            console.error(`DEX Type "${dexType}" tidak valid atau belum didukung.`);
            return;
        }
        
        if (NameToken == "USDT") {
            var RateSwap = `<label class="uk-text-success" title="${formatPrice(rateTokentoPair)} ${NameToken}-${NamePair}"> ${formatPrice(rateBuyPairDEX)} ${NamePair}</label>`;
        }else if(NamePair == "USDT"){
            var RateSwap = `<label class="uk-text-danger" title="${formatPrice(rateTokentoPair)} ${NameToken}-${NamePair}"> ${formatPrice(rateTokentoPair)} ${NameToken}</label>`; // Kosongkan jika salah satunya adalah USDT
        }else  {
            var RateSwap = ` <label class="uk-text-primary" title="${formatPrice(rateSellTokenDEX)} ${NameToken}  ${formatPrice(rateBuyPairDEX)} ${NamePair}">${formatPrice(rateTokentoPair)} ${NameToken}-${NamePair}</label>`;
        }  

        // Cek apakah elemen dengan ID ada di DOM
        if ($(`#SWAP_${IdCELL}`).length > 0) {
            $(`#SWAP_${IdCELL}`).html(`<a href="${linkDEX}" target="_blank">  ${RateSwap} `);           
        }

       DisplayPNL( profitLoss,  DataCEX.cex,  NameToken, TokenPair, totalFee, Modal, dextype, priceBuyToken_CEX, rateSellTokenDEX, FeeSwap, FeeWD, DataDEX.sc_input, DataDEX.sc_output, NamePair,totalValue,totalModal,conlusion,selisih );
        
     }

     // Fungsi INFO SINYAL
     function DisplayPNL(PNL, cex, NameToken, TokenPair, totalFee, modal, dex, priceCEX, priceDEX, FeeSwap, FeeWD, sc_input, sc_output, pairdex, totalValue, totalModal, conclusion, selisih) {
        var filterPNLValue = parseFloat(SavedSettingData.filterPNL);
        var nickname = SavedSettingData.nickname;
        var totalValue = parseFloat(totalValue);
        var totalGet = parseFloat(totalValue)-parseFloat(modal);
        var totalModal = parseFloat(totalModal);
        var totalFee = parseFloat(totalFee);

        var IdCELL = `${cex.toUpperCase()}_${dex.toUpperCase()}_${TokenPair}_${(DTChain.Nama_Chain).toUpperCase()}`;
        var resultCell = $(`#RESULT_${IdCELL}`);
        var buyCell = $(`#BUY_${IdCELL}`);
        var sellCell = $(`#SELL_${IdCELL}`);
        var rowCell = $(`#${IdCELL}`);

        var sinyals = ` <a href="#SWAP_${cex.toUpperCase()}_${dex.toUpperCase()}_${TokenPair}_${(DTChain.Nama_Chain).toUpperCase()}" class='link-class'>
            ${cex.toUpperCase()} VS ${dex.toUpperCase()} : ${TokenPair} (${(PNL).toFixed(2)})</a> | `;

        // Simplified condition check
        var isPositivePNL = (filterPNLValue === 0 && totalValue > totalModal) || ((totalValue - totalModal) > filterPNLValue);
        //var isPositivePNL = (filterPNLValue === 0 && totalValue > totalModal + totalFee) || ((totalValue - totalModal) > filterPNLValue);

        if (isPositivePNL) {
            toastr.info(sinyals);

            rowCell.css({'background-color': '#c2f890','font-weight':'bolder'});
            resultCell.html(`
                <span class="uk-text-danger">FEE:${totalFee.toFixed(2)}$</span>
                <span class="uk-text-primary">SW:${FeeSwap.toFixed(2)}$</span><br/>
                <span class="uk-text-warning">GET:${(totalGet).toFixed(2)}$</span>
                 <span class="uk-text-secondary" >PNL:${(PNL).toFixed(2)}$</span>
            `);

            InfoSinyal(dex.toLowerCase(), TokenPair, PNL, totalFee, cex.toUpperCase(), NameToken, pairdex);
        } else {
            resultCell.html(`
                <span class="uk-text-danger">FEE:${totalFee.toFixed(2)}$</span>
                <span class="uk-text-primary">SW:${FeeSwap.toFixed(2)}$</span><br/>
                <span class="uk-text-warning">GET:${(totalGet).toFixed(2)}$</span>
                 <span class="uk-text-secondary" >PNL:${(PNL).toFixed(2)}$</span>
            `);
        }

        // Send message if PNL > 2
        if (PNL > 2) {
            MultisendMessage(cex, dex.toUpperCase(), NameToken,pairdex, modal, PNL, priceCEX, priceDEX, FeeSwap, FeeWD, totalFee, nickname);
        }
    }


    // Fungsi untuk menampilkan sinyal hasil scan dan memutar suara
    function InfoSinyal(DEXPLUS, TokenPair, PNL, totalFee, cex, NameToken, NamePair) {
        // Menentukan warna teks berdasarkan `cex` menggunakan fungsi getWarnaCEX
        var warnaCEX = getWarnaCEX(cex);
        let idCELL = `${cex.toUpperCase()}_${DEXPLUS.toUpperCase()}_${NameToken}_${NamePair}_${(DTChain.Nama_Chain).toUpperCase()}`;
        
        // Membuat link dengan format umum tanpa pengecekan kondisi
        var sLink = `<a href=#SWAP_${idCELL} class='buy'>
            ${NameToken}->${NamePair}
            (<span style='color:${warnaCEX}; font-weight:bolder;'>${cex.toUpperCase()}:</span><span class="uk-text-secondary">${PNL.toFixed(2)}$</span>)
        </a>`;

        // Menambahkan link ke elemen dengan ID yang sesuai
        $("#sinyal" + DEXPLUS.toLowerCase()).append(` ${sLink} |`);
        
        var audio = new Audio('audio.mp3');  // Ganti dengan path file suara yang sesuai
        audio.play();
    }

    // Fungsi untuk mengecek harga pada DEX  
    function generateDexLink(dex, NameToken, sc_input, NamePair, sc_output) {
        const link = {
            'kyberswap': `https://kyberswap.com/swap/${DTChain.Nama_Chain}/${sc_input}-to-${sc_output}`,
            'paraswap': `https://app.paraswap.xyz/#/swap/${sc_input}-${sc_output}?version=6.2&network=${DTChain.Nama_Chain}`,
            'odos': "https://app.odos.xyz",
            '0x': `https://matcha.xyz/tokens/${DTChain.Nama_Chain}/${sc_input}?buyChain=${DTChain.Kode_Chain}&buyAddress=${sc_output}`,
            '1inch': `https://app.1inch.io/#/${DTChain.Kode_Chain}/advanced/swap/${sc_input}/${sc_output}`,
            'okx': `https://www.okx.com/web3/dex-swap?inputChain=${DTChain.Kode_Chain}&inputCurrency=${sc_input}&outputChain=501&outputCurrency=${sc_output}`,
            'magpie': `https://app.magpiefi.xyz/swap/${DTChain.Nama_Chain.toLowerCase()}/${NameToken.toUpperCase()}/${DTChain.Nama_Chain.toLowerCase()}/${NamePair.toUpperCase()}`,
            'jupiter': `https://jup.ag/swap/${sc_input}-${sc_output}`
        };

        return link[dex] || null;
    }

    function getPriceDEX(sc_input, des_input, sc_output, des_output, amount_in, PriceRate,  dexType, NameToken, NamePair, cex, callback) {
        var sc_input=sc_input.toLowerCase();
        var sc_output=sc_output.toLowerCase();
        var dexId = `${cex}_${dexType.toUpperCase()}_${NameToken}_${NamePair}_${(DTChain.Nama_Chain).toUpperCase()}`;
        var SavedSettingData = getFromLocalStorage('DATA_SETTING', {});
        var selectedApiKey = getRandomApiKeyOKX();
        var amount_in = BigInt(Math.round(Math.pow(10, des_input) * amount_in));
        var apiUrl, requestData,headers;   
        let normalizedNamePair = NamePair === "ETH" ? "WETH" :
                                NamePair === "BNB" ? "WBNB" :
                                NamePair === "POL" ? "WPOL" :
                                NamePair === "SOL" ? "WSOL" :
                                NamePair === "AVAX" ? "WAVAX" :
                                NamePair;
        var linkDEX = generateDexLink(dexType, NameToken, sc_input, NamePair, sc_output);

        switch (dexType) {
            case 'kyberswap':
                let NetChain;
                if (DTChain.Nama_Chain.toUpperCase() === "AVAX") {
                    NetChain = "avalanche";
                }else{
                    NetChain=DTChain.Nama_Chain;
                }
                apiUrl = "https://aggregator-api.kyberswap.com/" + NetChain.toLowerCase() + "/api/v1/routes?tokenIn=" + sc_input + "&tokenOut=" + sc_output + "&amountIn=" + amount_in+ "&gasInclude=true";
                break;
            case 'paraswap':
                apiUrl = "https://api.paraswap.io/prices?" + "srcToken=" + sc_input + "&srcDecimals=" + des_input + "&destToken=" + sc_output + "&destDecimals=" + des_output + "&side=SELL&network=" + DTChain.Kode_Chain + "&amount=" + amount_in + "&version=6.2";
                break;
            case 'odos':
                apiUrl = "https://api.odos.xyz/sor/quote/v2";
                requestData = {
                    chainId: DTChain.Kode_Chain,
                    inputTokens: [{ amount: amount_in.toString(), tokenAddress: sc_input }],
                    outputTokens: [{ proportion: 1, tokenAddress: sc_output }],
                    referralCode: 0,
                    slippageLimitPercent: 0.3,
                };
                break;
            case '0x':
                    if (DTChain.Nama_Chain.toLowerCase() === 'ethereum') {
                        apiUrl = "https://api.0x.org/swap/v1/quote?buyToken=" + sc_output + "&sellToken=" + sc_input + "&sellAmount=" + amount_in;
                    }else  if (DTChain.Nama_Chain.toLowerCase() === 'avax') {
                        apiUrl = "https://avalanche.api.0x.org/swap/v1/quote?buyToken=" + sc_output + "&sellToken=" + sc_input + "&sellAmount=" + amount_in;
                    } else {
                        apiUrl = "https://" + DTChain.Nama_Chain + ".api.0x.org/swap/v1/quote?buyToken=" + sc_output + "&sellToken=" + sc_input + "&sellAmount=" + amount_in;
                    }
                    break;
            case '1inch':
                    apiUrl = "https://api-defillama.1inch.io/v6.0/" + DTChain.Kode_Chain + "/quote?src=" + sc_input + "&dst=" + sc_output + "&amount=" + amount_in + "&includeGas=true";
                break;
            case 'magpie':
                    apiUrl = "https://api.magpiefi.xyz/aggregator/quote?network=" + DTChain.Nama_Chain + "&fromTokenAddress=" + sc_input + "&toTokenAddress=" + sc_output + "&sellAmount=" + amount_in + "&gasless=true&slippage=0.1";
                break;
            case 'okx':
                var queryString = `/api/v5/dex/aggregator/quote?amount=${amount_in}&chainId=${DTChain.Kode_Chain}` + `&fromTokenAddress=${sc_input}&toTokenAddress=${sc_output}`;
                var timestamp = new Date().toISOString();
                var method = "GET";
                var dataToSign = timestamp + method + queryString;
                apiUrl = `https://www.okx.com${queryString}`;

                var signature = calculateSignature("OKX",  selectedApiKey.secretKeyOKX, dataToSign, "BASE64");
                break;
            case 'jupiter':
                apiUrl = "https://quote-api.jup.ag/v6/quote?inputMint=" + sc_input + "&outputMint=" + sc_output + "&amount=" + amount_in;
                headers = {}; // Tidak memerlukan header khusus
                break;                 
            default:
                console.error("Unsupported DEX type");
                return;
        }
    
        $.ajax({
            url: apiUrl,
            method: ['odos', 'swoop'].includes(dexType) ? 'POST' : 'GET', // Cek tipe DEX
            headers: Object.assign(
                {}, 
                headers || {}, // Header tambahan dari variabel `headers`
                dexType === '0x' ? { '0x-api-key': "6f5d5c4d-bfdd-4fc7-8d3f-d3137094feb5" } : {},
                dexType === 'okx' ? {
                    "OK-ACCESS-PROJECT": selectedApiKey.ProjectOKX,
                    "OK-ACCESS-KEY": selectedApiKey.ApiKeyOKX,
                    "OK-ACCESS-SIGN": signature,
                    "OK-ACCESS-PASSPHRASE": selectedApiKey.PassphraseOKX,
                    "OK-ACCESS-TIMESTAMP": timestamp,
                } : {}
            ),
            data: ['odos', 'swoop'].includes(dexType) ? JSON.stringify(requestData) : requestData, // Format data berdasarkan tipe DEX
            contentType: ['odos', 'swoop'].includes(dexType) ? 'application/json' : undefined, // Set `contentType` hanya jika diperlukan
            timeout: parseInt(SavedSettingData.waktuTunggu) * 1000, // Ambil waktu tunggu dari localStorage atau default ke 0
            success: function (response, xhr) {
                //console.log("RESPONSE DEX: ",response)
                var amount_out = null, FeeSwap = null; // Default kosong
                try {
                        switch (dexType) {
                            case 'kyberswap':
                                amount_out = response.data.routeSummary.amountOut / Math.pow(10, des_output);
                                FeeSwap = ((response.data.routeSummary.gas / Math.pow(10, 9)) * parseFloat(getFromLocalStorage('gasGWEI', 0))) * parseFloat(getFromLocalStorage('PRICEGAS', 0)); // Menggunakan getFromLocalStorage
                                break;
                            case 'paraswap':
                                amount_out = response.priceRoute.destAmount / Math.pow(10, des_output);
                                FeeSwap = parseFloat(response.priceRoute.gasCostUSD);
                                break;
                            case 'odos':
                                amount_out = response.outValues / PriceRate; 
                                FeeSwap = response.gasEstimateValue;
                                break;
                            case '0x':
                                amount_out = response.buyAmount / Math.pow(10, des_output);
                                FeeSwap = ((response.estimatedGas / Math.pow(10, 9)) * parseFloat(getFromLocalStorage('gasGWEI', 0))) * parseFloat(getFromLocalStorage('PRICEGAS', 0)); // Menggunakan getFromLocalStorage
                                break;
                            case '1inch':
                                amount_out = parseFloat(response.dstAmount) / Math.pow(10, des_output);
                                FeeSwap = ((response.gas / Math.pow(10, 9) * parseFloat(getFromLocalStorage('gasGWEI', 0)))) * parseFloat(getFromLocalStorage('PRICEGAS', 0)); // Menggunakan getFromLocalStorage
                                break;
                            case 'magpie':
                                amount_out = parseFloat(response.amountOut) / Math.pow(10, des_output);
                                FeeSwap = parseFloat(response.fees[0].value);
                                break;    
                            case 'okx':
                                amount_out = response.data[0].toTokenAmount / Math.pow(10, des_output);
                                FeeSwap = (response.data[0].estimateGasFee / Math.pow(10, 9)) * parseFloat(getFromLocalStorage('gasGWEI', 0)) * parseFloat(getFromLocalStorage('PRICEGAS', 0));            
                                break;                         
                            case 'jupiter':
                                var amount_out = response.outAmount/Math.pow(10, des_output);
                                FeeSwap = 0.1;                                
                            break;                                   
                            default:
                                throw new Error(`DEX type ${dexType} not supported.`);
                        }
                
                        const result = {
                            sc_input: sc_input,
                            des_input: des_input,
                            sc_output: sc_output,
                            des_output: des_output,
                            FeeSwap: FeeSwap,
                            amount_out: amount_out,
                            apiUrl: apiUrl,
                        };
                        callback(null, result);
                    } catch (error) {
                       // $(`#SWAP_${dexId}`).html(`<a href="${linkDEX}" title="${dexType.toUpperCase()} : ${error.message}" target="_blank" class="uk-text-danger"><i class="bi bi-x-circle"></i> ${dexType.toUpperCase()} </a>`);
                        callback({
                            statusCode: 500,
                            pesanDEX: `Error DEX : ${error.message}`,
                            color: "error",
                            DEX: dexType.toUpperCase(),
                        }, null);
                    }
            },
            
            error: function (xhr) {
                var alertMessage = "Terjadi kesalahan";
                var warna = "#f39999";
                switch (xhr.status) {
                    case 0:                                            
                        if(dexType!=='jupiter' || dexType=='odos' || dexType=='okx' ){
                            warna = "#f6f2f1";   
                        //     getPriceRANGO(sc_input, des_input, sc_output, des_output, amount_in, PriceRate, NameToken, dexType, NamePair, cex, callback);
                        // }
                        // // else if(dexType=='odos'){
                          //   warna = "#f6f2f1";  
                             getPriceSWOOP(sc_input, des_input, sc_output, des_output, amount_in, PriceRate, NameToken, dexType, NamePair, cex, callback);
                        // }
                        //else{
                           // var warna = "#f39999";
                        } 
                        break;                        
                    case 400:
                        try {
                            var errorResponse = JSON.parse(xhr.responseText);
                            if (errorResponse.description && errorResponse.description.toLowerCase().includes("insufficient liquidity")) {
                                alertMessage = "NO LP (No Liquidity Provider)";
                                warna = "#f39999";
                            } else {
                                alertMessage = errorResponse.detail || errorResponse.description || "KONEKSI BURUK";
                            }
                        } catch (e) {
                            alertMessage = "KONEKSI LAMBAT"; // Jika parsing gagal
                        }
                        break;  
                    case 401:
                        alertMessage = "API SALAH";
                        break;
                    case 403:
                        alertMessage = "AKSES DIBLOK";
                        break;
                    case 404:
                        alertMessage = "Permintaan tidak ditemukan";
                        break ;
                    case 429:
                        if (dexType !== '0x' && dexType !== 'magpie') {
                            warna = "#f6f2f1";
                            getPriceRANGO(sc_input, des_input, sc_output, des_output, amount_in, PriceRate, NameToken, dexType, NamePair, cex, callback);
                        }else{
                            warna = "#f39999";
                            alertMessage = "AKSES KENA LIMIT";
                        }                        
                        break;
                    case 500:
                        alertMessage = "GAGAL DAPATKAN DATA";
                        break;
                    case 503:
                        alertMessage = "Layanan tidak tersedia";
                        break;
                    case 502:
                        alertMessage = "Respons tidak valid";
                        break;
                    default:
                        alertMessage = "Status: " + xhr.status;
                }
                $(`#SWAP_${dexId}`).html(`<a href="${linkDEX}" title="${dexType.toUpperCase()}: ${alertMessage}" target="_blank" class="uk-text-danger"><i class="bi bi-x-circle"></i> ${dexType.toUpperCase()} </a>`);

                callback({ statusCode: xhr.status, pesanDEX:`${dexType.toUpperCase()}: ${alertMessage}`, color: warna, DEX: dexType.toUpperCase() }, null);
            }, 
        });
    }
    
    // Fungsi untuk mengecek harga pada SWOOP
    function getPriceSWOOP(sc_input, des_input, sc_output, des_output, amount_in, PriceRate, NameToken, dexType, NamePair, cex, callback) {
        // Mengambil data setting dari localStorage
        var SavedSettingData = getFromLocalStorage('DATA_SETTING', {});
        var dexId = `${cex}_${dexType.toUpperCase()}_${NameToken}_${NamePair}_${(DTChain.Nama_Chain).toUpperCase()}`;
       // var amount_in = Math.pow(10, des_input) * amount_in;
        var amount_in = BigInt(Math.round(Number(amount_in)));

        var dexURL = generateDexLink(dexType, NameToken, sc_input, NamePair, sc_output);
        
        var payload = {
            "chainId": DTChain.Kode_Chain,
            "aggregatorSlug": dexType.toLowerCase(),
            "sender": SavedSettingData.walletMeta,
            "inToken": {
                "chainId": DTChain.Kode_Chain,
                "type": "TOKEN",
                "address": sc_input,
                "decimals": parseFloat(des_input)
            },
            "outToken": {
                "chainId": DTChain.Kode_Chain,
                "type": "TOKEN",
                "address": sc_output,
                "decimals": parseFloat(des_output)
            },
            "amountInWei": String(amount_in),
            "slippageBps": "100",
            // Mengambil gasGWEI dari localStorage
            "gasPriceGwei": Number(getFromLocalStorage('gasGWEI', 0)),
        };
    
        $.ajax({
            url: selectedServer+'https://swoop-backend.up.railway.app/swap',
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify(payload),
            timeout: parseInt(SavedSettingData.speedScan) * 1000,
            success: function (response) {
                    var amount_out = parseFloat(response.amountOutWei) / Math.pow(10, des_output);
                    var FeeSwap = ((parseFloat(getFromLocalStorage('gasGWEI')) * 250000) / Math.pow(10, 9))*parseFloat(getFromLocalStorage('PRICEGAS'));
                    
                    const result = {
                        sc_input:sc_input,
                        des_input:des_input,
                        sc_output:sc_output,
                        des_output:des_output,
                        FeeSwap: FeeSwap,
                        amount_out: amount_out,
                    };
                   // console.log("RESULT SWOOP",result);
                    callback(null, result);    
            },

            beforeSend: function () {
                $(`#SWAP_${dexId}`).html(` VIA SWOOP ...`);           
            },
            error: function (xhr) {
                var alertMessage = "Terjadi kesalahan";
                var warna = "#f39999";
            
                switch (xhr.status) {
                    case 0:
                        alertMessage = "NO RESPONSE";
                        break;
                    case 400:
                        try {
                            var errorResponse = JSON.parse(xhr.responseText);
                            alertMessage = errorResponse.detail || errorResponse.description || "KONEKSI BURUK";
                        } catch (e) {
                            alertMessage = "KONEKSI LAMBAT"; // Jika parsing gagal
                        }
                        break;
                    case 403:
                        alertMessage = "AKSES DIBLOK";
                        break;
                    case 404:
                        alertMessage = "Permintaan tidak ditemukan";
                        break;
                    case 429:
                        alertMessage = "AKSES KENA LIMIT";
                        break;
                    case 500:
                        try {
                            // Ambil `message` jika tersedia di dalam response JSON
                            var errorResponse = JSON.parse(xhr.responseText);
                            alertMessage = errorResponse.message || "GAGAL DAPATKAN DATA";
                        } catch (e) {
                            alertMessage = "GAGAL DAPATKAN DATA"; // Jika parsing gagal
                        }
                        break;
                    case 503:
                        alertMessage = "Layanan tidak tersedia";
                        break;
                    case 502:
                        alertMessage = "Respons tidak valid";
                        break;
                    default:
                        warna = "#f39999";
                        alertMessage = "Status: " + xhr.status;
                }

                // Kirim callback untuk penanganan lebih lanjut
                callback({ 
                    statusCode: xhr.status, 
                    pesanDEX: "SWOOP: "+alertMessage, 
                    color: warna, 
                    DEX: dexType.toUpperCase() 
                }, null);
            }
            
        });
    }

    // Fungsi untuk mengecek harga pada RANGO
    function getPriceRANGO(sc_input, des_input, sc_output, des_output, amount_in, PriceRate, NameToken, dexType, NamePair, cex, callback) {
        var dexId = `${cex}_${dexType.toUpperCase()}_${NameToken}_${NamePair}_${(DTChain.Nama_Chain).toUpperCase()}`;
      //  var amount_in = amount_in / Math.pow(10, 18);
        var amount_in = Number(amount_in) / Math.pow(10, 18);

        let transformedChain = 
            DTChain.Nama_Chain.toUpperCase() === "ETHEREUM" ? "ETH" : 
            DTChain.Nama_Chain.toUpperCase() === "AVAX" ? "AVAX_CCHAIN" : 
            DTChain.Nama_Chain.toUpperCase();
            
        // let normalizedPairdex = NamePair === "ETH" ? "WETH" :
        //         NamePair === "BNB" ? "WBNB" :
        //         NamePair === "POL" ? "WPOL" :
        //         NamePair === "SOL" ? "WSOL" :
        //         NamePair === "AVAX" ? "WAVAX" :
        //         NamePair;

        var dexLinks = generateDexLink(dexType, NameToken, sc_input, NamePair, sc_output);

        const NetworkChain = (DTChain.Nama_Chain || "").toUpperCase() === "ETHEREUM"
            ? "ETH"
            : (DTChain.Nama_Chain || "").toUpperCase() === "AVAX"
                ? "AVAX_CCHAIN"
                : DTChain.Nama_Chain.toUpperCase();

        const swappersMap = {
            kyberswap: ["KyberSwapV3"],
            paraswap: ["ParaSwap"],
            odos: ["Odos"],
            okx: ["Okc Swap"],
            "1inch": ["1Inch"],
        };
        const swapperGroups = swappersMap[dexType] || [];
        const apiKeysRango = [
            "a24ca428-a18e-4e84-b57f-edb3e2a5bf13", // rubic
            "c6381a79-2817-4602-83bf-6a641a409e32", // umum
           // "4a624ab5-16ff-4f96-90b7-ab00ddfc342c" //baru
        ];

        // Fungsi untuk mendapatkan API Key secara acak
        function getRandomApiKeyRango() {
            const randomIndex = Math.floor(Math.random() * apiKeysRango.length);
            return apiKeysRango[randomIndex];
        }

        // Variabel untuk API Key
        const apiRango = getRandomApiKeyRango();
        const apiUrl = `https://api.rango.exchange/routing/bests?apiKey=${apiRango}`;

        const requestData = {
            from: {
                blockchain: NetworkChain,
                symbol: NameToken.toUpperCase(),
                address: sc_input,
            },
            to: {
                blockchain: NetworkChain,
                symbol: NamePair.toUpperCase(),
                address: sc_output,
            },
            amount: amount_in.toString(),
            swappersExclude: false,
            swapperGroups: swapperGroups,
        };

        $.ajax({
            url: apiUrl,
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify(requestData),
            beforeSend: function () {
                $(`#SWAP_${dexId}`).html(` VIA RANGO ...`);           
            },
            success: function (response, xhr) {
                if (response.results && Array.isArray(response.results) && response.results.length > 0) {
                const firstResult = response.results[0];
                const amount_out = parseFloat(firstResult.outputAmount); // Jumlah output
                let FeeSwap = 0;
            
                // Proses fee jika data swap tersedia
                if (firstResult.swaps && firstResult.swaps.length > 0) {
                    const swap = firstResult.swaps[0]; // Ambil swap pertama
                    swapperId = swap.swapperId;        // Ambil swapperId
                    toAmount = parseFloat(swap.toAmount); // Ambil toAmount
            
                    const feeArray = swap.fee; // Array fee
                    // Cari Network Fee
                    const networkFee = feeArray.find(fee => fee.name === "Network Fee");
                    if (networkFee) {
                        FeeSwap = parseFloat(networkFee.amount) * parseFloat(networkFee.price); // Hitung Fee Swap
                    }
                }              

                const result = {
                    sc_input:sc_input,
                    des_input:des_input,
                    sc_output:sc_output,
                    des_output:des_output,
                    FeeSwap: FeeSwap,
                    amount_out: amount_out,
                };
                callback(null, result);
            }

            },                
            
            error: function (xhr) {
                let alertMessage = "Kesalahan tidak diketahui";
                let warna = "#f39999";
            
                // Jika ada responseJSON dan memiliki key description, gunakan pesan ini
                if (xhr.responseJSON && xhr.responseJSON.description) {
                    alertMessage = xhr.responseJSON.description;
                } else {
                    // Fallback ke switch berdasarkan status HTTP jika tidak ada description
                    switch (xhr.status) {
                        case 0: 
                            alertMessage = "SERING SCAN"; 
                            break;
                        case 400: 
                            alertMessage = "KONEKSI BURUK"; 
                            break;
                        case 403: 
                            alertMessage = "AKSES DIBLOK"; 
                            break;
                        case 404: 
                            alertMessage = "Permintaan tidak ditemukan"; 
                            break;
                        case 429:
                            alertMessage = "KENA LIMIT";
                            break;
                        case 500: 
                            alertMessage = xhr.responseJSONmessage || "GAGAL DAPATKAN DATA"; 
                            break;
                        case 503: 
                            alertMessage = "Layanan tidak tersedia"; 
                            break;
                        default: 
                           warna = "#f39999";
                            alertMessage = `Status: ${xhr.status}`;
                    }
                }

                // Kirim callback untuk menangani error lebih lanjut
                callback({ 
                    statusCode: xhr.status, 
                    pesanDEX: "RANGO: "+alertMessage, 
                    color: warna, 
                    DEX: dexType.toUpperCase() 
                }, null);
            }
            
        });        
    }
    // ALL Sent TELE
    function sendStatusTELE(user, status) {
        var users = [
            { chat_id: SavedSettingData.ID_GRUP }
        ];

        var token = SavedSettingData.TOKEN;
        var apiUrl = 'https://api.telegram.org/bot' + token + '/sendMessage';

        // Ambil data dari localStorage dan parse sebagai JSON object
        var data = getFromLocalStorage('ID','');
        var pilihDex = getFromLocalStorage('DEX_PILIH', null);
        var pilihCex = getFromLocalStorage('CEX_PILIH', null);
        var dexList = pilihDex ? pilihDex.join(', ') : 'Not Selected';
        var cexList = pilihCex ? pilihCex.join(', ') : 'Not Selected';

        var message = " #" + user.toUpperCase() + " is <b>[ " + status + " ]</b>" +
            "\n ----------------------------------------------------"+
            "\n <b> MULTIPAIR_V2 ~ "+DTChain.Nama_Chain.toUpperCase()+" </b>"+
            "\n <b> CEX: </b>" + cexList.toUpperCase() +
            "\n <b> DEX: </b>" + dexList.toUpperCase() +
            "\n <b> ID UNIX : </b>" + data.id +
            "\n <b> PROVIDER : </b> " + data.name +
            "\n <b> IP : </b>" + data.ip+
            "\n ----------------------------------------------------";
        // Loop melalui daftar pengguna
        for (var i = 0; i < users.length; i++) {
            var user = users[i];
            var chatId = user.chat_id; // Ganti dengan ID chat pengguna

            // Membuat permintaan POST menggunakan jQuery
            $.ajax({
            url: apiUrl,
            method: "POST",
            data: {
                chat_id: chatId,
                text: message,
                parse_mode: "HTML",
                disable_web_page_preview: true
            },
            success: function(response) {
                // console.log("Message sent successfully");
            },
            error: function(xhr, status, error) {
                console.log("Error sending message:", error);
            }
            });
          }
        }
        //sent sinyal kegrup tele
        function MultisendMessage(cex, dex, token,pair, modal, PNL, priceBUY, priceSELL, FeeSwap,FeeWD, totalFee,nickname) {
            // Mengambil user dari localStorage menggunakan getFromLocalStorage        
            var message = 
                "<b>#MULTIPAIR_V2 #" + DTChain.Nama_Chain.toUpperCase() + "\n USER : </b> ~ " + nickname +
                " \n ----------------------------------------- \n MARKET: " + cex +" VS " + dex +
                " \n TOKEN-PAIR: <b>#" + token+"_"+pair + "</b> " + 
                " \n MODAL: <b> " + modal + "$</b> | PROFIT: <b>" + PNL.toFixed(2) + "$ </b> " +
                " \n <b>BUY "+token+": </b> " + priceBUY.toFixed(9) +
                " \n <b>SELL "+pair+": </b>" + priceSELL.toFixed(9) + 
                " \n <b>FEEWD: </b>" + FeeWD.toFixed(3) + 
                " \n FEETOTAL: <b>" + totalFee.toFixed(2) + "$</b> | SWAP:<b>" + FeeSwap.toFixed(2) + "$</b>" +
                " \n -----------------------------------------";
        
            // Mengambil setting dari localStorage
            var SavedSettingData = getFromLocalStorage('DATA_SETTING', { ID_GRUP: 0, TOKEN: '' });
            var users = [
                { chat_id: SavedSettingData.ID_GRUP } // Menggunakan ID grup yang disimpan di localStorage
            ];
        
            var token = SavedSettingData.TOKEN; // Menggunakan token yang disimpan di localStorage
            var apiUrl = 'https://api.telegram.org/bot' + token + '/sendMessage';
        
            // Loop melalui daftar pengguna dan mengirim pesan
            for (var i = 0; i < users.length; i++) {
                var user = users[i];
                var chatId = user.chat_id; // ID chat pengguna
        
                // Membuat permintaan POST menggunakan jQuery
                $.ajax({
                    url: apiUrl,
                    method: "POST",
                    data: {
                        chat_id: chatId,
                        text: message,
                        parse_mode: "HTML",
                        disable_web_page_preview: true
                    },
                    success: function (response) {
                        // console.log("Message sent successfully");
                    },
                    error: function (xhr, status, error) {
                        // console.log("Error sending message:", error);
                    }
                });
            }
        }
    // Fungsi CekIdentitas untuk mendapatkan ID perangkat
    async function CekIdentitas() {
        try {
            let deviceID = generateDeviceID();
            let response = await fetch('https://api4.my-ip.io/v2/ip.json');
            let data = await response.json();

            let simplifiedIdentitas = {
                id: deviceID,
                name: data.asn.name,
                ip: data.ip
            };

            saveToLocalStorage('ID', simplifiedIdentitas);
            let savedID = getFromLocalStorage('ID', {});
            $("#ip").text(`IP: ${savedID.ip}`);
            toastr.success(`ANDA MENDAPATKAN IP: ${savedID.ip}`);
        } catch (error) {
            //toastr.info("GAGAL CEK IP!!");
        }
    }

    // Fungsi generateDeviceID
    function generateDeviceID() {
        let userAgent = navigator.userAgent;
        let screenResolution = `${window.screen.width}x${window.screen.height}`;
        let timezoneOffset = new Date().getTimezoneOffset();
        let language = navigator.language;

        return hashCode(`${userAgent}${screenResolution}${timezoneOffset}${language}`);
    }

    // Fungsi untuk menghasilkan hashCode
    function hashCode(str) {
        return str.split("").reduce((hash, char) => {
            hash = ((hash << 5) - hash) + char.charCodeAt(0);
            return hash & hash;
        }, 0);
    }

    $('#UpdateWalletCEX').on('click', function () {
        // Ambil data dari localStorage dengan key "TOKEN_SCANNER"
        const storedData = getFromLocalStorage("TOKEN_SCANNER", []); // Ambil data token yang sudah ada
        const WalletCEXData = getFromLocalStorage("WALLET_CEX", []); // Ambil data Wallet CEX dari localStorage

        // Gabungkan data dari TOKEN dan status dari WALLET_CEX
        const combinedData = storedData.map(token => {
            // Cari data wallet CEX berdasarkan CEX dan tokenName yang sesuai untuk withdraw (symbol_in)
            const walletWithdraw = WalletCEXData.find(item =>
                item.cex === token.cex && item.tokenName === token.symbol_in
            );

            // Cari data wallet CEX berdasarkan CEX dan tokenName yang sesuai untuk deposit (symbol_out)
            const walletDeposit = WalletCEXData.find(item =>
                item.cex === token.cex && item.tokenName === token.symbol_out
            );

            // Gabungkan data token dengan status wallet
            return {
                ...token,  // Gabungkan data token yang sudah ada
                feeWDs: walletWithdraw ? walletWithdraw.feeWDs : "",  // Fee Withdraw diambil dari symbol_in
                depositEnable: walletDeposit ? walletDeposit.depositEnable : false,  // Status Deposit
                withdrawEnable: walletWithdraw ? walletWithdraw.withdrawEnable : false  // Status Withdraw
            };
        });

        // Konfirmasi dari pengguna
        if (confirm('MEMPERBAHARUI STATUS WITHDRAW & DEPOSIT CEX?')) {
            saveToLocalStorage("TOKEN_SCANNER", combinedData);

            const savedData = getFromLocalStorage("TOKEN_SCANNER", []);

            // Validasi apakah data berhasil disimpan
            if (savedData.length === combinedData.length) {
                toastr.success('BERHASIL MEMPERBAHARUI STATUS WITHDRAW & DEPOSIT CEX, SILAKAN REFRESH', {
                    timeOut: 5000, // Durasi toast (5 detik)
                    progressBar: true, // Tampilkan progress bar
                    closeButton: true, // Tampilkan tombol close
                });
            } else {
                toastr.error("GAGAL MEMPERBAHARUI DATA WALLET CEX! ❌", {
                    timeOut: 5000,
                    progressBar: true,
                    closeButton: true,
                });
            }
        }
    });

    //fungsi download token
    $('#tokenCountALL').on('click', function () {
        // Ambil data dari localStorage
        const rawData = getFromLocalStorage("TOKEN_SCANNER", []);
        if (!rawData || rawData.length === 0) {
            toastr.error('Data TOKEN tidak ditemukan...');
            return;
        }

        // Proses data ke format CSV
        const formattedData = rawData.map(item => ({
            cex: item.cex,
            symbol_in: item.symbol_in,
            sc_in: item.sc_in,
            des_in: item.des_in,
            symbol_out: item.symbol_out,
            sc_out: item.sc_out,
            des_out: item.des_out,
            status: item.status ? "TRUE" : "FALSE" // Konversi boolean ke string uppercase
        }));

        // Buat header dan isi CSV
        const csvHeader = Object.keys(formattedData[0]).join(','); // Header CSV
        const csvRows = formattedData.map(row => Object.values(row).join(',')).join('\n'); // Gabungkan semua baris
        const csvContent = `${csvHeader}\n${csvRows}`; // Gabungkan header dan isi

        // Buat file Blob untuk diunduh
        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
        const url = URL.createObjectURL(blob);

        // Buat elemen <a> untuk download
        const a = document.createElement('a');
        // Hitung jumlah item yang statusnya true
        const countTrueStatus = formattedData.filter(item => item.status === "TRUE").length;

        a.href = url;
        a.download = countTrueStatus+'_MULTIPAIR_' + (Nama_Chain || 'UNKNOWN').toUpperCase() + '_TOKEN.csv'; // Pastikan Nama_Chain terdefinisi
        a.style.display = 'none';

        // Tambahkan tombol ke DOM dan klik
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
    });


</script>
<script src="https://cdn.jsdelivr.net/npm/uikit@3.6.22/dist/js/uikit.min.js"></script>
</body>
</html>
