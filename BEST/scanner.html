<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>???</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/uikit/3.6.22/css/uikit.min.css" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/uikit/3.6.22/js/uikit.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.9-1/crypto-js.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/css/toastr.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/js/toastr.min.js"></script>
    <link id="favicon" rel="icon" type="image/png" >
    <script src="https://multichecker.vercel.app/BEST/config.js"></script>
    <style>
        .uk-container { width: 96%; max-width: none; }
        .status-active { color: green; }
        .status-inactive { color: red; }
        .sort-icon { position: absolute; right: 10px; top: 50%; transform: translateY(-50%); }
        /* Memaksa warna link untuk CEX */
        .uk-link {
            color: inherit !important;  /* Memastikan warna link mengikuti warna induk */
        }
        a {
            text-decoration: none; /* Menghapus garis bawah */
            color: inherit;        /* Menggunakan warna teks elemen induk */
        }
        /* Memaksa warna status aktif */
        .status-active {
            color: inherit !important;  /* Warna aktif mengikuti warna yang ditentukan */
        }
        img:hover {
                transform: scale(1.6); /* You can adjust the scale factor as needed */
            }

        #progress-container {
            width: 100%;
            background-color: #f3f3f3;
            border-radius: 10px;
            margin-top: 10px;  /* Ubah margin top menjadi lebih kecil */
        }

        #progress-bar {
            height: 14px;  /* Mengurangi tinggi bar progress menjadi 10px */
            width: 0%;
            background-color: #4caf50;
            border-radius: 5px; /* Untuk membuat ujung bar lebih melengkung */
            position: relative;
        }

        #progress-bar span {
            color: white;
            text-align: center;
            line-height: 10px;  /* Menyesuaikan tinggi bar agar teks tetap berada di tengah */
            display: block;
            font-weight: bold;
        }


        .table-header th {
            background-color: #d1cccc; 
            position: sticky; /* Header tetap di tempat */
            top: 0; /* Posisi tetap pada bagian atas */
            z-index: 10; /* Agar tetap di atas elemen lain */
            color: black; /* Warna teks header */
            text-align: center;
            padding: 8px;
            font-size: 14px; /* Ukuran font */
            font-weight: bolder; /* Tebal */
            border: 1px solid #ddd; /* Border */
            cursor: pointer; /* Ubah kursor menjadi pointer untuk interaksi */
        }

        /* Tambahkan scroll untuk tabel */
        .uk-overflow-auto {
            overflow-x: auto; /* Scroll horizontal jika diperlukan */
            max-height: 800px; /* Batasi tinggi untuk memunculkan scroll */
            background-color: white; 
        }

        .uk-table tbody td {
            font-size: 12px;
        }
        .merah{
            font-weight: bold;
            color: rgb(250, 249, 249) !important;
            background-color:#eb6464!important;
        }
        .ijo {
            color: black;
            background-color:#c0ffb6;
        }
        .error{
            color: #fafafa!important;
            background-color: #f39999!important;
        }
        .img-large {
            width: 60px !important; /* Atur ukuran sesuai kebutuhan */
            transition: transform 0.3s; /* Menambahkan efek animasi */
        }
    </style>
    
</head>
<body>
<div class="uk-container uk-margin-small-top">
    <div class="uk-text-center"> <!-- Mengurangi margin-top -->        
        <h2 id="judul" class="uk-margin-remove" style="font-size: 26px;" > &nbsp;
            <img class="icon" id="LoadDataBtn" title="LOAD DATA" width="25px" src="https://png.pngtree.com/png-clipart/20230815/original/pngtree-database-sync-icon-icon-symbol-data-vector-picture-image_10830033.png" /> &nbsp;
            <img class="icon" id="SettingModal" title="SETTING APLIKASI" width="25px" src="https://cdn-icons-png.flaticon.com/512/771/771203.png" /> &nbsp;
            <img class="icon" id="reload" title="REFRESH PAGE" width="25px" src="https://cdn-icons-png.flaticon.com/512/2546/2546705.png" /> &nbsp;
            <a href="index.html" target="_blank" > <img class="icon" id="MasterData" title="MASTER DATA" width="25px" src="https://cdn3.iconfinder.com/data/icons/servers-4/24/Computer-Database-512.png" /></a> &nbsp;
            <a href="https://cors-anywhere.herokuapp.com/corsdemo" target="_blank" > <img class="icon" id="BukaKunci" title="BUKA AKSES" width="25px" src="https://cdn-icons-png.flaticon.com/512/9921/9921748.png" /></a> &nbsp;
            <a href="manajemen_aset.html" target="_blank" > <img class="icon"  id="Modal" title="MANAJEMEN ASSET" width="25px" src="https://cdn-icons-png.flaticon.com/512/6573/6573160.png" /> </a> &nbsp;
            
                TRIANGULAR :: <label id="namachain"></label>&nbsp;
            <span id="chain-links-container"></span>             
        </h2>
    </div>
    
    <form id="cryptoForm" style="margin: 0;">
        <fieldset class="uk-fieldset">
    
            <div class="dex-group  uk-margin-small-top uk-grid-small uk-flex uk-flex-between" uk-grid style="flex-wrap: wrap; margin-top: 0;">
                <!-- Kolom untuk CEX -->
                <div class="uk-width-auto uk-flex uk-flex-middle">
                    <b><span class="uk-text-secondary uk-text-medium">CEX:</span></b>
                    <div id="cex-options" class="uk-form-controls" style="display: flex;">
                        <!-- Radio button CEX akan di-generate di sini -->
                    </div>
                </div>
    
                <div class="uk-width-auto uk-flex uk-flex-middle">
                    <b><span class="uk-text-secondary uk-text-medium">DEX:</span></b>
                    <div id="dex-options" class="uk-form-controls" style="display: flex;">
                        <!-- Radio button DEX akan di-generate di sini -->
                    </div>
                </div>
    
                <div class="uk-width-auto uk-flex uk-flex-middle">
                    <b><span class="uk-text-secondary uk-text-medium">PAIR:</span></b>
                    <div id="dexpair-options" class="uk-form-controls" style="display: flex;">
                        <!-- Radio button PAIR DEX akan di-generate di sini -->
                    </div>
                </div>

                <!-- <label class="uk-width-auto uk-flex uk-flex-middle">
                    <b><span class="uk-text-secondary uk-text-medium">SORT:</span></b>
                        <input type="radio" name="toggle" checked value="option2"> A 
                        <input type="radio" name="toggle" value="option1"> Z
                </label> -->
                <!-- Kolom untuk Tombol -->
                <div class="uk-width-auto uk-flex uk-flex-middle" style="gap: 10px;">
                    <button type="button" id="startSCAN" style="display: none;" class="uk-button uk-button-primary uk-button-small">START</button>
                    <button type="button" id="stopSCAN" style="display: none;" class="uk-button uk-button-danger uk-button-small">STOP</button>
                </div>
            </div>                        
            
        </fieldset>
    </form>
    
    <!-- Modal UIKIT -->
    <div id="modal-setting" class="uk-modal-full" uk-modal>
        <div class="uk-modal-dialog">
            <button class="uk-modal-close-full uk-close-large" type="button" uk-close></button>
            <div class="uk-modal-header">
                <h2 class="uk-modal-title">:: SETTING DEX CHECKER</h2>
               
            </div>
            <div class="uk-modal-body">
                <form> 
                    <!-- Grid UIkit untuk 2 kolom -->
                    <div class="uk-grid-small" uk-grid>
                        
                        <div class="uk-width-1-2">
                            
                            <!-- Kolom pertama -->
                            <div class="uk-card uk-card-default uk-card-body">
                                <h3 style="text-align: center; color: #1317e1;">:: SETINGAN PERMODALAN</h3>
                                <div id="modal-container"></div>                                
                            </div>
                        </div>
                        <div class="uk-width-1-2">
                            <!-- Kolom kedua -->
                            <div class="uk-card uk-card-default uk-card-body">
                                <h3 style="text-align: center; margin: 12px 0px; color: #1317e1;">:: SETINGAN SCANNER</h3>
                                <label for="pnl">NICK NAME:</label>
                                <input type="text" id="user"  class="uk-input" required>

                                <div class="uk-flex uk-flex-middle uk-margin ">
                                    <!-- <div style="display: none;"> -->
                                       <div>
                                           <label for="jeda-time-group" class="uk-text-danger">SCAN PERKOIN : </label>
                                           <label class="uk-form-label uk-text-success"><input class="uk-radio" type="radio" value="18"  name="koin-group"> 18</label> 
                                           <label class="uk-form-label uk-text-success"><input class="uk-radio" type="radio" value="16"  name="koin-group"> 16</label> 
                                           <label class="uk-form-label uk-text-success"><input class="uk-radio" type="radio" value="14"  name="koin-group"> 14</label> 
                                           <label class="uk-form-label uk-text-success"><input class="uk-radio" type="radio" value="12"  name="koin-group"> 12</label>
                                           <label class="uk-form-label uk-text-success"><input class="uk-radio" type="radio" value="10"  name="koin-group"> 10</label>  
                                           <label class="uk-form-label uk-text-success"><input class="uk-radio" type="radio" value="8" name="koin-group"> 8</label>                                           
                                        </div>
                                    </div>
                                <div class="uk-flex uk-flex-middle uk-margin ">
                                       <div>
                                            <label for="SPEEDSCAN" class="uk-text-danger">SPEED SCAN</label>
                                            <label class="uk-form-label uk-text-success"><input class="uk-radio" type="radio" value="5"  name="waktu-tunggu"> SLOW </label>
                                            <label class="uk-form-label uk-text-success"><input class="uk-radio" type="radio" value="4"  name="waktu-tunggu"> NORMAL </label>
                                            <label class="uk-form-label uk-text-success"><input class="uk-radio" type="radio" value="3" name="waktu-tunggu"> MEDIUM </label>
                                            <label class="uk-form-label uk-text-success"><input class="uk-radio" type="radio" value="2" name="waktu-tunggu"> FAST </label>
                                        </div>
                                   </div>
                                <div>
                                </div>
                                

                                <div class="uk-flex uk-flex-middle uk-margin ">
                                 <!-- <div style="display: none;"> -->
                                    <div>
                                        <label for="jeda-koin" class="uk-text-warning">FILTER PNL</label><br/>
                                        <input class="uk-input" type="number" id="inFilterPNL" value="0" name="filterpnl" >         
                                    </div>
                                    <div>
                                        <label for="jeda-time-group" class="uk-text-danger">JEDA / GROUP {600}</label><br/>
                                        <input class="uk-input" id="jeda-time-group" type="number" value="600" name="jeda-time-group" >
                                    </div>
                                    <div>
                                        <label for="jeda-koin" class="uk-text-primary">JEDA / KOIN {300}</label><br/>
                                        <input class="uk-input" type="number" id="jeda-koin" value="300" name="jeda-koin" > 
                                    </div>
                                </div>

                                    <div>
                                        <label for="walletMETA" class="uk-text-danger">WALLET METAMASK</label><br />
                                        <input class="uk-input" type="text" id="walletMETA" name="walletMETA" >
                                    </div>
                                <div>                                    
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Tombol untuk menutup modal -->
                    <p class="uk-text-right">
                        <button class="uk-button uk-button-default uk-modal-close" type="button">Tutup</button>
                        <button type="button" id="save-config" class="uk-button uk-button-primary">SIMPAN</button>  
                    </p>                   
                </form>
            </div>
        </div>
    </div>

    <div>
        <!-- Bagian untuk menampilkan sinyal DEX  -->
        <div class="uk-text uk-text-small uk-text-secondary  uk-margin-small-top " id="sinyal-container" style="background-color: #fdfff2; display:none;">
         <!--   Sinyal DEX akan dimuat di sini -->
        </div>
        <div class="uk-grid-small uk-flex uk-flex-middle  uk-margin-small-top" uk-grid>
            <!-- Judul dan Jumlah Token -->
            <div class="uk-width-expand">
                <h3 class="uk-heading-line uk-margin-remove uk-text-danger">
                    <span style="font-size:small; font-weight: bolder;" id="sinyalselisih">INFO SINYAL</span>
                </h3>
                <h4 class="uk-heading-line uk-margin-remove uk-text-primary">
                    <span style="font-size:medium; font-weight: bolder;">DAFTAR TOKEN <span id="namachain2"></span> (<span id="tokenCount" class="token-count">0</span>)</span>
                </h4>
            </div>
           
            <!-- Pencarian -->
            <div class="uk-width-auto uk-flex uk-flex-middle">
                <input type="text" id="searchInput" class="uk-input uk-form-small uk-form-primary uk-form-width-small" placeholder="Cari di tabel...">
            </div>
        </div>
    </div>

    <div id="progress-container" style="width: 100%; background-color: #f3f3f3; border-radius: 10px; margin-top: 10px;">
        <div id="progress-bar" style="height: 14px; width: 0%; background-color: #4caf50; border-radius: 5px;">
            <span id="progress-text" style="color: white; font-size: 12px; text-align: center; line-height: 10px; display: block; font-weight: bold;">0%</span>
        </div>
    </div>
    <div id="progress" style="font-size: 14px; font-weight: bold; margin-top: 5px;"></div>
    

    <div class="uk-overflow-auto uk-margin-small-top">
        <table class="uk-table uk-table-hover uk-table-small uk-table-striped">
            <thead class="table-header">
                <tr>
                    <!-- Kolom-kolom header akan ditambahkan secara dinamis -->
                </tr>
            </thead>
            <tbody id="dataTableBody">
                <!-- Baris-baris data akan ditambahkan secara dinamis -->
            </tbody>
        </table>
        <div id="InfoStatus" style="text-align:center; font-weight:bold; color:red;">MOHON MENUNGGU, SEDANG MEMUAT DATA TABEL TOKEN...</div>    
        <div id="cek" style="text-align:center; font-weight:bold; color:red;"></div>    
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    // Mendapatkan parameter dari URL
    const urlParams = new URLSearchParams(window.location.search);
    const chainName = urlParams.get('chain') || "bsc"; // Default ke 'bsc' jika tidak ada parameter 'chain' di URL

    // Memilih chain yang sesuai berdasarkan parameter URL
    const selectedChain = CONFIG_CHAINS[chainName] || CONFIG_CHAINS['bsc']; 

    // Mengatur konfigurasi global chain berdasarkan input dari URL
    const { Kode_Chain, Nama_Chain, URL_Chain, pairs } = selectedChain; 

    const storagePrefix = "TRI_" + Nama_Chain.toUpperCase() + "_";
    let sortOrder = {};
    
    // Fungsi umum untuk mendapatkan data dari localStorage
    function getFromLocalStorage(key, defaultValue) {
        return JSON.parse(localStorage.getItem(storagePrefix + key)) || defaultValue;
       // console.log("Data from localStorage:", data); // Debug log
    }

    // Fungsi umum untuk menyimpan data ke localStorage
    function saveToLocalStorage(key, value) {
        try {
            localStorage.setItem(storagePrefix + key, JSON.stringify(value));
            //console.log("Data saved successfully:", key);
        } catch (error) {
            if (error.name === "QuotaExceededError" && isLocalStorageFull()) {
                toastr.error("MEMORY BROWSER PENUH!!!");
            } else {
                console.error("Unexpected error:", error);
            }
        }
    }

    // Fungsi untuk memeriksa apakah localStorage penuh
    function isLocalStorageFull() {
        try {
            const testKey = "__test__";
            localStorage.setItem(testKey, "test"); // Coba simpan data sementara
            localStorage.removeItem(testKey); // Hapus data setelah dicek
            return false; // Tidak penuh
        } catch (e) {
            return true; // Penuh jika error
        }
    }
    // Fungsi untuk menghapus item dari localStorage
    function removeFromLocalStorage(key) {
        localStorage.removeItem(storagePrefix + key);
       // console.log("Remove from localStorage:", key); // Debug log
    }
    // Fungsi untuk mendapatkan data chain berdasarkan nama chain
    function getChainData(chainName) {
        const chainData = CONFIG_CHAINS[chainName]; // base
        
        if (!chainData) {
            console.log(`Chain dengan nama ${chainName} tidak ditemukan.`);
            return null;
        }
        return {
            Kode_Chain: chainData.Kode_Chain,
            Nama_Chain: chainData.Nama_Chain,
            DEXS: chainData.DEXS,
            PAIRDEXS: chainData.PAIRDEXS,
            URL_Chain: chainData.URL_Chain, 
            DATAJSON: chainData.DATAJSON, 
            BaseFEEDEX: chainData.BaseFEEDEX, 
            CEXCHAIN: chainData.WALLET_CEX,
            ICON_CHAIN: chainData.ICON,
            COLOR_CHAIN: chainData.WARNA,
        };
    }
   // Fungsi untuk memilih server secara acak dari array
   function getRandomServerFromCORSList() {
        const serverCORSList = getFromLocalStorage("SERVERCORS", []);  // Ambil data dari localStorage
    
        if (!serverCORSList || serverCORSList.length === 0) {
            toastr.warning("SERVER CORS TIDAK ADA, SILAKAN SYCN ULANG!!");
            return null; // Tidak ada server dalam daftar
        }
    
        // Pilih server secara acak
        const randomIndex = Math.floor(Math.random() * serverCORSList.length);
        return serverCORSList[randomIndex];
    }
    
    // Menggunakan fungsi untuk mendapatkan server CORS secara acak
    var selectedServer = getRandomServerFromCORSList();
    const DTChain = getChainData(chainName);  
    var savedSettingData = getFromLocalStorage('SETTING', {});
    var DataTokens = getFromLocalStorage('TOKEN_SCANNER',[]);
    var serverCORSList = getFromLocalStorage("SERVERCORS", []); 

    const dexList = [
            { id: 'D1INCH', Modal: savedSettingData.Modal1INCH,  dex: '1inch' },
            { id: 'DODOS', Modal: savedSettingData.ModalODOS, dex: 'odos' },
            { id: 'D0X', Modal: savedSettingData.Modal0X,  dex: '0x' },
            { id: 'DKYBERSWAP', Modal: savedSettingData.ModalKYBERSWAP, dex: 'kyberswap' },
            { id: 'DJUPITER', Modal: savedSettingData.ModalJUPITER,  dex: 'jupiter' },
            { id: 'DOKX', Modal: savedSettingData.ModalOKX,  dex: 'okx' },
            { id: 'DMAGPIE', Modal: savedSettingData.ModalMAGPIE,  dex: 'magpie' },
            { id: 'DPARASWAP', Modal: savedSettingData.ModalPARASWAP,  dex: 'paraswap' }
        ];
    var filteredTokens = filterTokens();
    // Mapping konfigurasi untuk setiap exchange
    const exchangeConfig = {
        GATE: {
            url: coins => `https://api.gateio.ws/api/v4/spot/order_book?limit=5&currency_pair=${coins.symbol}_USDT`,
            processData: data => processOrderBook(data)
        },
        BINANCE: {
            url: coins => `https://api.binance.me/api/v3/depth?limit=4&symbol=${coins.symbol}USDT`,
            processData: data => processOrderBook(data)
        },
        MEXC: {
            url: coins => `https://api.mexc.com/api/v3/depth?symbol=${coins.symbol}USDT&limit=5`,
            processData: data => processOrderBook(data)
        },
        KUCOIN: {
            url: coins => `https://proxykiri.awokawok.workers.dev/?https://api.kucoin.com/api/v1/market/orderbook/level2_20?symbol=${coins.symbol}-USDT`,
            processData: data => {
                if (!data?.data?.asks || !data?.data?.bids) {
                    console.error('Invalid KUCOIN response structure:', data);
                    return { priceBuy: [], priceSell: [] };
                }
                const priceBuy = data.data.bids.slice(0, 4).map(([price, volume]) => ({
                    price: parseFloat(price),
                    volume: parseFloat(volume) * parseFloat(price)
                }));
                const priceSell = data.data.asks.slice(0, 4).map(([price, volume]) => ({
                    price: parseFloat(price),
                    volume: parseFloat(volume) * parseFloat(price)
                }));
                return { priceBuy, priceSell };
            }
        },
        BITGET: {
            url: coins => `https://api.bitget.com/api/v2/spot/market/orderbook?symbol=${coins.symbol}USDT&limit=5`,
            processData: data => {
                if (!data?.data?.asks || !data?.data?.bids) {
                    console.error('Invalid BITGET response structure:', data);
                    return { priceBuy: [], priceSell: [] };
                }
                const priceBuy = data.data.bids.slice(0, 4).map(([price, volume]) => ({
                    price: parseFloat(price),
                    volume: parseFloat(volume) * parseFloat(price)
                }));
                const priceSell = data.data.asks.slice(0, 4).map(([price, volume]) => ({
                    price: parseFloat(price),
                    volume: parseFloat(volume) * parseFloat(price)
                }));
                return { priceBuy, priceSell };
            }
        },
        BYBIT: {
            url: coins => `https://api.bybit.com/v5/market/orderbook?category=spot&limit=4&symbol=${coins.symbol}USDT`,
            processData: data => {
                if (!data?.result?.a || !data?.result?.b) {
                    console.error('Invalid BYBIT response structure:', data);
                    return { priceBuy: [], priceSell: [] };
                }
                const priceBuy = data.result.b.slice(0, 4).map(([price, volume]) => ({
                    price: parseFloat(price),
                    volume: parseFloat(volume) * parseFloat(price)
                }));
                const priceSell = data.result.a.slice(0, 4).map(([price, volume]) => ({
                    price: parseFloat(price),
                    volume: parseFloat(volume) * parseFloat(price)
                }));
                return { priceBuy, priceSell };
            }
        },
        OKX: {
            url: coins => `https://www.okx.com/api/v5/market/books?instId=${coins.symbol}-USDT&sz=5`,
            processData: data => {
                if (!data?.data?.[0]?.asks || !data?.data?.[0]?.bids) {
                    console.error('Invalid OKX response structure:', data);
                    return { priceBuy: [], priceSell: [] };
                }
                const priceBuy = data.data[0].bids.slice(0, 4).map(([price, volume]) => ({
                    price: parseFloat(price),
                    volume: parseFloat(volume) * parseFloat(price)
                }));
                const priceSell = data.data[0].asks.slice(0, 4).map(([price, volume]) => ({
                    price: parseFloat(price),
                    volume: parseFloat(volume) * parseFloat(price)
                }));
                return { priceBuy, priceSell };
            }
        }
    };   

    function setNullInfoSinyal() {
        $("#sinyal1inch").text("");
        $("#sinyalodos").text("");
        $("#sinyal0x").text("");
        $("#sinyalparaswap").text("");
        $("#sinyalkyberswap").text("");
        $("#sinyalokx").text("");
        $("#sinyaljupiter").text("");
        $("#sinyalmagpie").text("");
    }
     
     // Fungsi untuk mendapatkan fee gas dalam Gwei
     function feeGasGwei() {
        $.when(
            $.ajax({
                url: 'https://data-api.binance.vision/api/v3/ticker/24hr?symbol=' + DTChain.BaseFEEDEX,
                method: 'GET'
            }),
            $.ajax({
                url: 'https://gas.api.infura.io/v3/9d0429abadc34232af7d5c0e6ab98631/networks/' + DTChain.Kode_Chain + '/suggestedGasFees',
                method: 'GET'
            })
        ).done(function(PriceResponse, gasResponse) {
            var lastPrice = PriceResponse[0].lastPrice;
            saveToLocalStorage('PRICEGAS', lastPrice); // Menggunakan saveToLocalStorage
            var mediumGasFee = gasResponse[0].low.suggestedMaxFeePerGas;
            saveToLocalStorage('gasGWEI', mediumGasFee); // Menggunakan saveToLocalStorage
            
           // $("#LGwei").text("" + parseFloat(getFromLocalStorage('gasGWEI', 0)).toFixed(2)+" | "+DTChain.BaseFEEDEX+":"+parseFloat(getFromLocalStorage('PRICEGAS', 0)).toFixed(2)); // Menggunakan getFromLocalStorage

           //  console.log('Medium Gas Fee:', mediumGasFee);
        }).fail(function(error) {
            console.error('Failed to fetch data:', error);
        });
    }
    // Fungsi untuk menonaktifkan semua input di dalam form
    function form_off() {
        $('input, select, textarea, button').prop('disabled', true); 
    }

    // Fungsi untuk mengaktifkan semua input di dalam form
    function form_on() {
        $('input, select, button').prop('disabled', false);
    }

    UIkit.util.on('#modal-setting', 'show', function () {
        form_on();
    });

    function cekDataAwal() {
        // Array untuk menyimpan pesan error
        let errorMessages = [];
        if (!DataTokens.length) {
            form_off(); 
            $("#LoadDataBtn").addClass("img-large");   
            errorMessages.push('<b>SILAKAN LOAD DATA TERLEBIH DAHULU !!</b><br/>');         
        }else if (!savedSettingData || savedSettingData.walletMeta === '-' ) {
            errorMessages.push('CEK, SETTINGAN APLIKASI {MODAL,WALLET METAMASK}!');
            $("#SettingModal").addClass("img-large");
            form_off();
        }else{
            generateInputCheckbox(CONFIG_CEX,  "cex-options","","uk-form-label uk-text-success");
            generateInputCheckbox(DTChain.DEXS,  "dex-options","D","uk-form-label uk-text-danger");
            generateInputCheckbox(DTChain.PAIRDEXS, "dexpair-options","","uk-form-label uk-text-primary");
            generateInputModal(DTChain.DEXS);
            loadStoredData(filteredTokens);
            loadCheckboxSelections();            
        }
        
        // Tampilkan semua pesan error
        $("#InfoStatus").html(errorMessages.join('<br/>')).addClass("text-large");    
    }

    $(document).ready(function() {  
        
        if (typeof CONFIG_CEX !== 'undefined' && typeof CONFIG_CHAINS !== 'undefined') {
            const currentPage = window.location.pathname.split('/').pop(); // Mengambil bagian terakhir dari path URL
            const selectedChain = CONFIG_CHAINS[Nama_Chain.toLowerCase()];
                // Pastikan data chain ditemukan
                if (selectedChain) {                    
                    // console.log(`Data untuk chain ${chainName}:`, DTChain);                
                    // console.log(`CEXS `, CONFIG_CEX); 
                    // console.log(`DEXS `, DTChain.DEXS); 
                    // generate CEX,DEX dan PAIR
                    
                    // Update tampilan dengan nama chain dan warna
                    $('title').text("SCANNER " + Nama_Chain.toUpperCase());
                    $('#namachain').text(Nama_Chain.toUpperCase());
                    $('#namachain2').text("CHAIN " + Nama_Chain.toUpperCase());
                    $('h2#judul').css('color', selectedChain.color);
                    $('#favicon').attr('href', DTChain.ICON_CHAIN); 
                    cekDataAwal();

                    // Untuk setiap chain yang ada di CONFIG_CHAINS dibuatkan ICON LINK CHAIN
                    Object.keys(CONFIG_CHAINS).forEach(chainKey => {
                        const chain = CONFIG_CHAINS[chainKey];
                        const isActive = chain.Nama_Chain === Nama_Chain;
                        const linkHTML = `<span class="chain-link ${isActive ? 'active-chain' : ''}" style="${!isActive ? 'opacity: 0.3;' : ''}">
                                <a href="${currentPage}?chain=${chain.Nama_Chain}" ><img src="${chain.ICON}" alt="${chain.Nama_Chain} icon" width="${isActive ? '35' : '25'}"></a></span>`;
                        $('#chain-links-container').append(linkHTML);
                    });
                } else {
                    alert(`Chain dengan nama ${Nama_Chain} tidak ditemukan.`);
                }
            } else {
                console.warn("CONFIG tidak tersedia.");
            }

            $('#searchInput').on('input', function() {
                const searchValue = $(this).val().toLowerCase();
                $('#dataTableBody tr').filter(function() {
                    $(this).toggle($(this).text().toLowerCase().indexOf(searchValue) > -1);
                });
            });

            $('#LoadDataBtn').on('click', function() {   
                // Ambil data dari localStorage dengan key "TOKEN_SCANNER"
                const storedData = getFromLocalStorage("TOKEN", []); // Ambil data token yang sudah ada
                const WalletCEXData = getFromLocalStorage("WALLET_CEX", []); // Ambil data Wallet CEX dari localStorage

                // Gabungkan data dari TOKEN dan status dari WALLET_CEX
                const combinedData = storedData.map(token => {
                    // Cari data wallet CEX berdasarkan CEX dan tokenName yang sesuai untuk withdraw (symbol_in)
                    const walletWithdraw = WalletCEXData.find(item =>
                        item.cex === token.cex && item.tokenName === token.symbol_in
                    ); 

                    // Cari data wallet CEX berdasarkan CEX dan tokenName yang sesuai untuk deposit (symbol_out)
                    const walletDeposit = WalletCEXData.find(item =>
                        item.cex === token.cex && item.tokenName === token.symbol_out
                    ); 

                    // Gabungkan data token dengan status wallet
                    return {
                        ...token,  // Gabungkan data token yang sudah ada
                        feeWDs: walletWithdraw ? walletWithdraw.feeWDs : "",  // Fee Withdraw diambil dari symbol_in
                        depositEnable: walletDeposit ? walletDeposit.depositEnable : false,  // Status Deposit
                        withdrawEnable: walletWithdraw ? walletWithdraw.withdrawEnable : false  // Status Withdraw
                    };
                });
               
                if (confirm('LOAD DATA AKAN MERUBAH DATA SEBELUMNYA, LANJUTKAN??')) {
                    saveToLocalStorage("TOKEN_SCANNER", combinedData);
                }          

                const savedData = getFromLocalStorage("TOKEN_SCANNER", []);
                // Validasi apakah data berhasil disimpan
                if (savedData.length === combinedData.length) {
                   toastr.success("LOAD DATA BERHASIL, SILAKAN REFRESH");
                }                       
            });

            $("#stopSCAN,#reload").click(function () {
                location.reload();
            });
            
    });

    //fungsi memulai pengecekan harga CEX dan DEX
   $("#startSCAN").click(function () {
        $("#sinyalselisih").text('');
        form_off();
        setNullInfoSinyal();
        $("#stopSCAN").show().prop('disabled', false);
        $('#LoadDataBtn, #SettingModal,  #chain-links-container').css('pointer-events', 'none').css('opacity', '0.4');
        // var selectedOption = $("input[name='toggle']:checked").val();
        // if (selectedOption === "option1") {
        //     // Lakukan sesuatu jika option 1 dipilih, misalnya membalik urutan tokens
        //     filteredTokens.reverse();
        // }
        let ConfigScan = getFromLocalStorage('SETTING', {});
        let scanPerKoin = parseInt(ConfigScan.scanPerKoin);
        let jedaTimeGroup = parseInt(ConfigScan.jedaTimeGroup);
        let dexList = getFromLocalStorage("DEX_PILIH", []);

        if (!filteredTokens || filteredTokens.length === 0) {
            console.warn("Tidak ada token yang difilter!");
            return;
        }

        function delay(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        function updateProgress(current, total, startTime, TokenPair) {
            let duration = ((Date.now() - startTime) / 1000 / 60).toFixed(2);
            let progressPercentage = Math.floor((current / total) * 100);
            let progressText = `CHECKING - ${TokenPair} [${current}/${total}] :: Mulai: ${new Date(startTime).toLocaleTimeString()} ~ DURASI [${duration} Menit]`;

            $('#progress-bar').css('width', progressPercentage + '%');
            $('#progress-text').text(progressPercentage + '%');
            $('#progress').text(progressText);
        }

        async function processTokens() {
            let startTime = Date.now();
            let totalTokens = filteredTokens.length;
            let currentProcessed = 0;

            for (let i = 0; i < filteredTokens.length; i += scanPerKoin) {
                let groupTokens = filteredTokens.slice(i, i + scanPerKoin);
                console.log(`Memproses grup ${Math.floor(i / scanPerKoin) + 1}`);
                console.log("-------------------------------");

                let promises = groupTokens.map(async (token, index) => {
                    try {
                       // console.log(`Memproses ${token.symbol_in} => ${token.symbol_out} pada grup ${Math.floor(i / scanPerKoin) + 1} (Anggota ke-${index + 1})`);
                       feeGasGwei()
                        if (!token.status) {
                            console.log(`Token ${token.symbol_in}_${token.symbol_out} tidak aktif.`);
                            return;
                        }

                        let cex = token.cex.toUpperCase();
                        let symbolIn = token.symbol_in.toUpperCase();
                        let symbolOut = token.symbol_out.toUpperCase();
                        let sc_input = token.sc_in.toUpperCase();
                        let sc_output = token.sc_out.toUpperCase();
                        let des_input = token.des_in;
                        let des_output = token.des_out;
                        let NameToken = token.symbol_in.toUpperCase();
                        let NamePair = token.symbol_out.toUpperCase();

                        let TokenPair = `${symbolIn}_${symbolOut}`;
                        // Menggunakan Promise untuk menangani callback
                        await new Promise((resolve) => {
                            getPriceCEX(token, symbolIn, symbolOut, cex, function (error, DataCEX) {                                
                                //console.log("DATA CEX",DataCEX);
                                updateProgress(currentProcessed + index, totalTokens, startTime, `${cex} : ${symbolIn} VS ${symbolOut}`);
                                if (error) {
                                    console.error("Error data from CEX:", error);
                                    toastr.error(`Cek Ulang Harga ${symbolIn} atau ${symbolOut} Exchanger : ${cex}`);
                                    
                                    $('#BUY_' + cex + '_' + TokenPair+'_'+ (DTChain.Nama_Chain).toUpperCase()).text('---').addClass('merah');
                                    $('#SELL_' + cex + '_' + TokenPair+'_'+ (DTChain.Nama_Chain).toUpperCase()).text('---').addClass('merah');

                                        dexList.forEach((dex) => {
                                            let dexId = `${cex}_${dex.toUpperCase()}_${TokenPair}_${(DTChain.Nama_Chain).toUpperCase()}`;
                                            if ($(`#${dexId}`).length) {
                                                $(`#${dexId}`).text('---').addClass('merah');
                                            }
                                        });
                                    resolve(); // Pastikan resolve dipanggil meskipun terjadi error
                                    return;
                                }

                                try {            
                                    let priceBuyTokenCEX = DataCEX.volumes_buyToken[0]?.price || "N/A";
                                    let priceSellTokenCEX = DataCEX.volumes_sellToken[0]?.price || "N/A";

                                    let priceBuyPairCEX = DataCEX.volumes_buyPair[0]?.price || "N/A";
                                    let priceSellPairCEX = DataCEX.volumes_sellPair[0]?.price || "N/A";

                                    let feeWD = parseFloat(DataCEX.feeWD || 0).toFixed(2);
                                    dexList.forEach((dex) => {
                                        let dexId = `${cex}_${dex.toUpperCase()}_${TokenPair}_${(DTChain.Nama_Chain).toUpperCase()}`;
                                        let modalKey = `MODAL_${dex.toUpperCase()}`;
                                        let modalValue = savedSettingData[modalKey];
                                        //console.log(dexId);
                                        let dextype=dex.toLowerCase();

                                        if ($(`#${dexId}`).length) {
                                            var Modal = parseFloat(modalValue);
                                            var amount_in =parseFloat(Modal) / parseFloat(priceBuyTokenCEX);
                                           // console.warn(sc_input, des_input, sc_output, des_output, amount_in, priceBuyPairCEX, dextype, NameToken, NamePair, cex);
                                            getPriceDEX(sc_input, des_input, sc_output, des_output, amount_in, priceBuyPairCEX, dextype, NameToken, NamePair, cex, function (error, DataDEX) {     
                                                if (error) {
                                                    console.error("Error dalam getPriceDEX:", error);
                                                    return;
                                                }else{
                                                    
                                                    if (NameToken == "USDT") {
                                                        $(`span#BUY_${dexId}`).text(` ~ `);
                                                        $(`span#SELL_${dexId}`).text(`${priceSellPairCEX.toFixed(9)}$ ${NamePair} (${cex})`);       
                                                    }else if(NamePair == "USDT"){
                                                        $(`span#BUY_${dexId}`).text(`${priceBuyTokenCEX.toFixed(9)}$ ${NameToken} (${cex})`);
                                                        $(`span#SELL_${dexId}`).text(` ~ `);   
                                                    }else  {
                                                        $(`span#BUY_${dexId}`).text(`${priceBuyTokenCEX.toFixed(9)}$ ${NameToken} (${cex})`);
                                                        $(`span#SELL_${dexId}`).text(`${priceSellPairCEX.toFixed(9)}$ ${NamePair} (${cex})`);    
                                                    }  
                                                    
                                                    //$(`#SWAP_${dexId}`).text(`---`);
                                                   // console.log(DataDEX, DataCEX, Modal, amount_in, priceBuyTokenCEX, priceSellTokenCEX, priceBuyPairCEX, priceSellPairCEX, NameToken, NamePair, dextype);
                                                    ResultEksekusi(DataDEX, DataCEX, Modal, amount_in, priceBuyTokenCEX, priceSellTokenCEX, priceBuyPairCEX, priceSellPairCEX, NameToken, NamePair, dextype); 
                                                  // console.log("DATA DEX", DataDEX);
                                                }
                                            });    
                                            
                                        }
                                    });
                                    
                                   // Mengupdate elemen-elemen dalam tabel dengan ID yang sesuai

                                } catch (innerError) {
                                    console.warn(`Kesalahan saat memproses data token ${TokenPair}:`, innerError);
                                }

                                resolve(); // Memastikan resolve dipanggil meskipun ada kesalahan
                            });
                        });

                    } catch (error) {
                        console.warn(`Kesalahan pada token ${token.symbol_in}_${token.symbol_out}:`, error);
                    }
                });

                await Promise.all(promises);  // Menunggu semua promises selesai

                currentProcessed += groupTokens.length; // Update jumlah token yang telah diproses
                console.log("---------------------------");

                await delay(jedaTimeGroup);  // Menunggu sebelum melanjutkan ke grup berikutnya
            }

            // Pastikan progress bar mencapai 100% setelah seluruh proses selesai
                updateProgress(currentProcessed, totalTokens, startTime, "SELESAI");
                form_on();
                $("#stopSCAN").hide().prop('disabled', false);
                $('#LoadDataBtn, #SettingModal,  #chain-links-container').css('pointer-events', 'auto').css('opacity', '1');

            // console.log("Pengecekan selesai!");
        }

        processTokens();  // Memulai pemrosesan token
    });

    //genereta inputan checkbox
    function generateInputCheckbox(items, containerId, idPrefix, style) {
        const $container = $(`#${containerId}`);
        $container.empty(); // Bersihkan container

        // Jika items adalah objek, ambil key-nya
        if (typeof items === 'object' && !Array.isArray(items)) {
            items = Object.keys(items); // Ambil key dari objek
        }

        // Iterasi dan tambahkan checkbox beserta label
        items.forEach(item => {
            const checkboxId = `${idPrefix}${item.toUpperCase()}`;
            const checkbox = `
                <label class="${style || ''}" for="${checkboxId}">
                    <input type="checkbox" id="${checkboxId}" value="${item}" checked>
                    ${item.toUpperCase()}
                </label>`;
            $container.append(checkbox);
        });
    }

    // Fungsi untuk memuat data dari localStorage saat halaman dimuat
    function loadCheckboxSelections() {
        let errorMessages = [];
        // Muat data CEX
        const savedCEX = getFromLocalStorage("CEX_PILIH", []);
        $('#cex-options input[type="checkbox"]').each(function() {
            $(this).prop('checked', savedCEX.includes($(this).val()));
        });

        // Muat data DEX
        const savedDEX = getFromLocalStorage("DEX_PILIH", []);
        $('#dex-options input[type="checkbox"]').each(function() {
            $(this).prop('checked', savedDEX.includes($(this).val()));
        });

        // Muat data DEXPAIR
        const savedDEXPAIR = getFromLocalStorage("DEXPAIR_PILIH", []);
        $('#dexpair-options input[type="checkbox"]').each(function() {
            $(this).prop('checked', savedDEXPAIR.includes($(this).val()));
        });

      //  const pilihCex = getFromLocalStorage('CEX_PILIH', null);
        if (!savedCEX || !Array.isArray(savedCEX) || savedCEX.length === 0) {
            errorMessages.push('SILAKAN PILIH CEX!');
            $("#cex-options").addClass("error");
            form_on(); // tetap off jika `PILIH_CEX` belum diatur
        }
        
        //const pilihDex = getFromLocalStorage('DEX_PILIH', null);
        if (!savedDEX || !Array.isArray(savedDEX) || savedDEX.length === 0) {
            errorMessages.push('SILAKAN PILIH DEX!');
            $("#dex-options").addClass("error");
            form_on(); // tetap off jika `PILIH_DEX_PAIR` belum diatur
        }  
       // const pilihDexPair = getFromLocalStorage('DEXPAIR_PILIH', null);
        if (!savedDEXPAIR || !Array.isArray(savedDEXPAIR) || savedDEXPAIR.length === 0) {
            errorMessages.push('SILAKAN PILIH DEX PAIR!');
            $("#dexpair-options").addClass("error");
            form_on(); // tetap off jika `PILIH_DEX_PAIR` belum diatur
        }   
        $("#cek").html(errorMessages.join('<br/>')).addClass("text-large");    
    }
    
    // Fungsi untuk menentukan warna berdasarkan nama CEX
    function getWarnaCEX(cex) {
        const cexConfig = CONFIG_CEX[cex.toUpperCase()]; // Ambil konfigurasi berdasarkan nama CEX
        return cexConfig && cexConfig.WARNA ? cexConfig.WARNA : 'black'; // Gunakan warna dari konfigurasi atau 'black' jika tidak ditemukan
    }

    //fungsi filter TOKEN berdasarkan CEX,DEX dan DEX-PAIR
    //fungsi filter TOKEN berdasarkan CEX,DEX dan DEX-PAIR
    function filterTokens() {
        const allTokens = getFromLocalStorage("TOKEN_SCANNER", []); // Ambil semua token dari localStorage
        const selectedCEX = getFromLocalStorage("CEX_PILIH", []); // Ambil pilihan CEX dari localStorage
        const selectedDEXPAIR = getFromLocalStorage("DEXPAIR_PILIH", []); // Ambil pilihan DEXPAIR dari localStorage

        if (!Array.isArray(allTokens) || allTokens.length === 0) {
            console.warn("No tokens available for filtering.");
            return [];
        }

        // Cek jika "NON" dipilih
        const isNonSelected = selectedDEXPAIR.includes("NON");
        const dexPairs = Object.keys(DTChain.PAIRDEXS).filter(pair => pair !== "NON"); // Semua pasangan kecuali "NON"

        // Filter token
        const filteredTokens = allTokens.filter(token => {
            const validCEX = selectedCEX.includes(token.cex); // Token harus memiliki CEX yang dipilih
            let validDexPair;

            if (isNonSelected) {
                // Jika "NON" dipilih
                validDexPair = !dexPairs.some(pair => 
                    token.symbol_in === pair || token.symbol_out === pair
                ) || selectedDEXPAIR.some(pair =>
                    token.symbol_in === pair || token.symbol_out === pair
                ); // Tampilkan token di luar daftar DEX kecuali yang dipilih
            } else {
                // Jika "NON" tidak dipilih
                validDexPair = selectedDEXPAIR.some(pair => 
                    token.symbol_in === pair || token.symbol_out === pair
                );
            }

            // Kembalikan token jika CEX valid, DEX pair valid, dan status true
            return validCEX && validDexPair && token.status === true && token.withdrawEnable === true && token.depositEnable === true;
        });
        return filteredTokens;
    }
    function filterTokens2() {
        const allTokens = getFromLocalStorage("TOKEN_SCANNER", []); // Ambil semua token dari localStorage
        const selectedCEX = getFromLocalStorage("CEX_PILIH", []); // Ambil pilihan CEX dari localStorage
        const selectedDEXPAIR = getFromLocalStorage("DEXPAIR_PILIH", []); // Ambil pilihan DEXPAIR dari localStorage

        if (!Array.isArray(allTokens) || allTokens.length === 0) {
            console.warn("No tokens available for filtering.");
            return [];
        }

        // Cek jika "NON" dipilih
        const isNonSelected = selectedDEXPAIR.includes("NON");
        const dexPairs = Object.keys(DTChain.PAIRDEXS).filter(pair => pair !== "NON"); // Semua pasangan kecuali "NON"

        // Filter token
        const filteredTokens = allTokens.filter(token => {
            const validCEX = selectedCEX.includes(token.cex); // Token harus memiliki CEX yang dipilih
            let validDexPair;

            if (isNonSelected) {
                // Jika "NON" dipilih
                validDexPair = !dexPairs.some(pair => 
                    token.symbol_in === pair || token.symbol_out === pair
                ) || selectedDEXPAIR.some(pair =>
                    token.symbol_in === pair || token.symbol_out === pair
                ); // Tampilkan token di luar daftar DEX kecuali yang dipilih
            } else {
                // Jika "NON" tidak dipilih
                validDexPair = selectedDEXPAIR.some(pair => 
                    token.symbol_in === pair || token.symbol_out === pair
                );
            }

            // Kembalikan token jika CEX valid, DEX pair valid, dan status true
            return validCEX && validDexPair && token.status === true;
        });
        return filteredTokens;
    }

    // Fungsi untuk menampilkan sinyal DEX
    function loadSignalData() {
        let selectedDEX = getFromLocalStorage('DEX_PILIH', []); // Ambil pilihan DEX dari localStorage

        let sinyalContainer = document.getElementById('sinyal-container');
        sinyalContainer.innerHTML = ''; // Kosongkan sebelumnya jika ada perubahan

        selectedDEX.forEach(dex => {
            // Menambahkan elemen sinyal untuk setiap DEX yang dipilih
            let sinyalItem = document.createElement('div');
            sinyalItem.classList.add('sinyal-item');
            sinyalItem.setAttribute('data-dex', dex);

            let label = document.createElement('b');
            label.innerText = dex.toUpperCase(); // Menampilkan nama DEX

            let signalSpan = document.createElement('span');
            signalSpan.classList.add('uk-text', 'uk-text-small', 'uk-text-primary');
            signalSpan.setAttribute('id', `sinyal${dex.toLowerCase()}`); // ID dinamis untuk sinyal setiap DEX

            sinyalItem.appendChild(label);
            sinyalItem.innerHTML += ": "; // Separator
            sinyalItem.appendChild(signalSpan);

            sinyalContainer.appendChild(sinyalItem);
        });
    }

    // memuat data TABEL berdasarkan filter tertentu
    function loadStoredData(filteredData) {
        $('.table-header th').css('background-color', DTChain.COLOR_CHAIN); 
        loadSignalData();
        let selectedDEX = getFromLocalStorage('DEX_PILIH', []); // Ambil pilihan DEX dari localStorage
        let appSettings = getFromLocalStorage('SETTING', {}); // Ambil pengaturan dari localStorage
        
        let $InfoStatus = $('div#InfoStatus');
        $InfoStatus.text("Sedang Memuat DATA TOKEN...").show();

        let $tableBody = $('#dataTableBody');
        
        if (!Array.isArray(filteredData) || filteredData.length === 0) {
            // Jika tidak ada data, tampilkan pesan kosong
            $InfoStatus.text("Tidak ada data token yang ditemukan.");
            setTimeout(() => $InfoStatus.fadeOut(), 2000);
            $('#tokenCount').text(" TOTAL : 0 PAIR-TOKEN ");
            return;
        }

        $tableBody.empty(); // Kosongkan tabel sebelum menambahkan data baru
        // Menambahkan kolom header secara dinamis, termasuk label DEX
        let $headerRow = $('.table-header');
        $headerRow.empty(); // Mengosongkan header yang ada sebelumnya

        // Menambahkan kolom header untuk data
        $headerRow.append('<th class="uk-text-center uk-text-bold">PRICE & VOL BUY</th>');
        $headerRow.append('<th class="uk-text-center uk-text-bold">DETAIL TOKEN</th>');

        // Tambahkan header untuk DEX di tengah
        selectedDEX.forEach((dex) => {
            let modalName = appSettings[`MODAL_${dex.toUpperCase()}`] || 0;
            $headerRow.append(`<th class="uk-text-center uk-text-bold">${dex} [${modalName}]</th>`);
        });

        $headerRow.append('<th class="uk-text-center uk-text-bold">PRICE & VOL SELL</th>');

        // Iterasi data yang telah difilter dan buat baris tabel
        filteredData.forEach((data, index) => {
            const warnaCEX = getWarnaCEX(data.cex); // Warna berdasarkan nama CEX

           // Default status untuk Wallet
            let withdrawStatus = { text: '??', style: 'color:red; font-weight:bold;' };
            let depositStatus = { text: '??', style: 'color:red; font-weight:bold;' };

            const isWithdrawEnabled = data.withdrawEnable === true || data.withdrawEnable === 'true';
            withdrawStatus = {
                text: isWithdrawEnabled ? 'WD' : 'WX',
                style: isWithdrawEnabled ? 'color:black; font-weight:bold;' : 'color:red; font-weight:bold;',
            };
            const isDepositEnabled = data.depositEnable === true || data.depositEnable === 'true';
            depositStatus = {
                text: isDepositEnabled ? 'DP' : 'DX',
                style: isDepositEnabled ? 'color:black; font-weight:bold;' : 'color:red; font-weight:bold;',
            };

            var urlsCEX = GeturlExchanger(data.cex, data.symbol_in, data.symbol_out);
            var linkToken = urlsCEX.tradeToken 
                ? `<a href="${urlsCEX.tradeToken}" target="_blank"><b><label>${(data.symbol_in).toUpperCase()}</label></b></a>` 
                : `<b><label>${(data.symbol_in).toUpperCase()}</label></b>`;

            var linkPair = urlsCEX.tradePair 
                ? `<a href="${urlsCEX.tradePair}" target="_blank"><b><label>${(data.symbol_out).toUpperCase()}</label></b></a>` 
                : `<b><label>${(data.symbol_out).toUpperCase()}</label></b>`;

            let transformedChain = 
                DTChain.Nama_Chain.toUpperCase() === "ETHEREUM" ? "ETH" : 
                DTChain.Nama_Chain.toUpperCase() === "POLYGON" ? "POL" : 
                DTChain.Nama_Chain.toUpperCase() === "AVAX" ? "AVAX_CCHAIN" : 
                DTChain.Nama_Chain.toUpperCase();  
            
            var linkLIFI ='<span class=uk-text-success><a href=https://jumper.exchange/?fromChain='+DTChain.Kode_Chain+'&fromToken='+data.sc_in+'&toChain='+DTChain.Kode_Chain+'&toToken='+data.sc_out+' target=_blank><img src=https://jumper.exchange/apple-touch-icon-180x180.png alt=LIFI width=20px /></a></a></span>';
            var linkOKDEX =  "<span class=uk-text-success><a href=https://www.okx.com/web3/dex-swap?inputChain="+DTChain.Kode_Chain+"&inputCurrency=" + data.sc_in + "&outputChain=501&outputCurrency=" + data.sc_out+" target=_blank><img src=https://cdn.bitkeep.vip/u_b_d5720c60-81ad-11ed-8134-f90501d87feb.png alt=OKXDEX width=25px /></a></span>";      
            var linkUNIDEX = "<span class=uk-text-success><a href=https://app.unidex.exchange/?chain=" + DTChain.Nama_Chain + "&from=" + data.sc_in + "&to=" + data.sc_out + " target=_blank><img src=https://s1.coincarp.com/logo/1/unidex.png?style=200 alt=UNIDEX width=20px /></a></span>";
            var linkRango = "<span class=uk-text-success><a href=https://app.rango.exchange/bridge?fromBlockchain=" +transformedChain+ "&toBlockchain=" + transformedChain +"&fromToken="+ data.symbol_in +"--" + data.sc_in + "&toToken=" + data.symbol_out +"--"+data.sc_out+" target=_blank><img src=https://rango.exchange/logo.png alt=RANGO width=20px /></a></span>";

            var linkStok = '';
        
            // Mendapatkan semua wallet dari konfigurasi CONFIG_CEX berdasarkan variabel `cex`
            Object.keys(DTChain.CEXCHAIN[data.cex]).forEach((key, index) => {
                if (key.includes('address')) {
                    // Menambahkan link untuk setiap wallet ke dalam linkStok
                    linkStok += '<b><a href='+DTChain.URL_Chain+'/token/' + data.sc_in + '?a=' + DTChain.CEXCHAIN[data.cex][key] + ' target="_blank"> #' + (index + 1) + ' </a></b>';
                }
            });

            linkStok = linkStok.slice(0, -2);        
            linkStok += '<div></div>';

            // Baris tabel
            let row = `
                <tr data-index="${index}">
                    <td style="text-align:center; vertical-align: middle;" class="uk-text-success" ><a href=${urlsCEX.tradeToken} target="_blank"><span id=BUY_${data.cex}_${data.symbol_in}_${data.symbol_out}_${(DTChain.Nama_Chain).toUpperCase()}>PRICE & VOL BUY <br>${data.cex}</span></a></td>
                    <td class="uk-text-center">
                        <input type="checkbox" class="statusCheckbox" data-index="${data.no}" ${data.status ? 'checked' : ''}>
                        ${linkToken}  VS ${linkPair}</br>
                       <span style="${withdrawStatus.style}"><a href=${urlsCEX.withdrawUrl} target="_blank">${withdrawStatus.text}</a> </span> <a href="${URL_Chain}/token/${data.sc_in}" target="_blank" class="uk-link">[SC]</a>~ 
                        <span style="${depositStatus.style}"><a href=${urlsCEX.depositUrl} target="_blank">${depositStatus.text}</a></span> <a href="${URL_Chain}/token/${data.sc_out}" target="_blank" class="uk-link">[SC]</a></br>
                        <span style="color: ${warnaCEX}; font-weight:bolder;">${data.cex}</span>: ${linkStok}</br>
                        ${linkOKDEX} ${linkLIFI} ${linkUNIDEX} ${linkRango}
                    </td>
                    
            `;

            // Tambahkan kolom DEX di tengah tabel
            selectedDEX.forEach((dex) => {
                let modalValue = data[dex] || '-'; // Ambil nilai dari data sesuai dengan DEX
                let idCELL=`${data.cex}_${dex.toUpperCase()}_${data.symbol_in}_${data.symbol_out}_${(DTChain.Nama_Chain).toUpperCase()}`;
                //console.log(idCELL);
                row += `
                    <td class="uk-text-center" style="vertical-align: middle;" id=${idCELL} >
                        <a href=${urlsCEX.tradeToken} target="_blank"><span class=uk-text-success id=BUY_${idCELL}>BUY CEX ? </span></a> <br/>
                        <span class=uk-text-secondary id=SWAP_${idCELL}>SWAP DEX ?</span><br/>
                        <a href=${urlsCEX.tradePair} target="_blank"><span class=uk-text-danger id=SELL_${idCELL}>SELL CEX ? </span></a></br>
                        <span class=uk-text-primary id=RESULT_${idCELL}>RESULT ? </span>
                    </td>
                `;
            });

            // Lanjutkan dengan kolom lain
            row += `
                    <td style="text-align:center; vertical-align: middle;" class="uk-text-danger"><a href=${urlsCEX.tradePair} target="_blank"><span id=SELL_${data.cex}_${data.symbol_in}_${data.symbol_out}_${(DTChain.Nama_Chain).toUpperCase()}>PRICE & VOL SELL <br>${data.cex}</span></a></td>
                </tr>
            `;

            // Tambahkan baris ke tabel
            $tableBody.append(row);
        });

        // Perbarui total token
        $('#tokenCount').text(` TOTAL : ${filteredData.length} PAIR-TOKEN `);
        // Sembunyikan pesan loading setelah selesai
        $InfoStatus.text("SELESAI, Memuat DATA TOKEN !!");
       
        $("#startSCAN").show();
        setTimeout(() => $InfoStatus.fadeOut(), 2000);

        // Perbarui ikon urutan jika diperlukan
        updateSortIcons();
    }

    function GeturlExchanger(cex, NameToken, NamePair) {
        // Konversi nama token dan pasangan ke uppercase
        const token = NameToken.toUpperCase();
        const pair = NamePair.toUpperCase();

        let baseUrlTradeToken = null;
        let baseUrlTradePair = null;
        let baseUrlWithdraw = null;
        let baseUrlDeposit = null;

        // Menentukan URL berdasarkan nilai cex
        if (cex === "GATE") {
            baseUrlTradeToken = `https://www.gate.io/trade/${token}_USDT`;
            baseUrlTradePair = `https://www.gate.io/trade/${pair}_USDT`;
            baseUrlWithdraw = `https://www.gate.io/myaccount/withdraw/${token}`;
            baseUrlDeposit = `https://www.gate.io/myaccount/deposit/${pair}`;
        } else if (cex === "BINANCE") {
            baseUrlTradeToken = `https://www.binance.com/en/trade/${token}_USDT`;
            baseUrlTradePair = `https://www.binance.com/en/trade/${pair}_USDT`;
            baseUrlWithdraw = `https://www.binance.com/en/my/wallet/account/main/withdrawal/crypto/${token}`;
            baseUrlDeposit = `https://www.binance.com/en/my/wallet/account/main/deposit/crypto/${pair}`;
        } else if (cex === "KUCOIN") {
            baseUrlTradeToken = `https://www.kucoin.com/trade/${token}-USDT`;
            baseUrlTradePair = `https://www.kucoin.com/trade/${pair}-USDT`;
            baseUrlWithdraw = `https://www.kucoin.com/assets/withdraw/${token}`;
            baseUrlDeposit = `https://www.kucoin.com/assets/coin/${pair}`;
        } else if (cex === "BITGET") {
            baseUrlTradeToken = `https://www.bitget.com/spot/${token}USDT`;
            baseUrlTradePair = `https://www.bitget.com/spot/${pair}USDT`;
            baseUrlWithdraw = `https://www.bitget.com/asset/withdraw`;
            baseUrlDeposit = `https://www.bitget.com/asset/recharge`;
        } else if (cex === "BYBIT") {
            baseUrlTradeToken = `https://www.bybit.com/en/trade/spot/${token}/USDT`;
            baseUrlTradePair = `https://www.bybit.com/en/trade/spot/${pair}/USDT`;
            baseUrlWithdraw = "https://www.bybit.com/user/assets/withdraw";
            baseUrlDeposit = "https://www.bybit.com/user/assets/deposit";
        } else if (cex === "MEXC") {
            baseUrlTradeToken = `https://www.mexc.com/exchange/${token}_USDT?_from=search`;
            baseUrlTradePair = `https://www.mexc.com/exchange/${pair}_USDT?_from=search`;
            baseUrlWithdraw = `https://www.mexc.com/assets/withdraw/${token}`;
            baseUrlDeposit = `https://www.mexc.com/assets/deposit/${pair}`;
        } else if (cex === "OKX") {
            baseUrlTradeToken = `https://www.okx.com/trade-spot/${token}-usdt`;
            baseUrlTradePair = `https://www.okx.com/trade-spot/${pair}-usdt`;
            baseUrlWithdraw = `https://www.okx.com/balance/withdrawal/${token}-chain`;
            baseUrlDeposit = `https://www.okx.com/balance/recharge/${pair}`;
        }

        // Kembalikan objek URL
        return {
            tradeToken: baseUrlTradeToken,
            tradePair: baseUrlTradePair,
            withdrawUrl: baseUrlWithdraw,
            depositUrl: baseUrlDeposit
        };
    }

    $(document).on('change', '.statusCheckbox', function(event) {
        event.preventDefault(); // Mencegah pengiriman form jika ada
        const no = $(this).data('index');
        const isChecked = $(this).prop('checked');
        const storedData = getFromLocalStorage("TOKEN_SCANNER", []);

        const tokenIndex = storedData.findIndex(t => t.no === no);
        if (tokenIndex !== -1) {
            storedData[tokenIndex].status = isChecked;
            saveToLocalStorage("TOKEN_SCANNER", storedData);

            $(this).next().text(isChecked ? 'Aktif' : 'Tidak Aktif');
            const statusCell = $(this).closest('tr').find('.status-cell');
            statusCell.text(isChecked ? 'Aktif' : 'Tidak Aktif');
        }
    });

    // Menampilkan form settingan
    $("#SettingModal").on("click", function () {
        UIkit.modal("#modal-setting").show(); // Menampilkan modal settingan
        let appSettings = getFromLocalStorage('SETTING', {}); // Ambil data pengaturan dari localStorage

        // Daftar DEX yang digunakan, diambil dari DTChain.DEXS
        const dexList = DTChain.DEXS || []; // Pastikan DTChain.DEXS ada, jika tidak gunakan array kosong
       // console.log(dexList);
        // Fungsi untuk memuat pengaturan ke dalam form
        function loadSettings() {
            // Gunakan fungsi generateInputModal untuk membuat input DEX
            generateInputModal(dexList);

            // Isi nilai modal DEX dari appSettings
            dexList.forEach((dex) => {
                const modalValue = appSettings[`MODAL_${dex.toUpperCase()}`] || "0";
                $(`#Modal${dex.toUpperCase()}`).val(modalValue); // Isi input dengan nilai yang sesuai
            });

            // Isi setting scanner
            $('#user').val(appSettings.nickname || ''); // Nickname
            $('#inFilterPNL').val(appSettings.filterPNL || 0); // Filter PNL
            $('#jeda-time-group').val(appSettings.jedaTimeGroup || 400); // Jeda Time Group
            $('#jeda-koin').val(appSettings.jedaKoin || 200); // Jeda Koin
            $('#walletMETA').val(appSettings.walletMeta || ''); // Wallet MetaMask
            $('#speedScan').val(appSettings.speedScan || 4); // Speed Scan

            // Pilih radio button sesuai nilai yang ada di setting
            $(`input[name="koin-group"][value="${appSettings.scanPerKoin || 10}"]`).prop('checked', true);
            $(`input[name="waktu-tunggu"][value="${appSettings.speedScan || 4}"]`).prop('checked', true);
        }

        // Panggil fungsi untuk memuat pengaturan
        loadSettings();
    });

    // simpan setingan
    $('#save-config').on('click', function() {
        // Ambil nilai dari input modal
        let nickname = $('#user').val();
        let filterPNL = $('#inFilterPNL').val();
        let jedaTimeGroup = $('#jeda-time-group').val();
        let jedaKoin = $('#jeda-koin').val();
        let walletMeta = $('#walletMETA').val();

        // Periksa apakah inputan tidak kosong
        if (!nickname || !filterPNL || !jedaTimeGroup || !jedaKoin || !walletMeta) {
            alert('Semua input wajib diisi!');
            return;
        }

        // Ambil nilai dari radio button "SCAN PERKOIN"
        let scanPerKoin = $('input[name="koin-group"]:checked').val();

        // Ambil nilai dari radio button "SPEED SCAN"
        let speedScan = $('input[name="waktu-tunggu"]:checked').val();

        // Ambil data modal untuk setiap DEX dan simpan dalam objek dexData
        let dexData = {};
        DTChain.DEXS.forEach(dex => {
            let modalValue = $(`#Modal${dex.toUpperCase()}`).val();
            if (modalValue) {
                dexData[`MODAL_${dex.toUpperCase()}`] = modalValue;
            }
        });

        // Gabungkan data modal DEX dengan pengaturan aplikasi
        let appSettings = {
            ...dexData,  // Menambahkan data modal DEX
            nickname: nickname,
            filterPNL: filterPNL,
            jedaTimeGroup: jedaTimeGroup,
            jedaKoin: jedaKoin,
            walletMeta: walletMeta,
            scanPerKoin: scanPerKoin,
            speedScan: speedScan
        };

        // Simpan semua data ke localStorage dalam satu grup
        saveToLocalStorage('SETTING', appSettings);
         // Menutup modal setelah menyimpan data
         UIkit.modal("#modal-setting").hide();
    
        alert("SIMPAN SETTING APLIKASI BERHASIL!!");
        location.reload();
    });

    // Fungsi untuk menangani perubahan CEX/DEX/DEXPAIR
    $(document).on('change', 'input[type="checkbox"]', function() {
        // Menentukan kategori checkbox berdasarkan ID
        const groupName = $(this).closest('div').attr('id'); // Ambil ID div induk dari checkbox
        
        let selectedValues = [];
        $(`#${groupName} input[type="checkbox"]:checked`).each(function() {
            selectedValues.push($(this).val());
        });

        // Tentukan key lokalStorage berdasarkan groupName
        const localStorageKeyMap = {
            'cex-options': 'CEX_PILIH',
            'dex-options': 'DEX_PILIH',
            'dexpair-options': 'DEXPAIR_PILIH'
        };
        const localStorageKey = localStorageKeyMap[groupName];

        if (localStorageKey) {
            saveToLocalStorage(localStorageKey, selectedValues);  // Simpan ke localStorage
           // console.log(`${groupName} selected saved:`, selectedValues);
            UIkit.notification(`SETTING APLIKASI menjadi ${selectedValues} !`, { status: 'success' });
        }

        // Memanggil fungsi filter dan reload tabel setelah ada perubahan
      //  const filteredTokens = filterTokens();
        loadStoredData(filteredTokens);
        location.reload();
    });

    // Fungsi untuk mengurutkan tabel
    function sortTable(columnIndex) {
        const rows = $('#dataTableBody tr').get();

        rows.sort(function(a, b) {
            const keyA = $(a).children('td').eq(columnIndex).text().toUpperCase();
            const keyB = $(b).children('td').eq(columnIndex).text().toUpperCase();

            if (sortOrder[columnIndex] === undefined) {
                sortOrder[columnIndex] = true; // Default ke urutan naik
            }

            if (keyA < keyB) return sortOrder[columnIndex] ? -1 : 1;
            if (keyA > keyB) return sortOrder[columnIndex] ? 1 : -1;
            return 0;
        });

        // Kosongkan tabel dan tambahkan kembali baris yang sudah diurutkan
        $('#dataTableBody').empty().append(rows);

        // Update kolom No agar tetap berurutan
        $('#dataTableBody tr').each((index, row) => {
            $(row).children('td').first().text(index + 1); // Set nomor berurutan
        });

        // Toggle urutan untuk kolom yang sama
        sortOrder[columnIndex] = !sortOrder[columnIndex];
        updateSortIcons();
    }

    // Memperbarui ikon urutan
    function updateSortIcons() {
        $('.sort-icon').html(''); // Reset semua ikon
        for (let index in sortOrder) {
            const icon = sortOrder[index] ? '▲' : '▼';
            $('#sortIcon' + index).html(icon);
        }
    }

    //fungsi generate setting modal untuk DEX
    function generateInputModal(dexList) {
        const container = $('#modal-container');
        container.empty(); // Bersihkan container
        dexList.forEach(dex => {
            // Mengubah nama dex menjadi huruf besar
            const dexUpperCase = dex.toUpperCase();
            // Membuat heading
            const heading = $('<h5></h5>')
                .css({ 'margin': '8px 0px', 'color': '#e4322c' })
                .text(`Modal ${dexUpperCase}`);
            
            container.append(heading);

            // Membuat modal div
            const modalDiv = $('<div></div>');
            // Input modal
            const modalInput = $('<input>')
                .attr('type', 'number')
                .attr('id', `Modal${dexUpperCase}`)
                .addClass('uk-input')
                .val('0')
                .attr('required', true);
            // Tambahkan label dan input ke modal div
            modalDiv.append(modalInput);

            // Tambahkan modal div ke container
            container.append(modalDiv);
        });
    }

    // Fungsi untuk mengambil status wallet berdasarkan CEX dan token
    function getWalletStatus(cex, tokenName) {
        // Validasi parameter wajib
        if (!cex || !tokenName) {
            console.error("Parameter tidak valid: cex, tokenName atau  kosong.");
            return null;
        }

        const WalletCEXData = getFromLocalStorage('WALLET_CEX', {});
        // Pastikan data ada
        if (WalletCEXData.length > 0) {
            // Cari token berdasarkan cex, tokenName, dan scToken
            const token = WalletCEXData.find(item => 
                item.cex === cex &&               // Cek nama CEX (case-insensitive)
                item.tokenName === tokenName     // Cek smart contract token (case-insensitive)
            );

            // Jika token ditemukan, kembalikan status withdraw dan deposit
            if (token) {
                return {
                    withdrawEnable: token.withdrawEnable || false,  // Status Withdraw
                    depositEnable: token.depositEnable || false     // Status Deposit
                };
            }
        }
        return null;
    }

    // Fungsi untuk memproses data order book umum
    function processOrderBook(data) {
        const priceBuy = data.bids.slice(0, 3).map(([price, volume]) => ({
            price: parseFloat(price),
            volume: parseFloat(volume) * parseFloat(price) // Volume dalam USD
        }));
        const priceSell = data.asks.slice(0, 3).map(([price, volume]) => ({
            price: parseFloat(price),
            volume: parseFloat(volume) * parseFloat(price) // Volume dalam USD
        }));
        return { priceBuy, priceSell };
    }

    // Fungsi cek harga pada CEX
    function getPriceCEX(coins, NameToken, NamePair, cex, callback) {
        const config = exchangeConfig[cex];

        if (!config) {
            callback(`Exchange ${cex} tidak ditemukan dalam konfigurasi.`, null);
            return;
        }

         // Ambil data TOKEN_SCANNER dari localStorage
        const feeList = getFromLocalStorage("TOKEN_SCANNER", []);
        if (!Array.isArray(feeList) || feeList.length === 0) {
            toastr.error("PERIKSA ULANG FEE WD dari EXCHANGER !!");
            callback("Token scanner belum diatur.", null);
            return;
        }

        // Cari token yang sesuai berdasarkan symbol dan cex
        const tokenData = feeList.find(item => item.symbol_in === NameToken && item.cex === cex);
        if (!tokenData) {
            toastr.error(`Token ${coins.symbol} untuk CEX ${cex} tidak ditemukan di TOKEN_SCANNER`);
            callback(`Token ${coins.symbol} untuk CEX ${cex} tidak ditemukan.`, null);
            return;
        }

        const isUSDT = (token) => token === "USDT";
        let results = {};

        const urls = [
            isUSDT(NameToken) ? null : config.url({ symbol: NameToken }),
            isUSDT(NamePair) ? null : config.url({ symbol: NamePair })
        ];

        // Fungsi untuk memproses hasil jika kedua token sudah mendapatkan harga
        const processFinalResult = () => {
            if (Object.keys(results).length === 2) {
                const feeWD = tokenData.feeWDs * results[NameToken].price_buy;
                // Validasi feeWD kosong atau tidak valid
               
                if (feeWD === null || feeWD === 'N/A' || isNaN(feeWD)) {
                    callback(`FeeWD untuk ${NameToken} di ${cex} tidak valid. ${feeWD}`, null);
                    return;
                }

                const finalResult = {
                    token: NameToken.toUpperCase(),
                    sc_input: coins.sc_in,
                    sc_output: coins.sc_out,
                    pair: NamePair.toUpperCase(),
                    cex: cex.toUpperCase(),
                    price_sellToken: results[NameToken].price_sell,
                    price_buyToken: results[NameToken].price_buy,
                    price_sellPair: results[NamePair].price_sell,
                    price_buyPair: results[NamePair].price_buy,
                    volumes_sellToken: results[NameToken].volumes_sell,
                    volumes_buyToken: results[NameToken].volumes_buy,
                    volumes_sellPair: results[NamePair].volumes_sell,
                    volumes_buyPair: results[NamePair].volumes_buy,
                    feeWD: feeWD // Fee dihitung setelah harga diperoleh
                };

                updateTableVolCEX({}, finalResult, cex);
                callback(null, finalResult);
            }
        };

        // Iterasi untuk setiap token/pair dan memproses data
        urls.forEach((url, index) => {
            const tokenName = index === 0 ? NameToken : NamePair;

            if (isUSDT(tokenName)) {
                const feeWD = tokenData.feeWDs * 1;
                // Jika token adalah USDT, gunakan nilai default
                results[tokenName] = {
                    price_sell: 1,
                    price_buy: 1,
                    volumes_sell: [{ price: 1, volume: 1000000 }],
                    volumes_buy: [{ price: 1, volume: 1000000 }],
                    feeWD:feeWD
                };
                processFinalResult(); // Cek jika kedua token sudah diproses
                return;
            }

            if (url) {
                $.ajax({
                    url: url,
                    method: 'GET',
                    success: function (data) {
                        let processedData;
                        try {
                            processedData = config.processData(data);
                        } catch (error) {
                            console.error(`Error processing data untuk ${tokenName} di ${cex}:`, error);
                            callback(`Error processing data untuk ${tokenName} di ${cex}.`, null);
                            return;
                        }

                        const priceBuy = processedData.priceSell[0]?.price || null;
                        const priceSell = processedData.priceBuy[0]?.price || null;

                        if (priceBuy === null || priceSell === null) {
                            callback(`Harga buy/sell untuk ${tokenName} di ${cex} tidak tersedia.`, null);
                            return;
                        }

                        results[tokenName] = {
                            price_sell: priceSell,
                            price_buy: priceBuy,
                            volumes_sell: processedData.priceBuy,
                            volumes_buy: processedData.priceSell
                        };

                        processFinalResult(); // Cek jika kedua token sudah diproses
                    },
                    error: function (xhr) {
                        const errorMessage = xhr.responseJSON?.msg || "Unknown ERROR";
                       // toastr.warning(`ERROR: ${errorMessage}, KONEKSI ${cex.toUpperCase()} GAGAL TOKEN ${tokenName}`);
                        callback(`Error koneksi API untuk ${tokenName} di ${cex}: ${errorMessage}`, null);
                    }
                });
            }
        });
    }

    // Fungsi update price & vol untuk token dan pair
   function updateTableVolCEX(processedData, finalResult, cex) {
        const cexName = cex.toUpperCase();
        const TokenPair = finalResult.token + "_" + finalResult.pair;
        
        // Pengecekan jika token bernilai "USDT" untuk id=buy
        if (finalResult.token === "USDT") {
            $('#BUY_' + cexName + '_' + TokenPair+'_'+ (DTChain.Nama_Chain).toUpperCase()).html(
                `<span class='uk-text-secondary uk-text-bolder' style="color: black;">~</span><br/>`
            );
        } else {
            $('#BUY_' + cexName + '_' + TokenPair+'_'+ (DTChain.Nama_Chain).toUpperCase()).html(
                `<span class='uk-text-secondary uk-text-bolder'>USDT -> ${finalResult.token}</span><br/>` +  // Menambahkan teks "USDT -> token"
                finalResult.volumes_buyToken.map((data, index) => {
                    return `${data.price.toFixed(7) || 0} : <b>${data.volume.toFixed(2) || 0}$</b><br/>`;
                }).join('') +
                `<span class='uk-text-primary uk-text-bolder'>FeeWD: ${(finalResult.feeWD).toFixed(2)}$</span>`
            );
        }

        // Pengecekan jika pair bernilai "USDT" untuk id=sell
        if (finalResult.pair === "USDT") {
            $('#SELL_' + cexName + '_' + TokenPair+'_'+ (DTChain.Nama_Chain).toUpperCase()).html(
                `<span class='uk-text-secondary uk-text-bolder' style="color: black;">~</span><br/>`
            );
        } else {
            $('#SELL_' + cexName + '_' + TokenPair+'_'+ (DTChain.Nama_Chain).toUpperCase()).html(
                `<span class='uk-text-secondary uk-text-bolder'>${finalResult.pair} -> USDT</span><br/>` +  // Menambahkan teks "pair -> USDT"
                finalResult.volumes_sellPair.map((data, index) => {
                    return `${data.price.toFixed(7) || 0} : <b>${data.volume.toFixed(2) || 0}$</b><br/>`;
                }).join('')
            );
        }
    }

    // list api OKXDEX sell_BINANCE_USDT_buy_0x_BAL
    const apiKeysOKXDEX = [
        
        {
            ApiKeyOKX: "71cbe094-380a-4146-b619-e81a254c0702",
            secretKeyOKX: "5116D48C1847EB2D7BDD6DDD1FC8B199",
            PassphraseOKX: "Macpro-2025",
            ProjectOKX: "249fb586f1aa8adadfd2fa5cbb05369e"
        },
        {
            ApiKeyOKX: "6866441f-6510-4175-b032-342ad6798817",
            secretKeyOKX: "E6E4285106CB101B39FECC385B64CAB1",
            PassphraseOKX: "Arekpinter123.",
            ProjectOKX: "828fe20c82773f89a150969601e75688"
        },
        {
            ApiKeyOKX: "5b36b05d-3e44-4809-abde-9c9cadac81f3",
            secretKeyOKX: "0DC0BF7BE076060AE11A4913DBC0E1AF",
            PassphraseOKX: "Macpro-2025",
            ProjectOKX: "1a6117057281caf1d8ff802bab7e5572"
        },
        {
          ProjectOKX : "4f02cf60cca8c0356cbffaeb3ae3de65",
          secretKeyOKX : "02FF179B12209C442E30A2FF0232227E",
          PassphraseOKX : "Macpro-2025",
          ApiKeyOKX : "3d8ad489-48fe-4d15-b250-7e1c5b1721d1",   
        },
        {
          ProjectOKX : "b61421c36f7a6c9c803a1c0c85db41a6",
          secretKeyOKX : "C4D93507CDB6CC3602A0CDF46D365066",
          PassphraseOKX : "Macpro-2025",
          ApiKeyOKX : "31d3bd0a-15f8-437f-9b01-e84178b81a06",   
        },
        {
            ProjectOKX: "4e8e5c10716f26e58caf88acecbd2b06",
            ApiKeyOKX: "9d00b601-2763-463e-ab4a-d970823ff4b2",
            PassphraseOKX: "Arekpinter123.",
            secretKeyOKX: "4409A9102D8010AD94237AB29A285827"
        },
        {
            ProjectOKX: "7c18497a161e2a3475929a63527beb17",
            ApiKeyOKX: "d6563639-c3be-4ab0-b38f-0b6ddf1dd7a5",
            PassphraseOKX: "Arekpinter123.",
            secretKeyOKX: "39178E81182DF92B6FF29FB745E28744"
        },
        {
            ProjectOKX: "e1db35c604b45dab958ae051f4e8de8c",
            ApiKeyOKX: "0937cffb-702b-4aeb-97bf-2df2ec32a0f7",
            PassphraseOKX: "Arekpinter123.",
            secretKeyOKX: "183E0893CFA33CBFC2ADFAEB4592B806",
        },
        {
            ProjectOKX: "f19ab2804dc1352379b0ffb62c6d40ee",
            ApiKeyOKX: "f0814b42-e9a6-4c5c-b606-3b705b87ba2b",
            PassphraseOKX: "Arekpinter123.",
            secretKeyOKX: "5A19C7452C6170E5E482693CFCC1C4FF",
        }
        ,
        {
            ProjectOKX: "ffca925f3b8e90eb010f89e65e04c186",
            ApiKeyOKX: "9093d88d-5008-4a30-a612-4a01c1c64bda",
            PassphraseOKX: "Arbit_2024",
            secretKeyOKX: "2E32CDC680B831D5A027207EBB9546E2",
        },
        {
            ProjectOKX: "2a027ce25366154188b4258d0491028a",
            ApiKeyOKX: "d60050cc-7178-4e34-b22e-9310add9aa69",
            PassphraseOKX: "Arbit_no2924",
            secretKeyOKX: "149C85E24E7B913D6ADBFDAFE87EB1B7",
        },
        {
            ProjectOKX: "874f428a20a2213341aac0b8459ff07f",
            ApiKeyOKX: "f6643472-5067-487a-a35c-82e83cd032e7",
            PassphraseOKX: "Arbit_no2924",
            secretKeyOKX: "30D76E03A311D8CAB73850444AFFF657",
        },
        {
            ProjectOKX: "9df4ee53d0c6659613951ca3f2b0c068",
            ApiKeyOKX: "30b17241-0007-4b95-9f86-c071a9351b66",
            PassphraseOKX: "Arbit_2024",
            secretKeyOKX: "23697133A4193CF858E866D10BEEA1F8",
        },
        {
            ProjectOKX: "30f6b2a4cc5211ce6d18afe9fb335318",
            ApiKeyOKX: "83d9e3df-4aab-42fd-aac7-07c30dc48cec",
            PassphraseOKX: "Arbit_2024",
            secretKeyOKX: "E1362DFC278BB826966224324B9E1EC5",
        },       
        {
            ProjectOKX: " 576ec3bb953a4245d190be804e590f34",
            ApiKeyOKX: "fcd9327d-fcf7-42d3-aae6-c9c46d18b91c",
            secretKeyOKX: "5528624D45062CC632BB4D40DD152798",
            PassphraseOKX: "999999-Dd"
        },
        {
            ProjectOKX: " 9a019d1a795cd6eb318921c4cd1d69db",
            ApiKeyOKX: "ae2ad3e8-cbce-4529-a997-d9fe70e5cc1a",
            secretKeyOKX: "2DE1392A54553D37E977CF73C74CEF10",
            PassphraseOKX: "999999-Dd"
        },
        {
            ProjectOKX: " 3991a6cb57c07b5f2a4551fb645dd8da",
            ApiKeyOKX: "9ef5d944-d5df-452b-a014-547d46c54591",
            secretKeyOKX: "FA7A6413591685741CC455315C137703",
            PassphraseOKX: "999999-Dd"
        },
        {
            ProjectOKX: " 809f52336548c0f1315a370464c716b4",
            ApiKeyOKX: "2ab14b8f-cd94-412a-9e40-01a933bb122c",
            secretKeyOKX: "3F3D0C85B1DA3412C16CBE6C2556B43F",
            PassphraseOKX: "999999-Dd"
        },
        {
            ProjectOKX: " 714ae731200f3ea90e0c65d3b4ff51be",
            ApiKeyOKX: "b945ef02-7db5-461b-a59d-d188660074f0",
            secretKeyOKX: "ACA6CAFFACADD28E84EACCC4830C553E",
            PassphraseOKX: "999999-Dd"
        },
        {
            ProjectOKX: " 732d13c49fc8a11daadf03ff31ed3aab",
            ApiKeyOKX: "abd88215-dbe8-4a8a-ab0e-1f10e5a3db37",
            secretKeyOKX: "CEA9B5107AC1CF503F80998D53E56CC5",
            PassphraseOKX: "999999-Dd"
        },
        
      ];
      
       // Fungsi untuk Signature
    function calculateSignature(exchange, apiSecret, dataToSign, hashMethod = "HmacSHA256") {
        if (!apiSecret || !dataToSign) {
            console.error(`[${exchange}] API Secret atau Data untuk Signature tidak valid!`);
            return null;
        }
    
        switch (exchange.toUpperCase()) {
            case "MEXC":
            case "BINANCE":
            case "KUCOIN":
            case "BYBIT":
                // Gunakan HMAC-SHA256
                return CryptoJS[hashMethod](dataToSign, apiSecret).toString(CryptoJS.enc.Hex);
    
            case "OKX":
                // Gunakan BASE64 untuk OKX
                const hmac = CryptoJS.HmacSHA256(dataToSign, apiSecret);
                return CryptoJS.enc.Base64.stringify(hmac);
    
            default:
                console.error(`[${exchange}] Exchange tidak didukung untuk perhitungan signature.`);
                return null;
        }
    } 
    
      // Fungsi untuk mendapatkan kredensial API secara acak
      function getRandomApiKeyOKX() {
        const randomIndex = Math.floor(Math.random() * apiKeysOKXDEX.length);
        return apiKeysOKXDEX[randomIndex];
      }

      function ResultEksekusi(DataDEX, DataCEX, Modal, amount_in, priceBuyToken_CEX, priceSellToken_CEX, priceBuyPair_CEX, priceSellPair_CEX, NameToken, NamePair, dextype) {
         var TokenPair = NameToken+"_"+NamePair;  
         var amount_out = Number(DataDEX.amount_out);
         var FeeSwap = parseFloat(DataDEX.FeeSwap);
         var FeeWD = parseFloat(DataCEX.feeWD);
         var FeeTrade = parseFloat(0.002 * Modal);
         
         // Hitung Harga Rata-rata
         var rateSellTokenDEX = (amount_out * priceSellPair_CEX) / amount_in; // Harga rata-rata jual NameToken di DEX
         var rateBuyPairDEX = (amount_in * priceBuyToken_CEX) / amount_out;
         var rateTokentoPair = amount_out / amount_in; // Menghitung rate MDT per BNT atau per jumlah yang dibeli
     
         // Hitung Nilai Akhir dan P&L
         var totalModal = Modal + FeeSwap + FeeWD + FeeTrade; // Modal awal (USDT)
         var totalFee = FeeSwap + FeeWD + FeeTrade; // Total biaya (USDT)
         var totalValue = amount_out * priceSellPair_CEX; // Nilai akhir (USDT)
         var profitLoss = totalValue - totalModal; // Profit or Loss (USDT)
         var profitLossPercent = totalModal !== 0 ? (profitLoss / totalModal) * 100 : 0; // Profit or Loss (%)
         var filterPNLValue = parseFloat(savedSettingData.filterPNL);
         // == 0 ? totalFee + (Modal * 0.2 / 100) : parseFloat(savedSettingData.FilterPNL);
         
         var conlusion="NO SELISIH";
         var selisih =false;
        // Jika filter PNL adalah 0, bandingkan nilai akhir dengan modal + semua biaya
        if (filterPNLValue == 0) {
            if (totalValue > totalModal + totalFee) {
                conlusion = "GET SIGNAL";
                selisih=true;
            }
        }
        // Jika filter PNL bukan 0, bandingkan selisih nilai akhir dan modal dengan filter PNL
        else {
            if ((totalValue - totalModal) > filterPNLValue) {
                conlusion = "GET SIGNAL";
                selisih=true;
            }
        }         // Output log
         console.log("-------------------------------------");
         console.log("---- " + NameToken + "/" + NamePair +" "+DataCEX.cex.toUpperCase()+" VS DEX : " + dextype.toUpperCase() + "  | Modal : " + Modal);
         console.log("--------------- HARGA & PROSES CEX ");
         console.log("Rate Beli Token " + NameToken + "/USDT di CEX:", priceBuyToken_CEX, "USDT");
         console.log("Rate Jual Token " + NameToken + "/USDT di CEX:", priceSellToken_CEX, "USDT");
         console.log("Jumlah HASIL Beli USDT => " + NameToken + " di CEX:", amount_in, NameToken);
         console.log("Rate Beli Pair " + NamePair + "/USDT di CEX:", priceBuyPair_CEX, "USDT");
         console.log("Rate Jual Pair " + NamePair + "/USDT di CEX:", priceSellPair_CEX, "USDT");
         console.log("--------------- HARGA & PROSES SWAP DEX");
         console.log("Jumlah HASIL SWAP " + NameToken + "=>" + NamePair + " di DEX:", amount_out, NamePair);     
         console.log("Rate Jual " + NameToken + "=>USDT di DEX:", rateSellTokenDEX.toFixed(4), "USDT");
         console.log("Rate " + NamePair + "=>" + NameToken + " di DEX:", rateTokentoPair.toFixed(10));
         console.log("Rate Beli USDT => " + NamePair + " di DEX:", rateBuyPairDEX.toFixed(4), "USDT");
         
         console.log("--------------- KESIMPULAN ");
         console.log("Modal Awal (USDT):", Modal, "USDT");
         console.log(`All Fee => Swap: ${FeeSwap.toFixed(2)} , WD: ${FeeWD.toFixed(2)} , Trade: ${FeeTrade.toFixed(2)} = ${totalFee.toFixed(2)}`);
         console.log("Modal Awal (USDT) + FEE:", totalModal.toFixed(2), "USDT");        
         console.log("Filter PNL:", filterPNLValue.toFixed(4), "USDT");
         console.log("Nilai Akhir (USDT):", totalValue.toFixed(4), "USDT");
         console.log("Profit/Loss (USDT):", profitLoss.toFixed(4), "USDT");
         console.log("Profit/Loss (%):", profitLossPercent.toFixed(2), "%");
         console.log("###################################");
         console.log(`${conlusion} => ${NameToken}/${NamePair} on ${DataCEX.cex.toUpperCase()}`);
         console.log("###################################");
         
         let IdCELL = `${DataCEX.cex.toUpperCase()}_${dextype.toUpperCase()}_${TokenPair}_${(DTChain.Nama_Chain).toUpperCase()}`;
         var linkDEX = generateDexLink(dextype.toLowerCase(), NameToken, DataCEX.sc_input, NamePair, DataCEX.sc_output);
    
        if (!linkDEX) {
            console.error(`DEX Type "${dexType}" tidak valid atau belum didukung.`);
            return;
        }
        
        if (NameToken == "USDT") {
            var RateSwap = `<label class="uk-text-success"> ${rateBuyPairDEX.toFixed(9)}$ ${NamePair} (${dextype.toUpperCase()})</label>`;
        }else if(NamePair == "USDT"){
            var RateSwap = `<label class="uk-text-danger"> ${rateTokentoPair.toFixed(9)}$ ${NameToken}->${NamePair} (${dextype.toUpperCase()}) </label>`; // Kosongkan jika salah satunya adalah USDT
        }else  {
            var RateSwap = ` <label class="uk-text-danger">  ${rateSellTokenDEX.toFixed(9)}$ ${NameToken} (${dextype.toUpperCase()})</label><br/>
                            <label class="uk-text-success">  ${rateBuyPairDEX.toFixed(9)}$ ${NamePair} (${dextype.toUpperCase()})</label>`;
        }  

        // Cek apakah elemen dengan ID ada di DOM
        if ($(`#SWAP_${IdCELL}`).length > 0) {
            $(`#SWAP_${IdCELL}`).html(`<a href="${linkDEX}" target="_blank">  ${RateSwap} `);
           
        }

       DisplayPNL( profitLoss,  DataCEX.cex,  NameToken, TokenPair, totalFee, Modal, dextype, priceBuyToken_CEX, rateSellTokenDEX, FeeSwap, FeeWD, DataDEX.sc_input, DataDEX.sc_output, NamePair,totalValue,totalModal,conlusion,selisih );
        
     }

     // Fungsi INFO SINYAL
    function DisplayPNL(PNL,cex,NameToken, TokenPair, totalFee, modal,dex,priceCEX,priceDEX,FeeSwap,FeeWD,sc_input, sc_output,pairdex,totalValue,totalModal,conlusion,selisih){
       
        var filterPNLValue = parseFloat(savedSettingData.filterPNL);
        var totalValue = parseFloat(totalValue);
        var totalModal = parseFloat(totalModal);
        var totalFee = parseFloat(totalFee);

        var IdCELL = `${cex.toUpperCase()}_${dex.toUpperCase()}_${TokenPair}_${(DTChain.Nama_Chain).toUpperCase()}`;
                        
        var sinyals = ` <a href="#SWAP_${cex.toUpperCase()}_${dex.toUpperCase()}_${TokenPair}_${(DTChain.Nama_Chain).toUpperCase()}" class='link-class' >${cex.toUpperCase()} VS ${dex.toUpperCase()} : ${TokenPair} (${(PNL).toFixed(2)})</a> | `;

        if (filterPNLValue == 0) {
            if (totalValue > totalModal + totalFee) {
                toastr.info("SELISIH",sinyals);
                $("#sinyalselisih").append(sinyals);

                $(`#${IdCELL}`).css('background-color', '#9be99b');
                $(`#RESULT_${IdCELL}`).html(`<span class=uk-text-secondary>FeeALL:${totalFee.toFixed(2)}$</span> <span class=uk-text-primary>SW:${FeeSwap.toFixed(2)}$</span> <span class=uk-text-secondary>PNL:${(PNL).toFixed(2)}$</span>`).addClass('ijo');
                var audio = new Audio('audio.mp3');  // Ganti dengan path file suara yang sesuai
                 audio.play(); 
               // InfoSinyal(dex.toLowerCase(), TokenPair, PNL, totalFee, cex.toUpperCase(),NameToken,pairdex);
            }else{
                $(`#RESULT_${IdCELL}`).html(`<span class=uk-text-secondary>FeeALL:${totalFee.toFixed(2)}$</span> <span class=uk-text-primary>SW:${FeeSwap.toFixed(2)}$</span> <span class=uk-text-danger>PNL:${(PNL).toFixed(2)}$</span>`);
            }
        }
        // Jika filter PNL bukan 0, bandingkan selisih nilai akhir dan modal dengan filter PNL
        else {
            if ((totalValue - totalModal) > filterPNLValue) {
                toastr.info("SELISIH",sinyals);
                $("#sinyalselisih").append(sinyals);
                
                $(`#${IdCELL}`).css('background-color', '#9be99b');
                $(`#RESULT_${IdCELL}`).html(`<span class=uk-text-secondary>FeeALL:${totalFee.toFixed(2)}$</span> <span class=uk-text-primary>SW:${FeeSwap.toFixed(2)}$</span> <span class=uk-text-secondary>PNL:${(PNL).toFixed(2)}$</span>`).addClass('ijo');
                var audio = new Audio('audio.mp3');  // Ganti dengan path file suara yang sesuai
                audio.play();
              //  InfoSinyal(dex.toLowerCase(), TokenPair, PNL, totalFee, cex.toUpperCase(),NameToken,pairdex);
            }else{
                $(`#RESULT_${IdCELL}`).html(`<span class=uk-text-secondary>FeeALL:${totalFee.toFixed(2)}$</span> <span class=uk-text-primary>SW:${FeeSwap.toFixed(2)}$</span> <span class=uk-text-danger>PNL:${(PNL).toFixed(2)}$</span>`);
            }
        }  
/*
       if (filterPNLValue == 0) {
            if (totalValue > totalModal + totalFee) {
                $(`#RESULT_${dexResult}`).html(`<span class=uk-text-secondary>FeeALL:${totalFee.toFixed(2)}$</span> <span class=uk-text-primary>SW:${FeeSwap.toFixed(2)}$</span> <span class=uk-text-secondary>PNL:${(PNL).toFixed(2)}$</span>`).removeClass().addClass('ijo');
                // InfoSinyal(dex.toUpperCase(), TokenPair, PNL, totalFee, cex.toUpperCase(),NameToken,pairdex);
            }else{
                $(`#RESULT_${dexResult}`).html(`<span class=uk-text-secondary>FeeALL:${totalFee.toFixed(2)}$</span> <span class=uk-text-primary>SW:${FeeSwap.toFixed(2)}$</span> <span class=uk-text-danger>PNL:${(PNL).toFixed(2)}$</span>`);
            }
        }
        // Jika filter PNL bukan 0, bandingkan selisih nilai akhir dan modal dengan filter PNL
        else {
            if ((totalValue - totalModal) > filterPNLValue) {
                toastr.error("SELISIH",TokenPair);
                $(`#RESULT_${dexResult}`).html(`<span class=uk-text-secondary>FeeALL:${totalFee.toFixed(2)}$</span> <span class=uk-text-primary>SW:${FeeSwap.toFixed(2)}$</span> <span class=uk-text-secondary>PNL:${(PNL).toFixed(2)}$</span>`).removeClass().addClass('ijo');
                // InfoSinyal(dex.toUpperCase(), TokenPair, PNL, totalFee, cex.toUpperCase(),NameToken,pairdex);
            }else{
                $(`#RESULT_${dexResult}`).html(`<span class=uk-text-secondary>FeeALL:${totalFee.toFixed(2)}$</span> <span class=uk-text-primary>SW:${FeeSwap.toFixed(2)}$</span> <span class=uk-text-danger>PNL:${(PNL).toFixed(2)}$</span>`);
            }
        }   
*/
        // if(PNL>1){
        //     MultisendMessage( cex, dex.toUpperCase(), TokenPair, modal, PNL, priceCEX, priceDEX, FeeSwap,FeeWD, totalFee);
        // }
    }

    // Fungsi untuk menampilkan sinyal hasil scan dan memutar suara
    function InfoSinyal(DEXPLUS, TokenPair, PNL, totalFee, cex, NameToken, NamePair) {
        // Menentukan warna teks berdasarkan `cex` menggunakan fungsi getWarnaCEX
        var warnaCEX = getWarnaCEX(cex);
        let idCELL=`${cex.toUpperCase()}_${dex.toUpperCase()}_${NameToken}_${NamePair}_${(DTChain.Nama_Chain).toUpperCase()}`;
        // Membuat link dengan format umum tanpa pengecekan kondisi
        var sLink = `<a href=#SWAP_${idCELL} class='link-class' >
            ${NameToken}->${NamePair} 
            (<span style='color:${warnaCEX}; font-weight:bolder;'>${cex.toUpperCase()}:</span>${(PNL).toFixed(2)}$)
        </a>`;
        console.log($("#sinyal" + DEXPLUS.toLowerCase()).length);
        console.log("ID Target: #sinyal" + DEXPLUS.toLowerCase());

        // Menambahkan link ke elemen dengan ID yang sesuai
        $("#sinyal" + DEXPLUS.toLowerCase()).append(` ${sLink} |`);
    
        // Menambahkan elemen dan kelas tanpa memeriksa kondisi
       // BINANCE_MAGPIE_XVS_UNI_BSC
        $(`#BUY_${idCELL}`).addClass('ijo');
        $(`#SWAP_${idCELL}`).addClass('ijo');
        $(`#SELL_${idCELL}`).addClass('ijo');
        $(`#RESULT_${idCELL}`).addClass('ijo');
        // Bagian baru: Menambahkan dan memutar audio setiap kali fungsi dipanggil
        var audio = new Audio('audio.mp3');  // Ganti dengan path file suara yang sesuai
        audio.play();
    }
    // Fungsi untuk mengecek harga pada DEX  
    function generateDexLink(dex, NameToken, sc_input, NamePair, sc_output) {
        const link = {
            'kyberswap': `https://kyberswap.com/swap/${DTChain.Nama_Chain}/${sc_input}-to-${sc_output}`,
            'paraswap': `https://app.paraswap.xyz/#/swap/${sc_input}-${sc_output}?version=6.2&network=${DTChain.Nama_Chain}`,
            'odos': "https://app.odos.xyz",
            '0x': `https://matcha.xyz/tokens/${DTChain.Nama_Chain}/${sc_input}?buyChain=${DTChain.Kode_Chain}&buyAddress=${sc_output}`,
            '1inch': `https://app.1inch.io/#/${DTChain.Kode_Chain}/advanced/swap/${sc_input}/${sc_output}`,
            'okx': `https://www.okx.com/web3/dex-swap?inputChain=${DTChain.Kode_Chain}&inputCurrency=${sc_input}&outputChain=501&outputCurrency=${sc_output}`,
            'magpie': `https://app.magpiefi.xyz/swap/${DTChain.Nama_Chain.toLowerCase()}/${NameToken.toUpperCase()}/${DTChain.Nama_Chain.toLowerCase()}/${NamePair.toUpperCase()}`,
            'jupiter': `https://jup.ag/swap/${sc_input}-${sc_output}`
        };

        return link[dex] || null;
    }

    function getPriceDEX(sc_input, des_input, sc_output, des_output, amount_in, PriceRate,  dexType, NameToken, NamePair, cex, callback) {
        var sc_input=sc_input.toLowerCase();
        var sc_output=sc_output.toLowerCase();
        var dexId = `${cex}_${dexType.toUpperCase()}_${NameToken}_${NamePair}_${(DTChain.Nama_Chain).toUpperCase()}`;
        var SavedSettingData = getFromLocalStorage('DATA_SETTING', {});
        var selectedApiKey = getRandomApiKeyOKX();
        var amount_in = BigInt(Math.round(Math.pow(10, des_input) * amount_in));
        var apiUrl, requestData,headers;   
        let normalizedNamePair = NamePair === "ETH" ? "WETH" :
                                NamePair === "BNB" ? "WBNB" :
                                NamePair === "POL" ? "WPOL" :
                                NamePair === "SOL" ? "WSOL" :
                                NamePair === "AVAX" ? "WAVAX" :
                                NamePair;
        var linkDEX = generateDexLink(dexType, NameToken, sc_input, NamePair, sc_output);

        switch (dexType) {
            case 'kyberswap':
                let NetChain;
                if (DTChain.Nama_Chain.toUpperCase() === "AVAX") {
                    NetChain = "avalanche";
                }else{
                    NetChain=DTChain.Nama_Chain;
                }
                //https://aggregator-api.kyberswap.com/bsc/api/v1/routes?tokenIn=0xa697e272a73744b343528c3bc4702f2565b2f422&tokenOut=0xba2ae424d960c26247dd6c32edc70b295c744c43&amountIn=1000000000000&gasInclude=true
                apiUrl = "https://aggregator-api.kyberswap.com/" + NetChain.toLowerCase() + "/api/v1/routes?tokenIn=" + sc_input + "&tokenOut=" + sc_output + "&amountIn=" + amount_in+ "&gasInclude=true";
               
               // apiUrl = "https://aggregator-api.kyberswap.com/" + NetChain + "/route/encode?tokenIn=" + sc_input.toLowerCase() + "&tokenOut=" + sc_output.toLowerCase() + "&amountIn=" + amount_in + "&gasInclude=true";
                break;
            case 'paraswap':
                apiUrl = "https://api.paraswap.io/prices?" + "srcToken=" + sc_input + "&srcDecimals=" + des_input + "&destToken=" + sc_output + "&destDecimals=" + des_output + "&side=SELL&network=" + DTChain.Kode_Chain + "&amount=" + amount_in + "&version=6.2";
                break;
            case 'odos':
                apiUrl = "https://api.odos.xyz/sor/quote/v2";
                requestData = {
                    chainId: DTChain.Kode_Chain,
                    inputTokens: [{ amount: amount_in.toString(), tokenAddress: sc_input }],
                    outputTokens: [{ proportion: 1, tokenAddress: sc_output }],
                    referralCode: 0,
                    slippageLimitPercent: 0.3,
                };
                break;
            case '0x':
                    if (DTChain.Nama_Chain.toLowerCase() === 'ethereum') {
                        apiUrl = "https://api.0x.org/swap/v1/quote?buyToken=" + sc_output + "&sellToken=" + sc_input + "&sellAmount=" + amount_in;
                    }else  if (DTChain.Nama_Chain.toLowerCase() === 'avax') {
                        apiUrl = "https://avalanche.api.0x.org/swap/v1/quote?buyToken=" + sc_output + "&sellToken=" + sc_input + "&sellAmount=" + amount_in;
                    } else {
                        apiUrl = "https://" + DTChain.Nama_Chain + ".api.0x.org/swap/v1/quote?buyToken=" + sc_output + "&sellToken=" + sc_input + "&sellAmount=" + amount_in;
                    }
                    break;
            case '1inch':
                    apiUrl = "https://api-defillama.1inch.io/v6.0/" + DTChain.Kode_Chain + "/quote?src=" + sc_input + "&dst=" + sc_output + "&amount=" + amount_in + "&includeGas=true";
                break;
            case 'magpie':
                    apiUrl = "https://api.magpiefi.xyz/aggregator/quote?network=" + DTChain.Nama_Chain + "&fromTokenAddress=" + sc_input + "&toTokenAddress=" + sc_output + "&sellAmount=" + amount_in + "&gasless=true&slippage=0.1";
                break;
            case 'okx':
                var queryString = `/api/v5/dex/aggregator/quote?amount=${amount_in}&chainId=${DTChain.Kode_Chain}` + `&fromTokenAddress=${sc_input}&toTokenAddress=${sc_output}`;
                var timestamp = new Date().toISOString();
                var method = "GET";
                var dataToSign = timestamp + method + queryString;
                apiUrl = `https://www.okx.com${queryString}`;

                var signature = calculateSignature("OKX",  selectedApiKey.secretKeyOKX, dataToSign, "BASE64");
                break;
            case 'jupiter':
                apiUrl = "https://quote-api.jup.ag/v6/quote?inputMint=" + sc_input + "&outputMint=" + sc_output + "&amount=" + amount_in;
                headers = {}; // Tidak memerlukan header khusus
                console.log("https://quote-api.jup.ag/v6/quote?inputMint=" + sc_input + "&outputMint=" + sc_output + "&amount=" + amount_in);
                break;                 
            default:
                console.error("Unsupported DEX type");
                return;
        }
    
        $.ajax({
            url: apiUrl,
            method: ['odos', 'swoop'].includes(dexType) ? 'POST' : 'GET', // Cek tipe DEX
            headers: Object.assign(
                {}, 
                headers || {}, // Header tambahan dari variabel `headers`
                dexType === '0x' ? { '0x-api-key': "6f5d5c4d-bfdd-4fc7-8d3f-d3137094feb5" } : {},
                dexType === 'okx' ? {
                    "OK-ACCESS-PROJECT": selectedApiKey.ProjectOKX,
                    "OK-ACCESS-KEY": selectedApiKey.ApiKeyOKX,
                    "OK-ACCESS-SIGN": signature,
                    "OK-ACCESS-PASSPHRASE": selectedApiKey.PassphraseOKX,
                    "OK-ACCESS-TIMESTAMP": timestamp,
                } : {}
            ),
            beforeSend: function () {
                var loadingSpinner = `<i class="bi bi-arrow-clockwise"></i>&nbsp; ${dexType.toUpperCase()}`;
                $(`#SWAP_${dexId}`).html(loadingSpinner);
            },
            data: ['odos', 'swoop'].includes(dexType) ? JSON.stringify(requestData) : requestData, // Format data berdasarkan tipe DEX
            contentType: ['odos', 'swoop'].includes(dexType) ? 'application/json' : undefined, // Set `contentType` hanya jika diperlukan
            timeout: parseInt(SavedSettingData.waktuTunggu) * 1000, // Ambil waktu tunggu dari localStorage atau default ke 0
            success: function (response, xhr) {
                //console.log("RESPONSE DEX: ",response)
                var amount_out = null, FeeSwap = null; // Default kosong
                try {
                        switch (dexType) {
                            case 'kyberswap':
//                                amount_out = response.outputAmount / Math.pow(10, des_output);
//                                FeeSwap = ((response.totalGas / Math.pow(10, 9)) * parseFloat(getFromLocalStorage('gasGWEI', 0))) * parseFloat(getFromLocalStorage('PRICEGAS', 0)); // Menggunakan getFromLocalStorage
                                amount_out = response.data.routeSummary.amountOut / Math.pow(10, des_output);
                                FeeSwap = ((response.data.routeSummary.gas / Math.pow(10, 9)) * parseFloat(getFromLocalStorage('gasGWEI', 0))) * parseFloat(getFromLocalStorage('PRICEGAS', 0)); // Menggunakan getFromLocalStorage

                                break;
                            case 'paraswap':
                                amount_out = response.priceRoute.destAmount / Math.pow(10, des_output);
                                FeeSwap = parseFloat(response.priceRoute.gasCostUSD);
                                break;
                            case 'odos':
                                amount_out = response.outValues / PriceRate; 
                                FeeSwap = response.gasEstimateValue;
                                break;
                            case '0x':
                                amount_out = response.buyAmount / Math.pow(10, des_output);
                                FeeSwap = ((response.estimatedGas / Math.pow(10, 9)) * parseFloat(getFromLocalStorage('gasGWEI', 0))) * parseFloat(getFromLocalStorage('PRICEGAS', 0)); // Menggunakan getFromLocalStorage
                                break;
                            case '1inch':
                                amount_out = parseFloat(response.dstAmount) / Math.pow(10, des_output);
                                FeeSwap = ((response.gas / Math.pow(10, 9) * parseFloat(getFromLocalStorage('gasGWEI', 0)))) * parseFloat(getFromLocalStorage('PRICEGAS', 0)); // Menggunakan getFromLocalStorage
                                break;
                            case 'magpie':
                                amount_out = parseFloat(response.amountOut) / Math.pow(10, des_output);
                                FeeSwap = parseFloat(response.fees[0].value)+0.5;
                                break;    
                            case 'okx':
                                amount_out = response.data[0].toTokenAmount / Math.pow(10, des_output);
                                FeeSwap = (response.data[0].estimateGasFee / Math.pow(10, 9)) * parseFloat(getFromLocalStorage('gasGWEI', 0)) * parseFloat(getFromLocalStorage('PRICEGAS', 0));            
                                break;                         
                            case 'jupiter':
                                var amount_out = response.outAmount/Math.pow(10, des_output);
                                FeeSwap = 0.1;                                
                            break;                                   
                            default:
                                throw new Error(`DEX type ${dexType} not supported.`);
                        }
                
                        const result = {
                            sc_input: sc_input,
                            des_input: des_input,
                            sc_output: sc_output,
                            des_output: des_output,
                            FeeSwap: FeeSwap,
                            amount_out: amount_out,
                            apiUrl: apiUrl,
                        };
                        callback(null, result);
                    } catch (error) {
                        $(`#SWAP_${dexId}`).html(`<a href="${linkDEX}" title="${dexType.toUpperCase()} : ${error.message}" target="_blank" class="uk-text-danger"><i class="bi bi-x-circle"></i> ${dexType.toUpperCase()} </a>`);
                        callback({
                            statusCode: 500,
                            pesanDEX: `Error DEX : ${error.message}`,
                            color: "error",
                            DEX: dexType.toUpperCase(),
                        }, null);
                    }
            },
            
            error: function (xhr) {
                var alertMessage = "Terjadi kesalahan";
                var warna = "error";
                switch (xhr.status) {
                    case 0:
                        warna = "error";
                        alertMessage = "NO RESPONSE";
                        break;
                    case 400:
                        try {
                            var errorResponse = JSON.parse(xhr.responseText);
                            if (errorResponse.description && errorResponse.description.toLowerCase().includes("insufficient liquidity")) {
                                alertMessage = "NO LP (No Liquidity Provider)";
                                warna = "warning";
                            } else {
                                alertMessage = errorResponse.detail || errorResponse.description || "KONEKSI BURUK";
                            }
                        } catch (e) {
                            alertMessage = "KONEKSI LAMBAT"; // Jika parsing gagal
                        }
                        break;  
                    case 401:
                        alertMessage = "API SALAH";
                        break;
                    case 403:
                        alertMessage = "AKSES DIBLOK";
                        break;
                    case 404:
                        alertMessage = "Permintaan tidak ditemukan";
                        break ;
                    case 429:
                        alertMessage = "AKSES KENA LIMIT";
                        break;
                    case 500:
                        alertMessage = "GAGAL DAPATKAN DATA";
                        break;
                    case 503:
                        alertMessage = "Layanan tidak tersedia";
                        break;
                    case 502:
                        alertMessage = "Respons tidak valid";
                        break;
                    default:
                        alertMessage = "Status: " + xhr.status;
                }
                $(`#SWAP_${dexId}`).html(`<a href="${linkDEX}" title="${dexType.toUpperCase()} : ${alertMessage}" target="_blank" class="uk-text-danger"><i class="bi bi-x-circle"></i> ${dexType.toUpperCase()} </a>`);

                callback({ statusCode: xhr.status, pesanDEX: alertMessage, color: warna, DEX: dexType.toUpperCase() }, null);
            }, 
        });
    }
    
    // Fungsi untuk mengecek harga pada SWOOP
    function getPriceSWOOP(sc_input, des_input, sc_output, des_output, amount_in, PriceRate, action, NameToken, dexType, pairdex, cex, callback) {
        // Mengambil data setting dari localStorage
        var SavedSettingData = getFromLocalStorage('DATA_SETTING', {});
        //var amount_in = BigInt(Math.round(Math.pow(10, des_input) * amount_in));
        var amount_in = Math.pow(10, des_input) * amount_in;
        var amount_in = BigInt(Math.round(Number(amount_in)));
        var IdCellTableDEX = GetIdCellDEX(NameToken,cex.toUpperCase(),dexType,pairdex);

        var dexURL = {
            'kyberswap': "https://kyberswap.com/swap/" + DTChain.Nama_Chain + "/" + sc_input + "-to-" + sc_output,
            'paraswap': "https://app.paraswap.xyz/#/swap/" + sc_input + "-" + sc_output + "?version=6.2&network=" + DTChain.Nama_Chain,
            'odos': "https://app.odos.xyz",
            '0x': "https://matcha.xyz/tokens/" + DTChain.Nama_Chain + "/" + sc_input.toLowerCase() + "?buyChain=" + DTChain.Kode_Chain + "&buyAddress=" + sc_output.toLowerCase(),
            '1inch': "https://app.1inch.io/#/" + DTChain.Kode_Chain + "/advanced/swap/" + sc_input + "/" + sc_output,    
            'okx': "https://www.okx.com/web3/dex-swap?inputChain="+DTChain.Kode_Chain+"&inputCurrency=" + sc_input + "&outputChain=501&outputCurrency=" + sc_output,  
            'magpie':`https://app.magpiefi.xyz/swap/${DTChain.Nama_Chain.toLowerCase()}/${NameToken.toUpperCase()}/${DTChain.Nama_Chain.toLowerCase()}/${pairdex.toUpperCase()}`
        }[dex] || "https://app.swoop.exchange";
    
    
        var payload = {
            "chainId": DTChain.Kode_Chain,
            "aggregatorSlug": dexType,
            "sender": SavedSettingData.walletMETA,
            "inToken": {
                "chainId": DTChain.Kode_Chain,
                "type": "TOKEN",
                "address": sc_input,
                "decimals": parseFloat(des_input)
            },
            "outToken": {
                "chainId": DTChain.Kode_Chain,
                "type": "TOKEN",
                "address": sc_output,
                "decimals": parseFloat(des_output)
            },
            "amountInWei": String(amount_in),
            "slippageBps": "100",
            // Mengambil gasGWEI dari localStorage
            "gasPriceGwei": Number(getFromLocalStorage('gasGWEI', 0)),
        };
    
        $.ajax({
            url: 'https://swoop-backend.up.railway.app/swap',
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify(payload),
            timeout: parseInt(SavedSettingData.waktuTunggu ) * 1000,
            success: function (response) {
                    var amount_out = parseFloat(response.amountOutWei) / Math.pow(10, des_output);
                    var FeeSwap = ((parseFloat(getFromLocalStorage('gasGWEI')) * 250000) / Math.pow(10, 9))*parseFloat(getFromLocalStorage('PRICEGAS'));
                    
                    const result = {
                        sc_input:sc_input,
                        des_input:des_input,
                        sc_output:sc_output,
                        des_output:des_output,
                        FeeSwap: FeeSwap,
                        amount_out: amount_out,
                    };
                   // console.log("RESULT SWOOP",result);
                    callback(null, result);    
            },
            error: function (xhr) {
                var alertMessage = "Terjadi kesalahan";
                var warna = "error";
            
                switch (xhr.status) {
                    case 0:
                        warna = "error";
                        alertMessage = "NO RESPONSE";
                        break;
                    case 400:
                        try {
                            var errorResponse = JSON.parse(xhr.responseText);
                            alertMessage = errorResponse.detail || errorResponse.description || "KONEKSI BURUK";
                        } catch (e) {
                            alertMessage = "KONEKSI LAMBAT"; // Jika parsing gagal
                        }
                        break;
                    case 403:
                        alertMessage = "AKSES DIBLOK";
                        break;
                    case 404:
                        alertMessage = "Permintaan tidak ditemukan";
                        break;
                    case 429:
                        alertMessage = "AKSES KENA LIMIT";
                        break;
                    case 500:
                        try {
                            // Ambil `message` jika tersedia di dalam response JSON
                            var errorResponse = JSON.parse(xhr.responseText);
                            alertMessage = errorResponse.message || "GAGAL DAPATKAN DATA";
                        } catch (e) {
                            alertMessage = "GAGAL DAPATKAN DATA"; // Jika parsing gagal
                        }
                        break;
                    case 503:
                        alertMessage = "Layanan tidak tersedia";
                        break;
                    case 502:
                        alertMessage = "Respons tidak valid";
                        break;
                    default:
                        alertMessage = "Status: " + xhr.status;
                }
                IdCellTableDEX.html(`<a href="${dexURL}" title="${dexType.toUpperCase()} : ${alertMessage}" target="_blank" class="swoop"><i class="bi bi-exclamation-circle"></i> SWOOP </a>`);

                // Kirim callback untuk penanganan lebih lanjut
                callback({ 
                    statusCode: xhr.status, 
                    pesanswoop: alertMessage, 
                    color: warna, 
                    DEX: dexType.toUpperCase() 
                }, null);
            }
            
        });
    }

    // Fungsi untuk mengecek harga pada RANGO
    function getPriceRANGO(sc_input, des_input, sc_output, des_output, amount_in, PriceRate, action, NameToken, dex, pairdex, cex, callback) {
        //var amount_in = BigInt(Math.round(Math.pow(10, des_input) * amount_in));
        var IdCellTableDEX = GetIdCellDEX(NameToken,cex.toUpperCase(),dex,pairdex);
        let transformedChain = 
            DTChain.Nama_Chain.toUpperCase() === "ETHEREUM" ? "ETH" : 
            DTChain.Nama_Chain.toUpperCase() === "AVAX" ? "AVAX_CCHAIN" : 
            DTChain.Nama_Chain.toUpperCase();
            
        let normalizedPairdex = pairdex === "ETH" ? "WETH" :
                                pairdex === "BNB" ? "WBNB" :
                                pairdex === "POL" ? "WPOL" :
                                pairdex === "SOL" ? "WSOL" :
                                pairdex === "AVAX" ? "WAVAX" :
                                pairdex;

       let fromsymbol, tosymbol;
       if (action === "sell") {
           fromsymbol = NameToken;
           tosymbol = normalizedPairdex;
       } else if (action === "buy") {
           fromsymbol = normalizedPairdex;
           tosymbol = NameToken;
       }
        const dexLinks = {
            'kyberswap': `https://kyberswap.com/swap/${DTChain.Nama_Chain}/${sc_input}-to-${sc_output}`,
            'paraswap': `https://app.paraswap.xyz/#/swap/${sc_input}-${sc_output}?version=6.2&network=${DTChain.Nama_Chain}`,
            'odos': "https://app.odos.xyz",
            "0x": `https://matcha.xyz/tokens/${DTChain.Nama_Chain}/${sc_input.toLowerCase()}?buyChain=${DTChain.Kode_Chain}&buyAddress=${sc_output.toLowerCase()}`,
            "1inch": `https://app.1inch.io/#/${DTChain.Kode_Chain}/advanced/swap/${sc_input}/${sc_output}`,
            'okx': "https://www.okx.com/web3/dex-swap?inputChain="+DTChain.Kode_Chain+"&inputCurrency=" + sc_input + "&outputChain=501&outputCurrency=" + sc_output,        
            'rango': "https://app.rango.exchange/bridge?fromBlockchain=" + transformedChain + "&toBlockchain=" + transformedChain +"&fromToken="+ fromsymbol +"--" + sc_input + "&toToken=" + tosymbol+"--" + sc_output,
             'magpie':`https://app.magpiefi.xyz/swap/${DTChain.Nama_Chain.toLowerCase()}/${NameToken.toLowerCase()}/${DTChain.Nama_Chain.toLowerCase()}/${pairdex.toLowerCase()}`,
            'jupiter': `https://jup.ag/swap/${sc_input}-${sc_output}`,
        };

        const NetworkChain = (DTChain.Nama_Chain || "").toUpperCase() === "ETHEREUM"
            ? "ETH"
            : (DTChain.Nama_Chain || "").toUpperCase() === "AVAX"
                ? "AVAX_CCHAIN"
                : DTChain.Nama_Chain.toUpperCase();

        const swappersMap = {
            kyberswap: ["KyberSwapV3"],
            paraswap: ["ParaSwap"],
            odos: ["Odos"],
            okx: ["Okc Swap"],
            "1inch": ["1Inch"],
        };
        const swapperGroups = swappersMap[dex] || [];
        const apiKeysRango = [
            "a24ca428-a18e-4e84-b57f-edb3e2a5bf13", // rubic
            "c6381a79-2817-4602-83bf-6a641a409e32", // umum
        ];

        // Fungsi untuk mendapatkan API Key secara acak
        function getRandomApiKeyRango() {
            const randomIndex = Math.floor(Math.random() * apiKeysRango.length);
            return apiKeysRango[randomIndex];
        }

        // Variabel untuk API Key
        const apiRango = getRandomApiKeyRango();
        const apiUrl = `https://api.rango.exchange/routing/bests?apiKey=${apiRango}`;

        const requestData = {
            from: {
                blockchain: NetworkChain,
                symbol: pairdex.toUpperCase(),
                address: sc_input,
            },
            to: {
                blockchain: NetworkChain,
                symbol: NameToken.toUpperCase(),
                address: sc_output,
            },
            amount: amount_in.toString(),
            swappersExclude: false,
            swapperGroups: swapperGroups,
        };

        $.ajax({
            url: apiUrl,
            type: 'POST',
            contentType: 'application/json',
            timeout: parseInt(getFromLocalStorage('DATA_SETTING', {}).waktuTunggu || 30) * 1000,
            data: JSON.stringify(requestData),
            success: function (response, xhr) {
                if (response.results && Array.isArray(response.results) && response.results.length > 0) {
                const firstResult = response.results[0];
                const amount_out = parseFloat(firstResult.outputAmount); // Jumlah output
                let FeeSwap = 0;
            
                // Proses fee jika data swap tersedia
                if (firstResult.swaps && firstResult.swaps.length > 0) {
                    const swap = firstResult.swaps[0]; // Ambil swap pertama
                    swapperId = swap.swapperId;        // Ambil swapperId
                    toAmount = parseFloat(swap.toAmount); // Ambil toAmount
            
                    const feeArray = swap.fee; // Array fee
                    // Cari Network Fee
                    const networkFee = feeArray.find(fee => fee.name === "Network Fee");
                    if (networkFee) {
                        FeeSwap = parseFloat(networkFee.amount) * parseFloat(networkFee.price); // Hitung Fee Swap
                    }
                }              

                const result = {
                    sc_input:sc_input,
                    des_input:des_input,
                    sc_output:sc_output,
                    des_output:des_output,
                    FeeSwap: FeeSwap,
                    amount_out: amount_out,
                };
                //console.log("RESULT RANGO",result);
                // Kembalikan hasil sebagai nilai
                callback(null, result);
            }else{
                IdCellTableDEX.html(`<a href="${dexLinks}" title="${dex.toUpperCase()} : NO LISTING TOKEN!!" target="_blank" class="rango"><i class="bi bi-exclamation-circle"></i> RANGO </a>`);
            }

            },                
            
            error: function (xhr) {
                let alertMessage = "Kesalahan tidak diketahui";
                let warna = "error";
            
                // Jika ada responseJSON dan memiliki key description, gunakan pesan ini
                if (xhr.responseJSON && xhr.responseJSON.description) {
                    alertMessage = xhr.responseJSON.description;
                } else {
                    // Fallback ke switch berdasarkan status HTTP jika tidak ada description
                    switch (xhr.status) {
                        case 0: 
                            alertMessage = "SERING SCAN"; 
                            break;
                        case 400: 
                            alertMessage = "KONEKSI BURUK"; 
                            break;
                        case 403: 
                            alertMessage = "AKSES DIBLOK"; 
                            break;
                        case 404: 
                            alertMessage = "Permintaan tidak ditemukan"; 
                            break;
                        case 429:
                            alertMessage = "KENA LIMIT";
                            break;
                        case 500: 
                            alertMessage = xhr.responseJSONmessage || "GAGAL DAPATKAN DATA"; 
                            break;
                        case 503: 
                            alertMessage = "Layanan tidak tersedia"; 
                            break;
                        default: 
                            alertMessage = `Status: ${xhr.status}`;
                    }
                }

                IdCellTableDEX.html(`<a href="${dexLinks}" title="${dex.toUpperCase()} : ${alertMessage}" target="_blank" class="rango"><i class="bi bi-exclamation-circle"></i> ${dex.toUpperCase()} </a>`);
    
                // Kirim callback untuk menangani error lebih lanjut
                callback({ 
                    statusCode: xhr.status, 
                    pesanrango: alertMessage, 
                    color: warna, 
                    DEX: dex.toUpperCase() 
                }, null);
            }
            
        });        
    }

</script>
<script src="https://cdn.jsdelivr.net/npm/uikit@3.6.22/dist/js/uikit.min.js"></script>
</body>
</html>
