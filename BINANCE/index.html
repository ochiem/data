<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BINANCE MULTICHAIN</title>
  <!-- Bulma CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css" rel="stylesheet">
  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/css/toastr.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/js/toastr.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"
  integrity="sha512-E8QSvWZ0eCLGk4km3hxSsNmGWbLtSCSUcewDQPQWZF6pEU8GlT8a5fF32wOl1i8ftdMhssTrF/OhyGWwonTcXA=="
  crossorigin="anonymous"  referrerpolicy="no-referrer" ></script>
  <link rel="icon" href="https://upload.wikimedia.org/wikipedia/commons/5/57/Binance_Logo.png" type="image/x-icon">
  <style>
     span.tokenpair a{
        white-space: nowrap;
        color: #555 !important;
        font-weight: bolder;
    }
    .table-container {
      max-height: 70vh;
      overflow-y: auto;
      overflow-x: auto;
    }
    .container-custom {
      width: 98%;
      margin: 12px auto;
    }
    .price {
      font-size: 13px;
      color: #555;
      text-align: left !important;
    }
    .price_token{
      font-size: 13px;
      color: #555;
      text-align: center !important;   
     }
    .dtcoin{
      font-size: 13px;
      text-align: center !important;
      vertical-align: middle !important;
    }
    .sinyal-item{
        border-bottom: 1px solid #e39c80;
    }
    .notification {
      transition: all 0.3s ease-in-out;
    }
    .table-container {
        overflow-y: auto; /* Membuat tabel bisa di-scroll secara vertikal */
        max-height: 700px; /* Tentukan tinggi maksimum tabel */
        border: 1px solid #ddd; /* Opsional: Tambahkan border di sekitar tabel */
    }
    .table thead tr th , tbody#TabelHarga{
        white-space: nowrap;
        text-align: center !important; /* Menjaga teks tetap di tengah secara horizontal */
    }
    .table thead {
        font-size: 13px;
        position: sticky;
        top: 0;
        background-color: #bdccf1;
        z-index: 10;
    }
    
    img.icon:hover {
        transform: scale(1.6); /* You can adjust the scale factor as needed */
    }

    .nonaktif {
        opacity:0.5;
        pointer-events: none; /* Menonaktifkan interaksi dengan gambar */
    }
  </style>
</head>
<body>
  <div class="container-custom">
    <div class="columns">        
        <div class="column is-two-fifths"> 
            <div class="field is-grouped is-grouped-left ">
                <span class="has-text-weight-bold"> BINANCE TRIANGULAR </span> &nbsp; &nbsp;
                <div class="field is-grouped">
                    <div class="tags has-addons">
                        <span class="tag is-light">All Tokens | Active | By Chains</span>
                        <span class="tag is-danger" id="totalAllTokens">000</span>
                        <span class="tag is-link" id="totalTokensAllChains">000</span>
                        <span class="tag is-success" id="totalTokenbyChains">000</span>
                    </div>
                </div>
            </div>
            
            <div class="field is-grouped is-grouped-left ">
                <img class="icon" id="SyncDataBtn" title="SINKRONISASI DATA" width="25px" src="https://png.pngtree.com/png-clipart/20230815/original/pngtree-database-sync-icon-icon-symbol-data-vector-picture-image_10830033.png" />&nbsp;&nbsp;
                <img class="icon" id="SettingModal" title="SETTING APLIKASI" width="25px" src="https://cdn-icons-png.flaticon.com/512/771/771203.png" /> &nbsp;&nbsp;
                <img class="icon" id="UpdateWalletCEX" title="UPDATE WALLET CEX" width="25px" src="https://images.freeimages.com/fic/images/icons/2770/ios_7_icons/512/wallet.png" /> &nbsp;&nbsp;
                <img class="icon" id="reload" title="REFRESH PAGE" width="25px" src="https://cdn-icons-png.flaticon.com/512/2546/2546705.png" /> &nbsp;&nbsp;
                <a href="https://multichecker.vercel.app/BINANCE/manajemen_token.html" target="_blank" > <img class="icon" id="MasterData" title="MANAJEMEN TOKEN" width="25px" src="https://icons.veryicon.com/png/o/miscellaneous/alibaba-enterprise-intelligence-general-basic/symbol-data-source-configuration.png" /> &nbsp;&nbsp;  </a>
                <a href="https://multichecker.vercel.app/BINANCE/manajemen_aset.html" target="_blank" > <img class="icon"  id="Modal" title="MANAJEMEN ASSET" width="25px" src="https://cdn-icons-png.flaticon.com/512/6573/6573160.png" /> </a>
                &nbsp;&nbsp;
                <div class="tags has-addons">
                    <span class="tag is-success" id="LastUpdate">-</span>
                </div>
            </div>
            <div class="field is-grouped is-grouped-left ">
                <h3 class="has-text-weight-bold has-text-danger" id="infoAPP"></h3>
            </div>
        </div>

        <div class="column" id="actionAPP">
            <div class="field is-grouped is-grouped-left ">
                <span class="has-text-success has-text-weight-bold ">CHAINS  : </span>
                <div id="Chains">
                    <!-- Checkbox Chains akan dirender di sini -->
                </div>
            </div>
            <div class="field is-grouped is-grouped-left">
                <span class="has-text-danger has-text-weight-bold ">DEXS : </span>
                <div id="DEXs">
                    <!-- Checkbox DEX akan dirender di sini -->
                </div>
                <div class="buttons are-small">
                    <button class="button is-success" id="cekHargaBtn">START</button>
                    <button class="button is-danger" id="StopcekHargaBtn">STOP</button>
                </div>
            </div>
        </div>
    </div>

    <div id="sinyal" style="margin:10px 0px; background-color: #fdfff2;">
        <div class="sinyal-item" data-dex="1INCH">
            <b>1INCH</b>: <span class="has-text-primary" id="sinyal1inch"></span>
        </div>
        <div class="sinyal-item" data-dex="ODOS">
            <b>ODOS</b>: <span class="has-text-primary" id="sinyalodos"></span>
        </div>
        <div class="sinyal-item" data-dex="KYBERSWAP">
            <b>KYBER</b>: <span class="has-text-primary" id="sinyalkyberswap"></span>
        </div>
        <div class="sinyal-item" data-dex="PARASWAP">
            <b>PARA</b>: <span class="has-text-primary" id="sinyalparaswap"></span>
        </div>
        <div class="sinyal-item" data-dex="0X">
            <b>MATCHA</b>: <span class="has-text-primary" id="sinyal0x"></span>
        </div>
        <div class="sinyal-item" data-dex="OKX">
            <b>OKXDEX</b>: <span class="has-text-primary" id="sinyalokx"></span>
        </div>
    </div>

    <div id="progressContainer" style="display: none; margin-top: 10px;">
        <div id="progressText" class="progress-text"></div>
        <div class="progress" style="background-color: #f3f3f3; border-radius: 5px; height: 20px; width: 100%; position: relative;">
            <div id="progressBar" 
                class="progress-bar" 
                role="progressbar" 
                style="background-color: #007bff; height: 100%; width: 0%; border-radius: 5px; text-align: center; line-height: 20px; color: white; font-weight: bold;" 
                aria-valuenow="0" 
                aria-valuemin="0" 
                aria-valuemax="100">
                0%
            </div>
        </div>
    </div>

    <div id="notification" class="notification is-hidden"></div>
    <div class="table-container">
      <table class="table is-striped is-hoverable is-fullwidth">
        <thead>
            <tr> 
                <th rowspan="2" style="vertical-align: middle;"  >ROUTE</th>
                <th>PRICE BUY</th>
                <th class="1INCH">1INCH</th>
                <th class="ODOS">ODOS</th>
                <th class="KYBERSWAP">KYBER</th>
                <th class="PARASWAP">PARA</th>
                <th class="0X">MATCHA</th>
                <th class="OKX">OKXDEX</th>
                <th class="dtcoin has-background-light has-text-justified" rowspan="2">INFO TOKEN</th>
                <th class="1INCH">1INCH</th>
                <th class="ODOS">ODOS</th>
                <th class="KYBERSWAP">KYBER</th>
                <th class="PARASWAP">PARA</th>
                <th class="0X">MATCHA</th>
                <th class="OKX">OKXDEX</th>
                <th>PRICE SELL</th>
                <th rowspan="2" style="vertical-align: middle;">ROUTE</th>
            </tr> 
            <tr>
                <th>VOLUME</th>
                <th class="1INCH"><span id="ModalKiri1INCH"></span></th>
                <th class="ODOS"><span id="ModalKiriODOS"></span></th>
                <th class="KYBERSWAP"><span id="ModalKiriKYBERSWAP"></span></th>
                <th class="PARASWAP"><span id="ModalKiriPARASWAP"></span></th>
                <th class="0X"><span id="ModalKiri0X"></span></th>
                <th class="OKX"><span id="ModalKiriOKX"></span></th>
                <!-- <th class="dtcoin has-background-light" >DETAIL</th> -->
                <th class="1INCH"><span id="ModalKanan1INCH"></span></th>
                <th class="ODOS"><span id="ModalKananODOS"></span></th>
                <th class="KYBERSWAP"><span id="ModalKananKYBERSWAP"></span></th>
                <th class="PARASWAP"><span id="ModalKananPARASWAP"></span></th>
                <th class="0X"><span id="ModalKanan0X"></span></th>
                <th class="OKX"><span id="ModalKananOKX"></span></th>
                <th>VOLUME</th>
            </tr>
        </thead>
        
        <tbody id="TabelHarga">
          <!-- Data will be inserted here dynamically -->
        </tbody>
      </table>
    </div>
    <!-- Setting Modal -->
    <div class="modal" id="dynamicModal">
        <div class="modal-background"></div>
        <div class="modal-card">
            <header class="modal-card-head">
                <p class="modal-card-title">Pengaturan Modal</p>
                <button class="delete" aria-label="close" id="closeModal"></button>
            </header>
            <section class="modal-card-body" id="modal-container">
                <!-- Konten dinamis akan dimasukkan di sini -->
            </section>
            <footer class="modal-card-foot">
                <button class="button is-success" id="saveModal">Save</button>
                <button class="button" id="closeModalFooter">Cancel</button>
            </footer>
        </div>
    </div>    

  </div>

<script>
  $(document).ready(function () {
    // Fungsi untuk mendapatkan data dari localStorage, jika tidak ada, akan diset dengan nilai default
    function getLocalStorageData(key) {
        return JSON.parse(localStorage.getItem(key)) || {};
    }

    // Fungsi untuk menyimpan data ke localStorage
    function setLocalStorageData(key, data) {
        // Hanya simpan jika data yang akan disimpan berbeda dengan yang ada di localStorage
        const existingData = getLocalStorageData(key);
        if (JSON.stringify(existingData) !== JSON.stringify(data)) {
            localStorage.setItem(key, JSON.stringify(data));
        }
    }

    var dataCEX = getLocalStorageData('BINANCE_DATA_CEX');
    var dataDEX = getLocalStorageData('BINANCE_DATA_DEX');
    var dataCONFIG = getLocalStorageData('BINANCE_DATA_CONFIG');
    var dataMODAL = getLocalStorageData('BINANCE_DATA_MODAL');
    var dataTOKEN = getLocalStorageData('BINANCE_TOKENS');
    var dataACTION = getLocalStorageData('BINANCE_HISTORY');

    // console.log('dataCEX:', dataCEX);
    // console.log('dataDEX:', dataDEX);
    // console.log('dataCONFIG:', dataCONFIG);
    // console.log('dataMODAL:', dataMODAL);
    // console.log('dataTOKEN:', dataTOKEN);
    // console.log('dataACTION:', dataACTION);

    // Fungsi untuk mengecek data
    function isValidData(data) {
        return data && Object.keys(data).length > 0;
    }

    // Fungsi untuk menampilkan error di infoAPP dan mengubah icon
    function showError(message, iconId) {
        $('#infoAPP').text(message); // Tampilkan pesan error di infoAPP
        $(`#${iconId}`).css({
            'width': '40px',
            'height': '40px',
        });
    }

    // Pengecekan dan validasi untuk data yang diperlukan
    if (isValidData(dataCEX) && isValidData(dataDEX) && isValidData(dataCONFIG) && isValidData(dataMODAL) && isValidData(dataTOKEN)) {

        // Tampilkan nilai modal di elemen teks (span)
        $.each(dataMODAL, function (id, value) {
            const textElement = $(`#${id}`);
            if (textElement.length) {
                textElement.text(value);
            }
        });

        // Menampilkan aksi terakhir
        if (dataACTION.time) {
            $("#LastUpdate").text(`${dataACTION.action} at ${dataACTION.time}`);
        } else {        
            $('#LastUpdate').text('No Action').addClass('is-danger');
        }
        
        $("div#actionAPP").show();
        renderTableToken(dataTOKEN);
        renderCheckboxes();
        updateUI(); // Lanjutkan jika semua data tersedia

    } else {
        // Menangani kondisi ketika data tidak lengkap atau kosong dan menampilkan error spesifik

        if (!isValidData(dataCEX)) {
            showError("ERROR: SILAKAN SINKRONISASI DATA.", "SyncDataBtn");
        } else if (!isValidData(dataDEX)) {
            showError("ERROR: SETTING DATA DEX TIDAK DITEMUKAN.", "SyncDataBtn");
        } else if (!isValidData(dataCONFIG)) {
            showError("ERROR: KONFIGURASI APLIKASI TIDAK DITEMUKAN.", "SyncDataBtn");
        } else if (!isValidData(dataMODAL)) {
            showError("ERROR: SILAKAN SETTING MODAL DAHULU.", "SettingModal");
        } else if (!isValidData(dataTOKEN)) {
            showError("ERROR: DATA TOKEN KOSONG.", "MasterData");
        }
        $("div#actionAPP").hide();
        // Tambahkan log error atau pemberitahuan lainnya
        console.error("Data tidak lengkap atau tidak ditemukan di localStorage.");
    }

    // Fungsi saat checkbox DEX berubah
    $('input[name="dexCheckbox"]').change(function () {
        // Simpan state checkbox di localStorage
        let dexData = {};
        $('input[name="dexCheckbox"]').each(function () {
            dexData[$(this).val()] = $(this).prop('checked');
        });
        dataDEX.dex = dexData;
        setLocalStorageData('BINANCE_DATA_DEX', dataDEX);  // Simpan ke localStorage
        updateUI();
        toastr.success("PERUBAHAN DEX BERHASIL");
    });

    // Fungsi saat checkbox CHAINS berubah
    $('input[name="chainCheckbox"]').change(function () {
        // Simpan state checkbox chain di localStorage
        let chainData = {};
        $('input[name="chainCheckbox"]').each(function () {
            chainData[$(this).val()] = $(this).prop('checked');
        });
        dataCONFIG.chain = chainData;
        setLocalStorageData('BINANCE_DATA_CONFIG', dataCONFIG);  // Simpan ke localStorage
        renderTableToken(dataTOKEN);
        updateUI();
        toastr.success("PERUBAHAN CHAINS BERHASIL");
    });

    //fungsi sync DATA
    $('#SyncDataBtn').click(function () {
        const urlCEX = "https://multichecker.vercel.app/BINANCE/config_cex.json";
        const urlDEX = "https://multichecker.vercel.app/BINANCE/config_dex.json";
        let uidCounter = 1; 

        $.getJSON(urlCEX, function (dataCEX) {
            setLocalStorageData("BINANCE_DATA_CEX", dataCEX);

            $.getJSON(urlDEX, function (dataDEX) {
                setLocalStorageData("BINANCE_DATA_DEX", dataDEX);

                const config = { dex: {}, chain: {} };
                if (dataDEX && dataDEX.DEXS) {
                    dataDEX.DEXS.forEach(dex => {
                        config.dex[dex] = true;
                    });
                }

                if (dataCEX && dataCEX.CEX_DATA.CHAINS) {
                    dataCEX.CEX_DATA.CHAINS.forEach(chain => {
                        config.chain[chain.NAMACHAIN] = true;
                    });
                }

                setLocalStorageData("BINANCE_DATA_CONFIG", config);

                const tokens = [];
                if (dataCEX.TOKENS && dataCEX.CEX_DATA.CHAINS && dataDEX) {
                    dataCEX.TOKENS.forEach(token => {
                        const matchedChain = dataCEX.CEX_DATA.CHAINS.find(chain => chain.NAMACHAIN.toUpperCase() === token.chain.toUpperCase());
                        if (matchedChain) {
                            const chaincex = matchedChain.CHAIN_CEX;
                            const dexChain = dataDEX[token.chain.toUpperCase()];
                            if (dexChain) {
                                tokens.push({
                                    UID: uidCounter++, 
                                    token: token.token,
                                    namachain: token.chain,
                                    sc_in: token.sc_in,
                                    des_in: token.des_in,
                                    pair_cex: token.pair_cex,
                                    sc_out: token.sc_out,
                                    des_out: token.des_out,
                                    pair_dex: token.pair_dex,
                                    status: token.status,
                                    feeWD: 0,
                                    deposit: 0,
                                    withdraw: 0,
                                    chaincex: chaincex
                                });
                            }
                        }
                    });
                }

                setLocalStorageData("BINANCE_TOKENS", tokens);
                toastr.success("SINKRONISASI DATA BERHASIL!");
                setLastAction("SYNC DATA");
                renderTableToken();
            }).fail(() => {
                toastr.error("GAGAL, SINKRONISASI DATA!");
            });
        }).fail(() => {
            toastr.error("GAGAL, SINKRONISASI DATA!");
        });
    });
    
    function renderTableToken(data) {
        // Ambil konfigurasi dari localStorage
        const config = getLocalStorageData('BINANCE_DATA_CONFIG') || {};
        const activeChains = config.chain || {}; // Default ke objek kosong jika chain tidak ada

        let tableContent = '';
        data.forEach(token => {
            const chainData = dataDEX[token.namachain?.toUpperCase()]; // Gunakan namachain
            const isChainActive = activeChains[token.namachain?.toUpperCase()]; // Gunakan namachain

            if (token.status && isChainActive && chainData) {
                const tokenInfo = chainData.PAIRDEXS[token.token];
                const explorerUrl = chainData.URL_Chain;

                let transformedChain = 
                    (chainData.Nama_Chain).toUpperCase() === "ETHEREUM" ? "ETH" : 
                    (chainData.Nama_Chain).toUpperCase() === "POLYGON" ? "POL" : 
                    (chainData.Nama_Chain).toUpperCase() === "AVAX" ? "AVAX_CCHAIN" : 
                    (chainData.Nama_Chain).toUpperCase();

                var linkLIFI ='<span class=uk-text-success><a href=https://jumper.exchange/?fromChain='+chainData.Kode_Chain+'&fromToken='+token.sc_in+'&toChain='+chainData.Kode_Chain+'&toToken='+token.sc_out+' target=_blank><img src=https://pbs.twimg.com/profile_images/1625887562391863300/h5zJCsBp_400x400.jpg alt=LIFI width=20px /></a></a></span>';
                var linkrubic = "<span class=uk-text-success><a href=https://app.rubic.exchange/?fromChain=" + (chainData.Nama_Chain).toUpperCase() + "&toChain=" + (chainData.Nama_Chain).toUpperCase() +"&from=" + token.sc_in + "&to=" + token.sc_out + " target=_blank>RUBIC</a></span>";
                var linkOKDEX =  "<span class=uk-text-success><a href=https://www.okx.com/web3/dex-swap?inputChain="+chainData.Kode_Chain+"&inputCurrency=" + token.sc_in + "&outputChain=501&outputCurrency=" + token.sc_out+" target=_blank><img src=https://cdn.bitkeep.vip/u_b_d5720c60-81ad-11ed-8134-f90501d87feb.png alt=OKXDEX width=25px /></a></span>";      
                var linkUNIDEX = "<span class=uk-text-success><a href=https://app.unidex.exchange/?chain=" + chainData.Nama_Chain + "&from=" + token.sc_in + "&to=" + token.sc_out + " target=_blank><img src=https://s1.coincarp.com/logo/1/unidex.png?style=200 alt=UNIDEX width=20px /></a></span>";
                var linkRango = "<span class=uk-text-success><a href=https://app.rango.exchange/bridge?fromBlockchain=" +transformedChain+ "&toBlockchain=" + transformedChain +"&fromToken="+ token.token +"--" + token.sc_in + "&toToken=" + token.pair_dex +"--"+token.sc_out+" target=_blank><img src=https://rango.exchange/logo.png alt=RANGO width=20px /></a></span>";
                
                // Variabel awal untuk linkStok
                let linkStok = `[`;

                const chainDataCEX = dataCEX.CEX_DATA.CHAINS.find(chain => chain.NAMACHAIN === token.namachain); // Gunakan namachain

                if (chainDataCEX) {
                    chainDataCEX.WALLETS.forEach((address, index) => {
                        linkStok += `
                        <a href="${explorerUrl}/token/${token.sc_in}?a=${address}" target="_blank">
                            #${index + 1}
                        </a> | `;
                    });
                    linkStok = linkStok.slice(0, -3);
                    linkStok += "]";
                } else {
                    linkStok += "No Wallet]";
                }
                
                var statusWalletCEXToken = getInfoWalletCEX(token.token, token.chaincex, token.token, token.chaincex);
                var statusWalletCEXPair = getInfoWalletCEX(token.pair_dex, token.chaincex, token.pair_dex, token.chaincex);
                const shortNamaToken = token.token.substring(0, 4).toUpperCase();
                const shortenedChain = token.namachain.substring(0, 4).toUpperCase();

                let TotalfeeCEX = `<span id="feePrice-${token.token}-${token.namachain}" class=tag has-background-warning-light has-text-left>FeeWD?</span>`;
                let TotalfeeDEX = `<span id="feePrice-${token.token}-${token.namachain}" class=tag has-background-warning-light has-text-left>Sent?</span>`;
                tableContent += `
                    <tr >
                        <td class="price"><span class=has-background-primary-light>${token.pair_cex} -> ${token.token} </span><br>${token.token} -> ${token.pair_dex}<br><span class=has-background-danger-light> ${token.pair_dex} -> ${token.pair_cex} </span><br/>${TotalfeeCEX}</td>
                        <td class="price has-text-dark has-background-primary-light" id="buy-${token.token}-${token.namachain}">Loading...</td>
                        <td class="1INCH price_token"><span class=has-background-primary-light> {PriceBuyCEX}</span><br> {PriceBuyDEX}<br><span class=has-background-danger-light>  {PriceSellCEX}</span><br/><span class=tag is-link is-normal>PNL: Swap + Trade</span></td>
                        <td class="ODOS price_token"><span class=has-background-primary-light> {PriceBuyCEX}</span><br> {PriceBuyDEX}<br><span class=has-background-danger-light> {PriceSellCEX}</span><br/><span class=tag is-link is-normal>PNL: Swap + Trade</span></td>
                        <td class="KYBERSWAP price_token"><span class=has-background-primary-light> {PriceBuyCEX}</span><br> {PriceBuyDEX}<br><span class=has-background-danger-light>  {PriceSellCEX}</span><br/><span class=tag is-link is-normal>PNL: Swap + Trade</span></td>
                        <td class="PARASWAP price_token"><span class=has-background-primary-light> {PriceBuyCEX}</span><br> {PriceBuyDEX}<br><span class=has-background-danger-light> {PriceSellCEX}</span><br/><span class=tag is-link is-normal>PNL: Swap + Trade</span></td>
                        <td class="0X price_token"><span class=has-background-primary-light> {PriceBuyCEX}</span><br> {PriceBuyDEX}<br><span class=has-background-danger-light>  {PriceSellCEX}</span><br/><span class=tag is-link is-normal>PNL: Swap + Trade</span></td>
                        <td class="OKX price_token"><span class=has-background-primary-light> {PriceBuyCEX}</span><br> {PriceBuyDEX}<br><span class=has-background-danger-light> {PriceSellCEX}</span><br/><span class=tag is-link is-normal>PNL: Swap + Trade</span></td>
                        <td class="dtcoin has-background-light">
                            <input type="checkbox" class="toggle-status" data-token="${token.token}" data-chain="${token.namachain}" ${token.status ? 'checked' : ''}>
                            <a href="${explorerUrl}/token/${token.sc_in}" target="_blank"> <span  style="color: white; font-weight:bolder; background-color: ${chainData.WARNA || '#ffffff'};">&nbsp;${token.token} ( ${(shortenedChain).toUpperCase()} )&nbsp;</span> </a>${linkStok} <br/>
                            <span class="tokenpair">                        
                            <a href="${explorerUrl}address/${token.sc_in}" target="_blank" class=" is-link">
                                ${token.token}
                            </a> VS
                            <a href="${explorerUrl}address/${token.sc_out}" target="_blank" class=" is-link">
                                ${token.pair_dex} 
                            </a> <br/> 
                            ${statusWalletCEXToken.withdrawStatus} - ${statusWalletCEXToken.depositStatus} |
                            ${statusWalletCEXPair.withdrawStatus} - ${statusWalletCEXPair.depositStatus}
                            </span>
                            <br/> ${linkOKDEX} &nbsp; ${linkLIFI} &nbsp; ${linkUNIDEX} &nbsp; ${linkRango} 
                        </td>
                        <td class="1INCH price_token"><span class=has-background-primary-light>  {PriceBuyCEX}</span> <br>  {PriceBuyDEX}<br><span class=has-background-danger-light> {PriceSellCEX}</span><br/><span class=has-background-primary-light>PNL: Swap + Trade</span></td>
                        <td class="ODOS price_token"><span class=has-background-primary-light>  {PriceBuyCEX}</span> <br>  {PriceBuyDEX}<br><span class=has-background-danger-light> {PriceSellCEX}</span><br/><span class=has-background-primary-light>PNL: Swap + Trade</span></td>
                        <td class="KYBERSWAP price_token"><span class=has-background-primary-light>  {PriceBuyCEX}</span> <br>  {PriceBuyDEX}<br><span class=has-background-danger-light> {PriceSellCEX}</span><br/><span class=has-background-primary-light>PNL: Swap + Trade</span></td>
                        <td class="PARASWAP price_token"><span class=has-background-primary-light>  {PriceBuyCEX}</span> <br>  {PriceBuyDEX}<br><span class=has-background-danger-light> {PriceSellCEX}</span><br/><span class=has-background-primary-light>PNL: Swap + Trade</span></td>
                        <td class="0X price_token"><span class=has-background-primary-light>  {PriceBuyCEX}</span> <br>  {PriceBuyDEX}<br><span class=has-background-danger-light> {PriceSellCEX}</span><br/><span class=has-background-primary-light>PNL: Swap + Trade</span></td>
                        <td class="OKX price_token"><span class=has-background-primary-light>  {PriceBuyCEX}</span> <br>  {PriceBuyDEX}<br><span class=has-background-danger-light> {PriceSellCEX}</span><br/><span class=has-background-primary-light>PNL: Swap + Trade</span></td>
                        <td class="price has-text-dark has-background-danger-light" id="sell-${token.token}-${token.namachain}">Loading...</td>
                        <td class="price"><span class=has-background-primary-light> ${token.pair_cex} -> ${token.pair_dex}</span><br> ${token.pair_cex} -> ${token.token} <br><span class=has-background-danger-light> ${token.token} -> ${token.pair_cex}</span><br/>${TotalfeeDEX}</td>                   
                    </tr>
                `;
            }
        });

        $('#TabelHarga').html(tableContent);

        $('.toggle-status').change(function () {
            const tokenSymbol = $(this).data('token');
            const chainName = $(this).data('chain');
            const newStatus = $(this).prop('checked');

            data.forEach(token => {
                if (token.token === tokenSymbol && token.namachain === chainName) { // Gunakan namachain
                    token.status = newStatus;
                    toastr.success("PERUBAHAN STATUS TOKEN " + token.token + " BERHASIL");
                }
            });

            setLocalStorageData('BINANCE_TOKENS', data); // Gunakan BINANCE_TOKENS
            renderTableToken(dataTOKEN);
            updateUI();
        });
    }

     // Fungsi untuk menyimpan log perubahan ke localStorage
    function setLastAction(action) {
        const now = new Date();
        const hours = now.getHours().toString().padStart(2, '0');
        const minutes = now.getMinutes().toString().padStart(2, '0');
        const seconds = now.getSeconds().toString().padStart(2, '0');
        const day = now.getDate().toString().padStart(2, '0');
        const month = (now.getMonth() + 1).toString().padStart(2, '0'); // Bulan dimulai dari 0
        const year = now.getFullYear();

        const formattedTime = `${hours}:${minutes}:${seconds} | ${day}/${month}/${year}`;

        const lastAction = {
            time: formattedTime,
            action: action
        };

        setLocalStorageData("BINANCE_HISTORY", lastAction);
        console.log("AKSI SEBELUMNYA:", $("#UpdateAction").text());
        $("#UpdateAction").html(`${lastAction.action} at ${lastAction.time}`);
        console.log("AKSI SEKARANG:", $("#UpdateAction").text());
    }
    
    function updateUI() {
        const activeChains = dataCONFIG.chain || {}; // Ambil chain aktif dari localStorage
        const totals = calculateTokenTotals(dataTOKEN, activeChains);
        // Update sinyal
        $('#sinyal .sinyal-item').each(function () {
            const dex = $(this).data('dex').toUpperCase(); // Ambil nama dex dalam uppercase
            const isChecked = getLocalStorageData('BINANCE_DATA_CONFIG') && getLocalStorageData('BINANCE_DATA_CONFIG').dex[dex];

            if (isChecked) {
                $(this).show(); // Tampilkan sinyal jika checkbox dicentang
            } else {
                $(this).hide(); // Sembunyikan sinyal jika checkbox tidak dicentang
            }
        });

        // Update kolom tabel
        $('table thead th').each(function () {
            const columnClass = $(this).attr('class');
            if (columnClass) {
                const isChecked = getLocalStorageData('BINANCE_DATA_CONFIG') &&  getLocalStorageData('BINANCE_DATA_CONFIG').dex[columnClass.toUpperCase()];
                if (isChecked) {
                    $(`.${columnClass}`).show(); // Tampilkan kolom jika dicentang
                } else {
                    $(`.${columnClass}`).hide(); // Sembunyikan kolom jika tidak dicentang
                }
            }
        });

        // Update tabel berdasarkan checkbox chain yang dipilih
        $('#TabelHarga .row').each(function () {
            const chain = $(this).data('chain').toUpperCase(); // Ambil data chain dalam uppercase
            const isChainChecked = getLocalStorageData('BINANCE_DATA_CONFIG') &&  getLocalStorageData('BINANCE_DATA_CONFIG').chain[chain];

            if (isChainChecked) {
                $(this).show(); // Tampilkan baris jika chain dicentang
            } else {
                $(this).hide(); // Sembunyikan baris jika tidak dicentang
            }
        });

        // Update tampilan
        $('#totalAllTokens').text(totals.totalTokensAllTokens); // Total semua tokens
        $('#totalTokensAllChains').text(totals.totalTokensAllChains); // Total semua chain
        $('#totalTokenbyChains').text(totals.totalTokensBySelectedChains); 

    }
    
    // Fungsi untuk mengupdate progress bar
    function updateProgressBar(processedCount, totalTokens, currentToken) {
        const progress = Math.round((processedCount / totalTokens) * 100);
        const tokenInfo = currentToken ? `${currentToken.token} VS ${currentToken.pair_dex} [ ${(currentToken.namachain).toUpperCase()} ] ` : "NO TOKEN";

        $('#progressBar').css('width', `${progress}%`).attr('aria-valuenow', progress).text(`${progress}%`);
        $('#progressText').text(`CHECKING : ${tokenInfo} - [${processedCount + 1}/${totalTokens} TOKEN]`).addClass('has-text-centered has-text-link is-size-6');

        if (processedCount === totalTokens) {
            $('#progressText').text("PENGECEKAN SELESAI").addClass('has-text-centered has-background-primary-light');
            $('img.icon').removeClass('nonaktif');  // Menghapus kelas 'nonaktif' dari gambar
            $('input, textarea, select, button').not('#StopcekHargaBtn').prop('disabled', false);  // Mengaktifkan elemen selain tombol #StopcekHargaBtn
           // toastr.success("PENGECEKAN HARGA SEMUA TOKENS TELAH SELESAI");
        } 
        
    }
    //fungsi mendapatkan harga token
    $('#cekHargaBtn').click(function () {
        // non aktifkan semua type inputan
        $('img.icon').addClass('nonaktif');
        $('input, textarea, select, button').not('#StopcekHargaBtn').prop('disabled', true);
        // Pastikan data valid
        if (!dataTOKEN || !Array.isArray(dataTOKEN)) {
            toastr.error("TIDAK ADA DATA TOKENS, SILAKAN ULANGI !!!");
            return;
        }

        // Ambil konfigurasi dari localStorage
        const activeChains = dataCONFIG.chain || {}; // Default ke objek kosong jika chain tidak ada
        // Filter token berdasarkan status aktif dan chain yang dipilih
        const tokens = dataTOKEN.filter(token => 
            token.status && activeChains[token.namachain?.toUpperCase()]
        );

        if (tokens.length === 0) {
            toastr.info("TIDAK ADA TOKENS AKTIF UNTUK CHAIN YANG DIPILIH, SILAKAN ULANGI !!!");
            return;
        }

        // Persiapan progress bar
        let processedCount = 0;
        const totalTokens = tokens.length;

        $('#progressContainer').show();
        updateProgressBar(processedCount, totalTokens); // Set initial progress

        // Fungsi untuk memproses token dan mendapatkan harga dari API
        const processToken = async (token) => {
            try {
                const prices = await getPricesCEX(token);

                // Log harga beli dan jual token ke console
                console.log(`Token: ${token.token} - ${token.pair_cex}, Pair DEX: ${token.pair_dex}`);
                console.log('---------------------------');
                
                console.log(`#Harga BELI Pair DEX (${token.pair_dex}):`);
                prices.pair_dex.buy.forEach(buy => {
                    console.log(`#${buy.price.toFixed(2)} : ${buy.total} ${token.pair_cex}`);
                });
                console.log(`Harga BELI Token: ${token.token}`);
                prices.token.buy.forEach(buy => {
                    console.log(`~ ${buy.price.toFixed(2)} : ${buy.total} ${token.pair_cex}`);
                });

                console.log(`#Harga JUAL Pair DEX (${token.pair_dex}):`);
                prices.pair_dex.sell.forEach(sell => {
                    console.log(`#${sell.price.toFixed(2)} : ${sell.total} ${token.pair_cex}`);
                });
                console.log(`Harga JUAL Token: ${token.token}`);
                prices.token.sell.forEach(sell => {
                    console.log(`~ ${sell.price.toFixed(2)} : ${sell.total} ${token.pair_cex}`);
                });
                
                console.log('---------------------------');
                // Menampilkan hasil harga beli dan jual token di elemen halaman
                const buyHtml = prices.token.buy.map(buy => 
                    `~ ${buy.price.toFixed(2)} : ${buy.total} ${token.pair_cex}`                     
                ).join('<br>');
                
                const sellHtml = prices.token.sell.map(sell => 
                    `~ ${sell.price.toFixed(2)} : ${sell.total} ${token.pair_cex}`
                ).join('<br>');
                
                // Menampilkan hasil harga beli dan jual token di elemen halaman
                $(`#sell-${token.token}-${token.namachain}`).html(buyHtml);
                $(`#buy-${token.token}-${token.namachain}`).html(sellHtml);

                // Perhitungan feeWD * harga beli jika withdraw aktif
                const feePrice = calculateFeeWD(token, prices);
                console.log(`FEE WD: ${token.token}-${token.namachain} -> ${feePrice}$`)
                console.log('---------------------------');
                if (feePrice !== null) {
                    $(`#feePrice-${token.token}-${token.namachain}`).html(`FeeWD: ${feePrice}$`); // Tampilkan hasil perhitungan
                }

                processedCount++;
                updateProgressBar(processedCount, totalTokens, token);
                
            } catch (error) {
                toastr.error(`GAGAL CEK HARGA TOKEN ${token.token}${token.pair_cex}, SILAKAN ULANGI !!!`);
            }
        };

        // Fungsi untuk memproses semua token dengan jeda
        const processTokensWithDelay = async () => {
            for (const token of tokens) {
                await processToken(token);
                await new Promise(resolve => setTimeout(resolve, 500)); // Jeda 500ms
            }
            // Update progress bar setelah semua token selesai diproses
            updateProgressBar(processedCount, totalTokens); // Memastikan progress mencapai 100%
        };

        // Mulai proses
        processTokensWithDelay();
    });

    function calculateFeeWD(token, prices) {
        // Pastikan token memiliki status withdraw aktif
        if (token.withdraw && prices.token.buy.length > 0) {
            const buyPrice = prices.token.buy[0].price; // Ambil harga beli pertama
            const feePrice = token.feeWD * buyPrice; // Perhitungan feeWD * harga beli

            return feePrice.toFixed(2); // Kembalikan hasil perhitungan dengan 2 desimal
        }

        console.log('Withdraw tidak aktif atau harga beli tidak ditemukan');
        return null; // Jika status withdraw tidak aktif, kembalikan null
    }


    // Fungsi untuk mendapatkan harga pada CEX
    function getPricesCEX(token) {
        const tokenSymbol = `${token.token}${token.pair_cex}`;
        return $.getJSON(`https://api.binance.me/api/v3/depth?&symbol=${tokenSymbol}&limit=5`)
        
            .then(data => {
                if (!data || !data.bids || !data.asks) {
                    console.error("Data token tidak valid", data);
                    throw new Error("Data token tidak valid");
                }

                // Ambil 4 data pertama dari bids dan asks untuk token
                const bids = data?.bids.slice(0, 4) || [];
                const asks = data?.asks.slice(0, 4) || [];

                // Jika pair_dex adalah USDT, maka harga pair_dex tidak perlu dipanggil API
                if (token.pair_dex === 'USDT') {
                    return {
                        token: {
                            buy: bids.map(entry => ({
                                price: parseFloat(entry[0]),
                                vol: parseFloat(entry[1]),
                                total: (parseFloat(entry[0]) * parseFloat(entry[1])).toFixed(2)
                            })),
                            sell: asks.map(entry => ({
                                price: parseFloat(entry[0]),
                                vol: parseFloat(entry[1]),
                                total: (parseFloat(entry[0]) * parseFloat(entry[1])).toFixed(2)
                            }))
                        },
                        pair_dex: {
                            buy: [{ price: 1, vol: 1, total: 1 }],
                            sell: [{ price: 1, vol: 1, total: 1 }]
                        }
                    };
                } else {
                    // Ambil harga untuk pair_dex
                    const pairSymbol = `${token.pair_dex}USDT`; // Misalnya, pair_dex dalam IDR
                    return $.getJSON(`https://api.binance.me/api/v3/depth?&symbol=${pairSymbol}&limit=5`)
                        .then(pairData => {
                            if (!pairData || !pairData.bids || !pairData.asks) {
                                console.error("Data pair_dex tidak valid", pairData);
                                throw new Error("Data pair_dex tidak valid");
                            }

                            const pairBids = pairData?.bids.slice(0, 1) || [];
                            const pairAsks = pairData?.asks.slice(0, 1) || [];

                            // Hitung total IDR untuk pair_dex
                            const calculateTotalIDR = (price, vol) => (price * vol).toFixed(2);

                            // Return data harga token dan pair_dex beserta total IDR
                            return {
                                token: {
                                    buy: bids.map(entry => ({
                                        price: parseFloat(entry[0]),
                                        vol: parseFloat(entry[1]),
                                        total: calculateTotalIDR(parseFloat(entry[0]), parseFloat(entry[1]))
                                    })),
                                    sell: asks.map(entry => ({
                                        price: parseFloat(entry[0]),
                                        vol: parseFloat(entry[1]),
                                        total: calculateTotalIDR(parseFloat(entry[0]), parseFloat(entry[1]))
                                    }))
                                },
                                pair_dex: {
                                    buy: pairBids.map(entry => ({
                                        price: parseFloat(entry[0]),
                                        vol: parseFloat(entry[1]),
                                        total: calculateTotalIDR(parseFloat(entry[0]), parseFloat(entry[1]))
                                    })),
                                    sell: pairAsks.map(entry => ({
                                        price: parseFloat(entry[0]),
                                        vol: parseFloat(entry[1]),
                                        total: calculateTotalIDR(parseFloat(entry[0]), parseFloat(entry[1]))
                                    }))
                                }
                            };
                            
                        })
                    
                        .catch(err => {
                            console.error("Gagal mendapatkan data pair_dex", err);
                            throw err; // Mengembalikan error jika gagal mendapatkan pair_dex
                        }); // Jika gagal dapatkan harga pair_dex
                }
            })
            .catch(err => {
                console.error("Gagal mendapatkan harga token", err);
                throw err; // Mengembalikan error jika gagal mendapatkan harga token
            }); // Jika gagal dapatkan harga token
    }
 
    // Fungsi cek info wallet CEX
    function getInfoWalletCEX(wdToken, wdChain, depositToken, depositChain) {
        let depositStatus = '';
        let withdrawStatus = '';
        let feeWithdraw = '';

        dataTOKEN.forEach(tokenData => {
            if (
                tokenData.token.toUpperCase() === wdToken.toUpperCase() &&
                tokenData.chaincex.toUpperCase() === wdChain.toUpperCase()
            ) {
                withdrawStatus = tokenData.withdraw
                    ? '<span class="has-background-success has-text-weight-bold">&nbsp;WD&nbsp;</span>'
                    : '<span class="has-background-danger has-text-white ">&nbsp;WX&nbsp;</span>';
                feeWithdraw = tokenData.feeWD ? tokenData.feeWD : '0'; // Default fee 0 jika tidak tersedia
            }
        });

        dataTOKEN.forEach(tokenData => {
            if (
                tokenData.token.toUpperCase() === depositToken.toUpperCase() &&
                tokenData.chaincex.toUpperCase() === depositChain.toUpperCase()
            ) {
                depositStatus = tokenData.deposit
                    ? '<span class="has-background-success has-text-weight-bold">&nbsp;DP&nbsp;</span>'
                    : '<span class="has-background-danger has-text-white">&nbsp;DX&nbsp;</span>';
            }
        });

        // Kembalikan hasil sebagai objek
        return {
            depositStatus: depositStatus,
            withdrawStatus: withdrawStatus,
            feeWithdraw: feeWithdraw
        };
    }

    // Generate checkbox untuk Chains dan DEX
    function renderCheckboxes() {
        const chains = dataCEX.CEX_DATA.CHAINS; // ETH, BSC, dll.
        const tokens = dataCEX.TOKENS; // Ambil data semua token

        const chainsContainer = $('#Chains');
        chainsContainer.empty(); // Hapus isi sebelumnya

        chains.forEach(chain => {
            // Hitung jumlah token untuk setiap chain
            const tokenCount = tokens.filter(token => token.chain === chain.NAMACHAIN && token.status).length;

            // Cek apakah chain aktif dari 
            const isChecked = dataCONFIG.chain && dataCONFIG.chain[chain.NAMACHAIN] === true;

            // Render checkbox dengan jumlah token
            const chainHtml = `
                <label class="checkbox mx-1">
                    <input type="checkbox" name="chainCheckbox" value="${chain.NAMACHAIN}" ${isChecked ? 'checked' : ''}>
                    ${chain.NAMACHAIN} <span class="has-text-danger">[${tokenCount}]</span>
                </label> `;

            chainsContainer.append(chainHtml);
        });

        const dexs = dataDEX.DEXS; // Ambil data DEX
        const dexsContainer = $('#DEXs');
        dexsContainer.empty(); // Hapus isi sebelumnya
        dexs.forEach(dex => {
            const isChecked = dataCONFIG.dex && dataCONFIG.dex[dex] === true; // Ambil status dari 
            const dexHtml = `
                <label class="checkbox mx-1">
                    <input type="checkbox" name="dexCheckbox" value="${dex}" ${isChecked ? 'checked' : ''}>
                    ${dex.toUpperCase()}
                </label>
            `;
            dexsContainer.append(dexHtml);
        });

        // Tambahkan event listener untuk menyimpan perubahan ke localStorage
        $('input[name="chainCheckbox"]').change(function () {
            const chain = $(this).val();
            const checked = $(this).is(':checked');
            dataCONFIG.chain = dataCONFIG.chain || {};
            dataCONFIG.chain[chain] = checked;
            setLocalStorageData('BINANCE_DATA_CONFIG', dataCONFIG); // Simpan perubahan
        });

        $('input[name="dexCheckbox"]').change(function () {
            const dex = $(this).val();
            const checked = $(this).is(':checked');
            dataCONFIG.dex = dataCONFIG.dex || {};
            dataCONFIG.dex[dex] = checked;
            setLocalStorageData('BINANCE_DATA_CONFIG', dataCONFIG); // Simpan perubahan
        });
    }

    // Fungsi untuk menghasilkan input modal kecil dengan Bulma
    function generateInputModal(dexList) {
        const container = $('#modal-container');
        const storedData = getLocalStorageData('BINANCE_DATA_MODAL') || {}; // Ambil data dari localStorage
        container.empty(); // Bersihkan kontainer

        dexList.forEach(dex => {
            const dexUpperCase = dex.toUpperCase();

            // Tambahkan heading
            const heading = $('<h5></h5>')
                .addClass('title is-6 has-text-danger mb-2') // Ukuran lebih kecil (is-6)
                .text(`Modal ${dexUpperCase}`);
            container.append(heading);

            // Buat elemen input untuk kiri dan kanan
            const modalDiv = $('<div></div>').addClass('columns is-vcentered is-mobile');

            // Input Kiri
            const kiriDiv = $('<div></div>').addClass('column is-half is-flex is-align-items-center');
            const kiriLabel = $('<label></label>')
                .attr('for', `ModalKiri${dexUpperCase}`)
                .addClass('label has-text-primary mr-2') // Ukuran label lebih kecil dan margin kanan
                .text('Kiri');
            const kiriInput = $('<input>')
                .attr('type', 'number')
                .attr('id', `ModalKiri${dexUpperCase}`)
                .addClass('input') // Ukuran input lebih kecil
                .css({ width: '180px' }) // Lebar input lebih pendek
                .val(storedData[`ModalKiri${dexUpperCase}`] || '0') // Ambil nilai dari localStorage atau default 0
                .attr('required', true);
            kiriDiv.append(kiriLabel, kiriInput);

            // Input Kanan
            const kananDiv = $('<div></div>').addClass('column is-half is-flex is-align-items-center');
            const kananLabel = $('<label></label>')
                .attr('for', `ModalKanan${dexUpperCase}`)
                .addClass('label has-text-success mr-2') // Ukuran label lebih kecil dan margin kanan
                .text('Kanan');
            const kananInput = $('<input>')
                .attr('type', 'number')
                .attr('id', `ModalKanan${dexUpperCase}`)
                .addClass('input') // Ukuran input lebih kecil
                .css({ width: '180px' }) // Lebar input lebih pendek
                .val(storedData[`ModalKanan${dexUpperCase}`] || '0') // Ambil nilai dari localStorage atau default 0
                .attr('required', true);
            kananDiv.append(kananLabel, kananInput);

            modalDiv.append(kiriDiv, kananDiv);
            container.append(modalDiv);
        });
    }

    // Event handler untuk membuka modal
    $('#SettingModal').on('click', function () {
        generateInputModal(dataDEX.DEXS);
        $('#dynamicModal').addClass('is-active');
    });

    $("#StopcekHargaBtn,#reload").click(function () {
        location.reload();
    });
    
    // Event handler untuk menutup modal
    $('#closeModal, #closeModalFooter').on('click', function () {
        $('#dynamicModal').removeClass('is-active');
    });

    // Event handler Save Modal
    $('#saveModal').on('click', function () {
        const updatedData = {};
        let isValid = true;

        // Validasi dan pengumpulan data
        $('#modal-container input').each(function () {
            const id = $(this).attr('id');
            const value = $(this).val();

            if (!value || parseFloat(value) <= 0) {
                isValid = false; // Data tidak valid jika kosong atau <= 0
                $(this).addClass('is-danger'); // Tambahkan warna merah pada input yang tidak valid
            } else {
                $(this).removeClass('is-danger'); // Hapus warna merah jika valid
                updatedData[id] = value; // Tambahkan data yang valid ke updatedData
            }
        });

        if (isValid) {
            setLocalStorageData('BINANCE_DATA_MODAL', updatedData);
            toastr.success("SETING MODAL BERHASIL, SILAKAN REFRESH");
            setLastAction("SETTING MODAL");
            $('#dynamicModal').removeClass('is-active');
        } else {
            toastr.error("NILAI MODAL TIDAK BOLEH KOSONG");
        }
    });
    // fungsi hitung token
    function calculateTokenTotals(tokens, activeChains) {

        let totalTokensAllTokens = 0; // Jumlah total token untuk semua token
        let totalTokensAllChains = 0; // Jumlah total token untuk semua chain
        let totalTokensBySelectedChains = 0; // Jumlah total token untuk chain yang dipilih

        tokens.forEach(token => {
            // Hitung total token untuk semua TOKENS
            totalTokensAllTokens++;
            
            // Hitung total token untuk chain yang ada pada token
            if (token.status) {
                totalTokensAllChains++;
            }

            // Hitung total token untuk chain aktif yang ada pada activeChains
            if (token.status && activeChains[token.namachain?.toUpperCase()]) {
                totalTokensBySelectedChains++;
            }
            
        });

        return {
            totalTokensAllTokens,
            totalTokensAllChains,
            totalTokensBySelectedChains
        };
    }

    $('#UpdateWalletCEX').on('click', function () {
        const apiKey = dataCEX.API_CEX['APIKEY'];
        const baseUrl = "https://api.binance.me/sapi/v1/capital/config/getall";
        const timestamp = Date.now().toString();
        const queryString = `timestamp=${timestamp}`;
        const signature = calculateSignature(queryString);

        function calculateSignature(query_string) {
            const secretKey = dataCEX.API_CEX['SECRETKEY'];
            const signature = CryptoJS.HmacSHA256(
                query_string,
                secretKey
            ).toString(CryptoJS.enc.Hex);
            return signature;
        }

        // AJAX request untuk mengambil informasi koin
        $.ajax({
            url: `${baseUrl}?timestamp=${timestamp}&signature=${signature}`,
            type: 'GET',
            headers: {
                'X-MBX-APIKEY': apiKey // Menambahkan API Key pada header
            },
            success: function (response) {
                const coins = response || [];
                let walletData = [];

                coins.forEach(coin => {
                    const networks = coin.networkList || [];
                    networks.forEach(network => {
                        const token = (coin.coin).toUpperCase();
                        const chain = (network.network).toUpperCase();
                        
                        let tokenData = dataTOKEN.find(item => item.token === token && (item.chaincex).toUpperCase() === chain);

                        // Jika token ditemukan, update status deposit, withdraw, dan fee withdraw
                        if (tokenData) {
                            tokenData.deposit = network.depositEnable || false;
                            tokenData.withdraw = network.withdrawEnable || false;
                            tokenData.feeWD = network.withdrawFee || "0";
                        }
                    });
                });

                // Menyimpan data yang diperbarui ke localStorage
                setLocalStorageData("BINANCE_TOKENS", dataTOKEN);

                toastr.success("UPDATE STATUS DEPOSIT, WITHDRAW, DAN FEE WD BERHASIL");
                setLastAction("UPDATE WALLET");
            },
            error: function (xhr, status, error) {
                toastr.error("ERROR UPDATE STATUS DEPOSIT, WITHDRAW, DAN FEE WD", xhr.responseText || status);
            }
        });
    });

  });
</script>
</body>
</html>
